<!DOCTYPE html>

<html>
<head>
  <title>Matrix.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FloatLerpChannel.html">
                FloatLerpChannel.js
              </a>
            
              
              <a class="source" href="FloatTarget.html">
                FloatTarget.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="Keyframe.html">
                Keyframe.js
              </a>
            
              
              <a class="source" href="LinkVisitor.html">
                LinkVisitor.js
              </a>
            
              
              <a class="source" href="QuatLerpChannel.html">
                QuatLerpChannel.js
              </a>
            
              
              <a class="source" href="QuatSlerpChannel.html">
                QuatSlerpChannel.js
              </a>
            
              
              <a class="source" href="QuatTarget.html">
                QuatTarget.js
              </a>
            
              
              <a class="source" href="Sampler.html">
                Sampler.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="Vec3LerpChannel.html">
                Vec3LerpChannel.js
              </a>
            
              
              <a class="source" href="Vec3Target.html">
                Vec3Target.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorMouseKeyboardController.html">
                FirstPersonManipulatorMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorOculusController.html">
                FirstPersonManipulatorOculusController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorMouseKeyboardController.html">
                OrbitManipulatorMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="IntersectVisitor.html">
                IntersectVisitor.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="TriangleIntersect.html">
                TriangleIntersect.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="Oculus.html">
                Oculus.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="stats.html">
                stats.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="Leap.html">
                Leap.js
              </a>
            
              
              <a class="source" href="Q.html">
                Q.js
              </a>
            
              
              <a class="source" href="vr.html">
                vr.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Matrix.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define( [
    <span class="hljs-string">'osg/Notify'</span>,
    <span class="hljs-string">'osg/Vec3'</span>,
    <span class="hljs-string">'osg/Vec4'</span>,
    <span class="hljs-string">'osg/Quat'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( Notify, Vec3, Vec4, Quat )</span> {</span>

    <span class="hljs-comment">/** @class Matrix Operations */</span>
    <span class="hljs-keyword">var</span> Matrix = {
        _tmp0: [],
        _tmp1: [],

        valid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix )</span> {</span>
            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++ ) {
                <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">isNaN</span>( matrix[ i ] ) ) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        },
        setRow: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, row, v0, v1, v2, v3 )</span> {</span>
            <span class="hljs-keyword">var</span> rowIndex = row * <span class="hljs-number">4</span>;
            matrix[ rowIndex + <span class="hljs-number">0</span> ] = v0;
            matrix[ rowIndex + <span class="hljs-number">1</span> ] = v1;
            matrix[ rowIndex + <span class="hljs-number">2</span> ] = v2;
            matrix[ rowIndex + <span class="hljs-number">3</span> ] = v3;
        },
        innerProduct: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b, r, c )</span> {</span>
            <span class="hljs-keyword">var</span> rIndex = r * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">return</span> ( ( a[ rIndex + <span class="hljs-number">0</span> ] * b[ <span class="hljs-number">0</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">1</span> ] * b[ <span class="hljs-number">4</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">2</span> ] * b[ <span class="hljs-number">8</span> + c ] ) + ( a[ rIndex + <span class="hljs-number">3</span> ] * b[ <span class="hljs-number">12</span> + c ] ) );
        },

        set: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, row, col, value )</span> {</span>
            matrix[ row * <span class="hljs-number">4</span> + col ] = value;
            <span class="hljs-keyword">return</span> value;
        },

        get: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, row, col )</span> {</span>
            <span class="hljs-keyword">return</span> matrix[ row * <span class="hljs-number">4</span> + col ];
        },

        makeIdentity: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix )</span> {</span>
            <span class="hljs-keyword">if</span> ( matrix === <span class="hljs-literal">undefined</span> ) {
                matrix = [];
                Notify.log( <span class="hljs-string">'Matrix.makeIdentity without matrix destination is deprecated'</span> );
            }
            Matrix.setRow( matrix, <span class="hljs-number">0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">3</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span> );
            <span class="hljs-keyword">return</span> matrix;
        },

        <span class="hljs-comment">/**
         * @param {Number} x position
         * @param {Number} y position
         * @param {Number} z position
         * @param {Array} matrix to write result
         */</span>
        makeTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( x, y, z, matrix )</span> {</span>
            <span class="hljs-keyword">if</span> ( matrix === <span class="hljs-literal">undefined</span> ) {
                matrix = [];
            }
            Matrix.setRow( matrix, <span class="hljs-number">0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span> );
            Matrix.setRow( matrix, <span class="hljs-number">3</span>, x, y, z, <span class="hljs-number">1.0</span> );
            <span class="hljs-keyword">return</span> matrix;
        },

        setTrans: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, x, y, z )</span> {</span>
            matrix[ <span class="hljs-number">12</span> ] = x;
            matrix[ <span class="hljs-number">13</span> ] = y;
            matrix[ <span class="hljs-number">14</span> ] = z;
            <span class="hljs-keyword">return</span> matrix;
        },

        getTrans: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            result[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">12</span> ];
            result[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">13</span> ];
            result[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">14</span> ];
            <span class="hljs-keyword">return</span> result;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>do a * b and result in a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        preMult: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b )</span> {</span>
            <span class="hljs-keyword">var</span> atmp0, atmp1, atmp2, atmp3;

            atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ] );
            atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ] );
            atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ] );
            atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ] );
            a[ <span class="hljs-number">0</span> ] = atmp0;
            a[ <span class="hljs-number">4</span> ] = atmp1;
            a[ <span class="hljs-number">8</span> ] = atmp2;
            a[ <span class="hljs-number">12</span> ] = atmp3;

            atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ] );
            atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ] );
            atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ] );
            atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ] );
            a[ <span class="hljs-number">1</span> ] = atmp0;
            a[ <span class="hljs-number">5</span> ] = atmp1;
            a[ <span class="hljs-number">9</span> ] = atmp2;
            a[ <span class="hljs-number">13</span> ] = atmp3;

            atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ] );
            atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ] );
            atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ] );
            atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ] );
            a[ <span class="hljs-number">2</span> ] = atmp0;
            a[ <span class="hljs-number">6</span> ] = atmp1;
            a[ <span class="hljs-number">10</span> ] = atmp2;
            a[ <span class="hljs-number">14</span> ] = atmp3;

            atmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ] );
            atmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ] );
            atmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ] );
            atmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ] );
            a[ <span class="hljs-number">3</span> ] = atmp0;
            a[ <span class="hljs-number">7</span> ] = atmp1;
            a[ <span class="hljs-number">11</span> ] = atmp2;
            a[ <span class="hljs-number">15</span> ] = atmp3;

            <span class="hljs-keyword">return</span> a;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>do a * b and result in b</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        postMult: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b )</span> {</span>
            <span class="hljs-keyword">var</span> btmp0, btmp1, btmp2, btmp3;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>post mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            btmp0 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ] );
            btmp1 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ] );
            btmp2 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ] );
            btmp3 = ( b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ] );
            b[ <span class="hljs-number">0</span> ] = btmp0;
            b[ <span class="hljs-number">1</span> ] = btmp1;
            b[ <span class="hljs-number">2</span> ] = btmp2;
            b[ <span class="hljs-number">3</span> ] = btmp3;

            btmp0 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ] );
            btmp1 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ] );
            btmp2 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ] );
            btmp3 = ( b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ] );
            b[ <span class="hljs-number">4</span> ] = btmp0;
            b[ <span class="hljs-number">5</span> ] = btmp1;
            b[ <span class="hljs-number">6</span> ] = btmp2;
            b[ <span class="hljs-number">7</span> ] = btmp3;

            btmp0 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ] );
            btmp1 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ] );
            btmp2 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ] );
            btmp3 = ( b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ] );
            b[ <span class="hljs-number">8</span> ] = btmp0;
            b[ <span class="hljs-number">9</span> ] = btmp1;
            b[ <span class="hljs-number">10</span> ] = btmp2;
            b[ <span class="hljs-number">11</span> ] = btmp3;

            btmp0 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ] );
            btmp1 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ] );
            btmp2 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ] );
            btmp3 = ( b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] ) + ( b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] ) + ( b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] ) + ( b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ] );
            b[ <span class="hljs-number">12</span> ] = btmp0;
            b[ <span class="hljs-number">13</span> ] = btmp1;
            b[ <span class="hljs-number">14</span> ] = btmp2;
            b[ <span class="hljs-number">15</span> ] = btmp3;

            <span class="hljs-keyword">return</span> b;
        },
        multa: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b, r )</span> {</span>
            <span class="hljs-keyword">if</span> ( r === a ) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.preMult( a, b );
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( r === b ) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.postMult( a, b );
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> ( r === <span class="hljs-literal">undefined</span> ) {
                    r = [];
                }
                r[ <span class="hljs-number">0</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">12</span> ];
                r[ <span class="hljs-number">1</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">13</span> ];
                r[ <span class="hljs-number">2</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">14</span> ];
                r[ <span class="hljs-number">3</span> ] = b[ <span class="hljs-number">0</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">1</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">2</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">3</span> ] * a[ <span class="hljs-number">15</span> ];

                r[ <span class="hljs-number">4</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">12</span> ];
                r[ <span class="hljs-number">5</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">13</span> ];
                r[ <span class="hljs-number">6</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">14</span> ];
                r[ <span class="hljs-number">7</span> ] = b[ <span class="hljs-number">4</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">5</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">6</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">7</span> ] * a[ <span class="hljs-number">15</span> ];

                r[ <span class="hljs-number">8</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">12</span> ];
                r[ <span class="hljs-number">9</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">13</span> ];
                r[ <span class="hljs-number">10</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">14</span> ];
                r[ <span class="hljs-number">11</span> ] = b[ <span class="hljs-number">8</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">9</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">10</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">11</span> ] * a[ <span class="hljs-number">15</span> ];

                r[ <span class="hljs-number">12</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">0</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">4</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">8</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">12</span> ];
                r[ <span class="hljs-number">13</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">1</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">5</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">9</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">13</span> ];
                r[ <span class="hljs-number">14</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">2</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">6</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">10</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">14</span> ];
                r[ <span class="hljs-number">15</span> ] = b[ <span class="hljs-number">12</span> ] * a[ <span class="hljs-number">3</span> ] + b[ <span class="hljs-number">13</span> ] * a[ <span class="hljs-number">7</span> ] + b[ <span class="hljs-number">14</span> ] * a[ <span class="hljs-number">11</span> ] + b[ <span class="hljs-number">15</span> ] * a[ <span class="hljs-number">15</span> ];

                <span class="hljs-keyword">return</span> r;
            }
        },
        <span class="hljs-comment">/* r = a * b */</span>
        mult: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b, r )</span> {</span>
            <span class="hljs-keyword">var</span> s00 = b[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> s01 = b[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> s02 = b[ <span class="hljs-number">2</span> ];
            <span class="hljs-keyword">var</span> s03 = b[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> s10 = b[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> s11 = b[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> s12 = b[ <span class="hljs-number">6</span> ];
            <span class="hljs-keyword">var</span> s13 = b[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> s20 = b[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> s21 = b[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> s22 = b[ <span class="hljs-number">10</span> ];
            <span class="hljs-keyword">var</span> s23 = b[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> s30 = b[ <span class="hljs-number">12</span> ];
            <span class="hljs-keyword">var</span> s31 = b[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> s32 = b[ <span class="hljs-number">14</span> ];
            <span class="hljs-keyword">var</span> s33 = b[ <span class="hljs-number">15</span> ];

            <span class="hljs-keyword">var</span> o00 = a[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> o01 = a[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> o02 = a[ <span class="hljs-number">2</span> ];
            <span class="hljs-keyword">var</span> o03 = a[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> o10 = a[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> o11 = a[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> o12 = a[ <span class="hljs-number">6</span> ];
            <span class="hljs-keyword">var</span> o13 = a[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> o20 = a[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> o21 = a[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> o22 = a[ <span class="hljs-number">10</span> ];
            <span class="hljs-keyword">var</span> o23 = a[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> o30 = a[ <span class="hljs-number">12</span> ];
            <span class="hljs-keyword">var</span> o31 = a[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> o32 = a[ <span class="hljs-number">14</span> ];
            <span class="hljs-keyword">var</span> o33 = a[ <span class="hljs-number">15</span> ];

            r[ <span class="hljs-number">0</span> ] = s00 * o00 + s01 * o10 + s02 * o20 + s03 * o30;
            r[ <span class="hljs-number">1</span> ] = s00 * o01 + s01 * o11 + s02 * o21 + s03 * o31;
            r[ <span class="hljs-number">2</span> ] = s00 * o02 + s01 * o12 + s02 * o22 + s03 * o32;
            r[ <span class="hljs-number">3</span> ] = s00 * o03 + s01 * o13 + s02 * o23 + s03 * o33;

            r[ <span class="hljs-number">4</span> ] = s10 * o00 + s11 * o10 + s12 * o20 + s13 * o30;
            r[ <span class="hljs-number">5</span> ] = s10 * o01 + s11 * o11 + s12 * o21 + s13 * o31;
            r[ <span class="hljs-number">6</span> ] = s10 * o02 + s11 * o12 + s12 * o22 + s13 * o32;
            r[ <span class="hljs-number">7</span> ] = s10 * o03 + s11 * o13 + s12 * o23 + s13 * o33;

            r[ <span class="hljs-number">8</span> ] = s20 * o00 + s21 * o10 + s22 * o20 + s23 * o30;
            r[ <span class="hljs-number">9</span> ] = s20 * o01 + s21 * o11 + s22 * o21 + s23 * o31;
            r[ <span class="hljs-number">10</span> ] = s20 * o02 + s21 * o12 + s22 * o22 + s23 * o32;
            r[ <span class="hljs-number">11</span> ] = s20 * o03 + s21 * o13 + s22 * o23 + s23 * o33;

            r[ <span class="hljs-number">12</span> ] = s30 * o00 + s31 * o10 + s32 * o20 + s33 * o30;
            r[ <span class="hljs-number">13</span> ] = s30 * o01 + s31 * o11 + s32 * o21 + s33 * o31;
            r[ <span class="hljs-number">14</span> ] = s30 * o02 + s31 * o12 + s32 * o22 + s33 * o32;
            r[ <span class="hljs-number">15</span> ] = s30 * o03 + s31 * o13 + s32 * o23 + s33 * o33;

            <span class="hljs-keyword">return</span> r;
        },
        multOrig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( a, b, r )</span> {</span>
            <span class="hljs-keyword">var</span> t;
            <span class="hljs-keyword">if</span> ( r === a ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>pre mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                t = [];
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">4</span>; col++ ) {
                    t[ <span class="hljs-number">0</span> ] = Matrix.innerProduct( b, a, <span class="hljs-number">0</span>, col );
                    t[ <span class="hljs-number">1</span> ] = Matrix.innerProduct( b, a, <span class="hljs-number">1</span>, col );
                    t[ <span class="hljs-number">2</span> ] = Matrix.innerProduct( b, a, <span class="hljs-number">2</span>, col );
                    t[ <span class="hljs-number">3</span> ] = Matrix.innerProduct( b, a, <span class="hljs-number">3</span>, col );
                    a[ <span class="hljs-number">0</span> + col ] = t[ <span class="hljs-number">0</span> ];
                    a[ <span class="hljs-number">4</span> + col ] = t[ <span class="hljs-number">1</span> ];
                    a[ <span class="hljs-number">8</span> + col ] = t[ <span class="hljs-number">2</span> ];
                    a[ <span class="hljs-number">12</span> + col ] = t[ <span class="hljs-number">3</span> ];
                }
                <span class="hljs-keyword">return</span> a;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>return this.preMult(r, b);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( r === b ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>post mult</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                t = [];
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">4</span>; row++ ) {
                    t[ <span class="hljs-number">0</span> ] = Matrix.innerProduct( b, a, row, <span class="hljs-number">0</span> );
                    t[ <span class="hljs-number">1</span> ] = Matrix.innerProduct( b, a, row, <span class="hljs-number">1</span> );
                    t[ <span class="hljs-number">2</span> ] = Matrix.innerProduct( b, a, row, <span class="hljs-number">2</span> );
                    t[ <span class="hljs-number">3</span> ] = Matrix.innerProduct( b, a, row, <span class="hljs-number">3</span> );
                    <span class="hljs-keyword">this</span>.setRow( b, row, t[ <span class="hljs-number">0</span> ], t[ <span class="hljs-number">1</span> ], t[ <span class="hljs-number">2</span> ], t[ <span class="hljs-number">3</span> ] );
                }
                <span class="hljs-keyword">return</span> b;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>return this.postMult(r, a);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            }
            <span class="hljs-keyword">if</span> ( r === <span class="hljs-literal">undefined</span> ) {
                r = [];
            }

            <span class="hljs-keyword">var</span> s00 = b[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> s01 = b[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> s02 = b[ <span class="hljs-number">2</span> ];
            <span class="hljs-keyword">var</span> s03 = b[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> s10 = b[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> s11 = b[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> s12 = b[ <span class="hljs-number">6</span> ];
            <span class="hljs-keyword">var</span> s13 = b[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> s20 = b[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> s21 = b[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> s22 = b[ <span class="hljs-number">10</span> ];
            <span class="hljs-keyword">var</span> s23 = b[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> s30 = b[ <span class="hljs-number">12</span> ];
            <span class="hljs-keyword">var</span> s31 = b[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> s32 = b[ <span class="hljs-number">14</span> ];
            <span class="hljs-keyword">var</span> s33 = b[ <span class="hljs-number">15</span> ];

            <span class="hljs-keyword">var</span> o00 = a[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> o01 = a[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> o02 = a[ <span class="hljs-number">2</span> ];
            <span class="hljs-keyword">var</span> o03 = a[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> o10 = a[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> o11 = a[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> o12 = a[ <span class="hljs-number">6</span> ];
            <span class="hljs-keyword">var</span> o13 = a[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> o20 = a[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> o21 = a[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> o22 = a[ <span class="hljs-number">10</span> ];
            <span class="hljs-keyword">var</span> o23 = a[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> o30 = a[ <span class="hljs-number">12</span> ];
            <span class="hljs-keyword">var</span> o31 = a[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> o32 = a[ <span class="hljs-number">14</span> ];
            <span class="hljs-keyword">var</span> o33 = a[ <span class="hljs-number">15</span> ];

            r[ <span class="hljs-number">0</span> ] = s00 * o00 + s01 * o10 + s02 * o20 + s03 * o30;
            r[ <span class="hljs-number">1</span> ] = s00 * o01 + s01 * o11 + s02 * o21 + s03 * o31;
            r[ <span class="hljs-number">2</span> ] = s00 * o02 + s01 * o12 + s02 * o22 + s03 * o32;
            r[ <span class="hljs-number">3</span> ] = s00 * o03 + s01 * o13 + s02 * o23 + s03 * o33;

            r[ <span class="hljs-number">4</span> ] = s10 * o00 + s11 * o10 + s12 * o20 + s13 * o30;
            r[ <span class="hljs-number">5</span> ] = s10 * o01 + s11 * o11 + s12 * o21 + s13 * o31;
            r[ <span class="hljs-number">6</span> ] = s10 * o02 + s11 * o12 + s12 * o22 + s13 * o32;
            r[ <span class="hljs-number">7</span> ] = s10 * o03 + s11 * o13 + s12 * o23 + s13 * o33;

            r[ <span class="hljs-number">8</span> ] = s20 * o00 + s21 * o10 + s22 * o20 + s23 * o30;
            r[ <span class="hljs-number">9</span> ] = s20 * o01 + s21 * o11 + s22 * o21 + s23 * o31;
            r[ <span class="hljs-number">10</span> ] = s20 * o02 + s21 * o12 + s22 * o22 + s23 * o32;
            r[ <span class="hljs-number">11</span> ] = s20 * o03 + s21 * o13 + s22 * o23 + s23 * o33;

            r[ <span class="hljs-number">12</span> ] = s30 * o00 + s31 * o10 + s32 * o20 + s33 * o30;
            r[ <span class="hljs-number">13</span> ] = s30 * o01 + s31 * o11 + s32 * o21 + s33 * o31;
            r[ <span class="hljs-number">14</span> ] = s30 * o02 + s31 * o12 + s32 * o22 + s33 * o32;
            r[ <span class="hljs-number">15</span> ] = s30 * o03 + s31 * o13 + s32 * o23 + s33 * o33;

            <span class="hljs-keyword">return</span> r;
        },

        makeLookAt: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( eye, center, up, result )</span> {</span>

            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }

            <span class="hljs-keyword">var</span> f = Vec3.sub( center, eye, [] );
            Vec3.normalize( f, f );

            <span class="hljs-keyword">var</span> s = Vec3.cross( f, up, [] );
            Vec3.normalize( s, s );

            <span class="hljs-keyword">var</span> u = Vec3.cross( s, f, [] );
            Vec3.normalize( u, u );</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>s[0], u[0], -f[0], 0.0,
s[1], u[1], -f[1], 0.0,
s[2], u[2], -f[2], 0.0,
0,    0,    0,     1.0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            result[ <span class="hljs-number">0</span> ] = s[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">1</span> ] = u[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">2</span> ] = -f[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">4</span> ] = s[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">5</span> ] = u[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">6</span> ] = -f[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">8</span> ] = s[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">9</span> ] = u[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">10</span> ] = -f[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">11</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">12</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">13</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">14</span> ] = <span class="hljs-number">0</span>;
            result[ <span class="hljs-number">15</span> ] = <span class="hljs-number">1.0</span>;

            Matrix.multTranslate( result, Vec3.neg( eye, [] ), result );
            <span class="hljs-keyword">return</span> result;
        },
        makeOrtho: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( left, right,
            bottom, top,
            zNear, zFar, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>note transpose of Matrix_implementation wr.t OpenGL documentation, since the OSG use post multiplication rather than pre.
we will change this convention later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> tx = -( right + left ) / ( right - left );
            <span class="hljs-keyword">var</span> ty = -( top + bottom ) / ( top - bottom );
            <span class="hljs-keyword">var</span> tz = -( zFar + zNear ) / ( zFar - zNear );
            <span class="hljs-keyword">var</span> row = Matrix.setRow;
            row( result, <span class="hljs-number">0</span>, <span class="hljs-number">2.0</span> / ( right - left ), <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            row( result, <span class="hljs-number">1</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">2.0</span> / ( top - bottom ), <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span> );
            row( result, <span class="hljs-number">2</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, -<span class="hljs-number">2.0</span> / ( zFar - zNear ), <span class="hljs-number">0.0</span> );
            row( result, <span class="hljs-number">3</span>, tx, ty, tz, <span class="hljs-number">1.0</span> );
            <span class="hljs-keyword">return</span> result;
        },

        getLookAt: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, eye, center, up, distance )</span> {</span>
            <span class="hljs-keyword">if</span> ( distance === <span class="hljs-literal">undefined</span> ) {
                distance = <span class="hljs-number">1.0</span>;
            }
            <span class="hljs-keyword">var</span> inv = [];
            <span class="hljs-keyword">var</span> result = Matrix.inverse( matrix, inv );
            <span class="hljs-keyword">if</span> ( !result ) {
                Matrix.makeIdentity( inv );
            }
            Matrix.transformVec3( inv, [ <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ], eye );
            Matrix.transform3x3( matrix, [ <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span> ], up );
            Matrix.transform3x3( matrix, [ <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span> ], center );
            Vec3.normalize( center, center );
            Vec3.add( Vec3.mult( center, distance, [] ), eye, center );
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>getRotate_David_Spillings_Mk1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getRotate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( mat, quatResult )</span> {</span>
            <span class="hljs-keyword">if</span> ( quatResult === <span class="hljs-literal">undefined</span> ) {
                quatResult = [];
            }

            <span class="hljs-keyword">var</span> s;
            <span class="hljs-keyword">var</span> tq = [];
            <span class="hljs-keyword">var</span> i, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Use tq to store the largest trace</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> mat00 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">0</span> + <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> mat11 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">1</span> + <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> mat22 = mat[ <span class="hljs-number">4</span> * <span class="hljs-number">2</span> + <span class="hljs-number">2</span> ];
            tq[ <span class="hljs-number">0</span> ] = <span class="hljs-number">1</span> + mat00 + mat11 + mat22;
            tq[ <span class="hljs-number">1</span> ] = <span class="hljs-number">1</span> + mat00 - mat11 - mat22;
            tq[ <span class="hljs-number">2</span> ] = <span class="hljs-number">1</span> - mat00 + mat11 - mat22;
            tq[ <span class="hljs-number">3</span> ] = <span class="hljs-number">1</span> - mat00 - mat11 + mat22;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Find the maximum (could also use stacked ifs later)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            j = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">4</span>; i++ ) {
                <span class="hljs-keyword">if</span> ( ( tq[ i ] &gt; tq[ j ] ) ) {
                    j = i;
                } <span class="hljs-keyword">else</span> {
                    j = j;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>check the diagonal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">0</span> ) {
                <span class="hljs-comment">/* perform instant calculation */</span>
                quatResult[ <span class="hljs-number">3</span> ] = tq[ <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] - mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] - mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">1</span> ) {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = tq[ <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] + mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] + mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( j === <span class="hljs-number">2</span> ) {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] - mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] + mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = tq[ <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] + mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
            } <span class="hljs-keyword">else</span> <span class="hljs-comment">/* if (j==3) */</span> {
                quatResult[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] - mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ];
                quatResult[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">0</span> ] + mat[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ];
                quatResult[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] + mat[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
                quatResult[ <span class="hljs-number">2</span> ] = tq[ <span class="hljs-number">3</span> ];
            }

            s = <span class="hljs-built_in">Math</span>.sqrt( <span class="hljs-number">0.25</span> / tq[ j ] );
            quatResult[ <span class="hljs-number">3</span> ] *= s;
            quatResult[ <span class="hljs-number">0</span> ] *= s;
            quatResult[ <span class="hljs-number">1</span> ] *= s;
            quatResult[ <span class="hljs-number">2</span> ] *= s;

            <span class="hljs-keyword">return</span> quatResult;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Matrix M = Matrix M * Matrix Translate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        preMultTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( mat, translate )</span> {</span>
            <span class="hljs-keyword">var</span> val;
            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">0</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">0</span> ];
                mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">0</span> ];
                mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">1</span> ];
                mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">2</span> ];
                mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">3</span> ];
            }

            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">1</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">1</span> ];
                mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">4</span> ];
                mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">5</span> ];
                mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">6</span> ];
                mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">7</span> ];
            }

            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">2</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">2</span> ];
                mat[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">8</span> ];
                mat[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">9</span> ];
                mat[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">10</span> ];
                mat[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">11</span> ];
            }
            <span class="hljs-keyword">return</span> mat;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>result = Matrix M * Matrix Translate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        multTranslate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( mat, translate, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            <span class="hljs-keyword">if</span> ( result !== mat ) {
                Matrix.copy( mat, result );
            }

            <span class="hljs-keyword">var</span> val;
            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">0</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">0</span> ];
                result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">0</span> ];
                result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">1</span> ];
                result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">2</span> ];
                result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">3</span> ];
            }

            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">1</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">1</span> ];
                result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">4</span> ];
                result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">5</span> ];
                result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">6</span> ];
                result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">7</span> ];
            }

            <span class="hljs-keyword">if</span> ( translate[ <span class="hljs-number">2</span> ] !== <span class="hljs-number">0.0</span> ) {
                val = translate[ <span class="hljs-number">2</span> ];
                result[ <span class="hljs-number">12</span> ] += val * mat[ <span class="hljs-number">8</span> ];
                result[ <span class="hljs-number">13</span> ] += val * mat[ <span class="hljs-number">9</span> ];
                result[ <span class="hljs-number">14</span> ] += val * mat[ <span class="hljs-number">10</span> ];
                result[ <span class="hljs-number">15</span> ] += val * mat[ <span class="hljs-number">11</span> ];
            }
            <span class="hljs-keyword">return</span> result;
        },

        makeRotate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( angle, x, y, z, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.log( <span class="hljs-string">'makeRotate without given matrix destination is deprecated'</span> );
                result = [];
            }

            <span class="hljs-keyword">var</span> mag = <span class="hljs-built_in">Math</span>.sqrt( x * x + y * y + z * z );
            <span class="hljs-keyword">var</span> sinAngle = <span class="hljs-built_in">Math</span>.sin( angle );
            <span class="hljs-keyword">var</span> cosAngle = <span class="hljs-built_in">Math</span>.cos( angle );

            <span class="hljs-keyword">if</span> ( mag &gt; <span class="hljs-number">0.0</span> ) {
                <span class="hljs-keyword">var</span> xx, yy, zz, xy, yz, zx, xs, ys, zs;
                <span class="hljs-keyword">var</span> oneMinusCos;

                mag = <span class="hljs-number">1.0</span> / mag;

                x *= mag;
                y *= mag;
                z *= mag;

                xx = x * x;
                yy = y * y;
                zz = z * z;
                xy = x * y;
                yz = y * z;
                zx = z * x;
                xs = x * sinAngle;
                ys = y * sinAngle;
                zs = z * sinAngle;
                oneMinusCos = <span class="hljs-number">1.0</span> - cosAngle;

                result[ <span class="hljs-number">0</span> ] = ( oneMinusCos * xx ) + cosAngle;
                result[ <span class="hljs-number">1</span> ] = ( oneMinusCos * xy ) - zs;
                result[ <span class="hljs-number">2</span> ] = ( oneMinusCos * zx ) + ys;
                result[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;

                result[ <span class="hljs-number">4</span> ] = ( oneMinusCos * xy ) + zs;
                result[ <span class="hljs-number">5</span> ] = ( oneMinusCos * yy ) + cosAngle;
                result[ <span class="hljs-number">6</span> ] = ( oneMinusCos * yz ) - xs;
                result[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;

                result[ <span class="hljs-number">8</span> ] = ( oneMinusCos * zx ) - ys;
                result[ <span class="hljs-number">9</span> ] = ( oneMinusCos * yz ) + xs;
                result[ <span class="hljs-number">10</span> ] = ( oneMinusCos * zz ) + cosAngle;
                result[ <span class="hljs-number">11</span> ] = <span class="hljs-number">0.0</span>;

                result[ <span class="hljs-number">12</span> ] = <span class="hljs-number">0.0</span>;
                result[ <span class="hljs-number">13</span> ] = <span class="hljs-number">0.0</span>;
                result[ <span class="hljs-number">14</span> ] = <span class="hljs-number">0.0</span>;
                result[ <span class="hljs-number">15</span> ] = <span class="hljs-number">1.0</span>;

                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> Matrix.makeIdentity( result );
            }

            <span class="hljs-keyword">return</span> result;
        },

        transform3x3: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( m, v, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            result[ <span class="hljs-number">0</span> ] = m[ <span class="hljs-number">0</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">1</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">2</span> ] * v[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">1</span> ] = m[ <span class="hljs-number">4</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">5</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">6</span> ] * v[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">2</span> ] = m[ <span class="hljs-number">8</span> ] * v[ <span class="hljs-number">0</span> ] + m[ <span class="hljs-number">9</span> ] * v[ <span class="hljs-number">1</span> ] + m[ <span class="hljs-number">10</span> ] * v[ <span class="hljs-number">2</span> ];
            <span class="hljs-keyword">return</span> result;
        },

        transformVec3: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, vector, result )</span> {</span>
            <span class="hljs-keyword">var</span> d = <span class="hljs-number">1.0</span> / ( matrix[ <span class="hljs-number">3</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">7</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">11</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">15</span> ] );

            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                Notify.warn( <span class="hljs-string">'deprecated, Matrix.transformVec3 needs a third parameter as result'</span> );
                result = [];
            }

            <span class="hljs-keyword">var</span> tmp;
            <span class="hljs-keyword">if</span> ( result === vector ) {
                tmp = [];
            } <span class="hljs-keyword">else</span> {
                tmp = result;
            }
            tmp[ <span class="hljs-number">0</span> ] = ( matrix[ <span class="hljs-number">0</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">4</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">8</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">12</span> ] ) * d;
            tmp[ <span class="hljs-number">1</span> ] = ( matrix[ <span class="hljs-number">1</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">5</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">9</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">13</span> ] ) * d;
            tmp[ <span class="hljs-number">2</span> ] = ( matrix[ <span class="hljs-number">2</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">6</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">10</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">14</span> ] ) * d;

            <span class="hljs-keyword">if</span> ( result === vector ) {
                Vec3.copy( tmp, result );
            }
            <span class="hljs-keyword">return</span> result;
        },

        transformVec4: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, vector, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            <span class="hljs-keyword">var</span> tmp;
            <span class="hljs-keyword">if</span> ( result === vector ) {
                tmp = [];
            } <span class="hljs-keyword">else</span> {
                tmp = result;
            }
            tmp[ <span class="hljs-number">0</span> ] = ( matrix[ <span class="hljs-number">0</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">1</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">2</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">3</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">1</span> ] = ( matrix[ <span class="hljs-number">4</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">5</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">6</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">7</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">2</span> ] = ( matrix[ <span class="hljs-number">8</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">9</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">10</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">11</span> ] * vector[ <span class="hljs-number">3</span> ] );
            tmp[ <span class="hljs-number">3</span> ] = ( matrix[ <span class="hljs-number">12</span> ] * vector[ <span class="hljs-number">0</span> ] + matrix[ <span class="hljs-number">13</span> ] * vector[ <span class="hljs-number">1</span> ] + matrix[ <span class="hljs-number">14</span> ] * vector[ <span class="hljs-number">2</span> ] + matrix[ <span class="hljs-number">15</span> ] * vector[ <span class="hljs-number">3</span> ] );

            <span class="hljs-keyword">if</span> ( result === vector ) {
                Vec4.copy( tmp, result );
            }
            <span class="hljs-keyword">return</span> result;
        },

        copy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            result[ <span class="hljs-number">0</span> ] = matrix[ <span class="hljs-number">0</span> ];
            result[ <span class="hljs-number">1</span> ] = matrix[ <span class="hljs-number">1</span> ];
            result[ <span class="hljs-number">2</span> ] = matrix[ <span class="hljs-number">2</span> ];
            result[ <span class="hljs-number">3</span> ] = matrix[ <span class="hljs-number">3</span> ];
            result[ <span class="hljs-number">4</span> ] = matrix[ <span class="hljs-number">4</span> ];
            result[ <span class="hljs-number">5</span> ] = matrix[ <span class="hljs-number">5</span> ];
            result[ <span class="hljs-number">6</span> ] = matrix[ <span class="hljs-number">6</span> ];
            result[ <span class="hljs-number">7</span> ] = matrix[ <span class="hljs-number">7</span> ];
            result[ <span class="hljs-number">8</span> ] = matrix[ <span class="hljs-number">8</span> ];
            result[ <span class="hljs-number">9</span> ] = matrix[ <span class="hljs-number">9</span> ];
            result[ <span class="hljs-number">10</span> ] = matrix[ <span class="hljs-number">10</span> ];
            result[ <span class="hljs-number">11</span> ] = matrix[ <span class="hljs-number">11</span> ];
            result[ <span class="hljs-number">12</span> ] = matrix[ <span class="hljs-number">12</span> ];
            result[ <span class="hljs-number">13</span> ] = matrix[ <span class="hljs-number">13</span> ];
            result[ <span class="hljs-number">14</span> ] = matrix[ <span class="hljs-number">14</span> ];
            result[ <span class="hljs-number">15</span> ] = matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">return</span> result;
        },

        inverse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === matrix ) {
                Matrix.copy( matrix, Matrix._tmp1 );
                matrix = Matrix._tmp1;
            }

            <span class="hljs-keyword">if</span> ( matrix[ <span class="hljs-number">3</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">7</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">11</span> ] === <span class="hljs-number">0.0</span> &amp;&amp; matrix[ <span class="hljs-number">15</span> ] === <span class="hljs-number">1.0</span> ) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.inverse4x3( matrix, result );
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.inverse4x4( matrix, result );
            }
        },

        <span class="hljs-comment">/**
         *  if a result argument is given the return of the function is true or false
         *  depending if the matrix can be inverted, else if no result argument is given
         *  the return is identity if the matrix can not be inverted and the matrix overthise
         */</span>
        inverse4x4: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            <span class="hljs-keyword">var</span> tmp0 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">var</span> tmp1 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> tmp2 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">var</span> tmp3 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> tmp4 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> tmp5 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> tmp6 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">var</span> tmp7 = matrix[ <span class="hljs-number">14</span> ] * matrix[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> tmp8 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">11</span> ];
            <span class="hljs-keyword">var</span> tmp9 = matrix[ <span class="hljs-number">10</span> ] * matrix[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> tmp10 = matrix[ <span class="hljs-number">2</span> ] * matrix[ <span class="hljs-number">7</span> ];
            <span class="hljs-keyword">var</span> tmp11 = matrix[ <span class="hljs-number">6</span> ] * matrix[ <span class="hljs-number">3</span> ];
            <span class="hljs-keyword">var</span> tmp12 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> tmp13 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> tmp14 = matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> tmp15 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> tmp16 = matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> tmp17 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> tmp18 = matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">13</span> ];
            <span class="hljs-keyword">var</span> tmp19 = matrix[ <span class="hljs-number">12</span> ] * matrix[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> tmp20 = matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> tmp21 = matrix[ <span class="hljs-number">8</span> ] * matrix[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> tmp22= matrix[ <span class="hljs-number">0</span> ] * matrix[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> tmp23= matrix[ <span class="hljs-number">4</span> ] * matrix[ <span class="hljs-number">1</span> ];

            <span class="hljs-keyword">var</span> t0 = ( ( tmp0 * matrix[ <span class="hljs-number">5</span> ] + tmp3 * matrix[ <span class="hljs-number">9</span> ] + tmp4 * matrix[ <span class="hljs-number">13</span> ] ) -
                ( tmp1 * matrix[ <span class="hljs-number">5</span> ] + tmp2 * matrix[ <span class="hljs-number">9</span> ] + tmp5 * matrix[ <span class="hljs-number">13</span> ] ) );
            <span class="hljs-keyword">var</span> t1 = ( ( tmp1 * matrix[ <span class="hljs-number">1</span> ] + tmp6  * matrix[ <span class="hljs-number">9</span> ] + tmp9 * matrix[ <span class="hljs-number">13</span> ] ) -
                ( tmp0 * matrix[ <span class="hljs-number">1</span> ] + tmp7 * matrix[ <span class="hljs-number">9</span> ] + tmp8 * matrix[ <span class="hljs-number">13</span> ] ) );
            <span class="hljs-keyword">var</span> t2 = ( ( tmp2 * matrix[ <span class="hljs-number">1</span> ] + tmp7 * matrix[ <span class="hljs-number">5</span> ] + tmp10 * matrix[ <span class="hljs-number">13</span> ] ) -
                ( tmp3 * matrix[ <span class="hljs-number">1</span> ] + tmp6  * matrix[ <span class="hljs-number">5</span> ] + tmp11 * matrix[ <span class="hljs-number">13</span> ] ) );
            <span class="hljs-keyword">var</span> t3 = ( ( tmp5 * matrix[ <span class="hljs-number">1</span> ] + tmp8 * matrix[ <span class="hljs-number">5</span> ] + tmp11 * matrix[ <span class="hljs-number">9</span> ] ) -
                ( tmp4 * matrix[ <span class="hljs-number">1</span> ] + tmp9 * matrix[ <span class="hljs-number">5</span> ] + tmp10 * matrix[ <span class="hljs-number">9</span> ] ) );

            <span class="hljs-keyword">var</span> d1 = ( matrix[ <span class="hljs-number">0</span> ] * t0 + matrix[ <span class="hljs-number">4</span> ] * t1 + matrix[ <span class="hljs-number">8</span> ] * t2 + matrix[ <span class="hljs-number">12</span> ] * t3 );
            <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( d1 ) &lt; <span class="hljs-number">1e-5</span> ) {
                Notify.log( <span class="hljs-string">'Warning can\'t inverse matrix '</span> + matrix );
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">var</span> d = <span class="hljs-number">1.0</span> / d1;

            <span class="hljs-keyword">var</span> out00 = d * t0;
            <span class="hljs-keyword">var</span> out01 = d * t1;
            <span class="hljs-keyword">var</span> out02 = d * t2;
            <span class="hljs-keyword">var</span> out03 = d * t3;

            <span class="hljs-keyword">var</span> out10 = d * ( ( tmp1 * matrix[ <span class="hljs-number">4</span> ] + tmp2 * matrix[ <span class="hljs-number">8</span> ] + tmp5 * matrix[ <span class="hljs-number">12</span> ] ) -
                ( tmp0 * matrix[ <span class="hljs-number">4</span> ] + tmp3 * matrix[ <span class="hljs-number">8</span> ] + tmp4 * matrix[ <span class="hljs-number">12</span> ] ) );
            <span class="hljs-keyword">var</span> out11 = d * ( ( tmp0 * matrix[ <span class="hljs-number">0</span> ] + tmp7 * matrix[ <span class="hljs-number">8</span> ] + tmp8 * matrix[ <span class="hljs-number">12</span> ] ) -
                ( tmp1 * matrix[ <span class="hljs-number">0</span> ] + tmp6  * matrix[ <span class="hljs-number">8</span> ] + tmp9 * matrix[ <span class="hljs-number">12</span> ] ) );
            <span class="hljs-keyword">var</span> out12 = d * ( ( tmp3 * matrix[ <span class="hljs-number">0</span> ] + tmp6  * matrix[ <span class="hljs-number">4</span> ] + tmp11 * matrix[ <span class="hljs-number">12</span> ] ) -
                ( tmp2 * matrix[ <span class="hljs-number">0</span> ] + tmp7 * matrix[ <span class="hljs-number">4</span> ] + tmp10 * matrix[ <span class="hljs-number">12</span> ] ) );
            <span class="hljs-keyword">var</span> out13 = d * ( ( tmp4 * matrix[ <span class="hljs-number">0</span> ] + tmp9 * matrix[ <span class="hljs-number">4</span> ] + tmp10 * matrix[ <span class="hljs-number">8</span> ] ) -
                ( tmp5 * matrix[ <span class="hljs-number">0</span> ] + tmp8 * matrix[ <span class="hljs-number">4</span> ] + tmp11 * matrix[ <span class="hljs-number">8</span> ] ) );

            <span class="hljs-keyword">var</span> out20 = d * ( ( tmp12 * matrix[ <span class="hljs-number">7</span> ] + tmp15 * matrix[ <span class="hljs-number">11</span> ] + tmp16 * matrix[ <span class="hljs-number">15</span> ] ) -
                ( tmp13 * matrix[ <span class="hljs-number">7</span> ] + tmp14* matrix[ <span class="hljs-number">11</span> ] + tmp17 * matrix[ <span class="hljs-number">15</span> ] ) );
            <span class="hljs-keyword">var</span> out21 = d * ( ( tmp13 * matrix[ <span class="hljs-number">3</span> ] + tmp18 * matrix[ <span class="hljs-number">11</span> ] + tmp21 * matrix[ <span class="hljs-number">15</span> ] ) -
                ( tmp12 * matrix[ <span class="hljs-number">3</span> ] + tmp19 * matrix[ <span class="hljs-number">11</span> ] + tmp20 * matrix[ <span class="hljs-number">15</span> ] ) );
            <span class="hljs-keyword">var</span> out22 = d * ( ( tmp14* matrix[ <span class="hljs-number">3</span> ] + tmp19 * matrix[ <span class="hljs-number">7</span> ] + tmp22* matrix[ <span class="hljs-number">15</span> ] ) -
                ( tmp15 * matrix[ <span class="hljs-number">3</span> ] + tmp18 * matrix[ <span class="hljs-number">7</span> ] + tmp23* matrix[ <span class="hljs-number">15</span> ] ) );
            <span class="hljs-keyword">var</span> out23 = d * ( ( tmp17 * matrix[ <span class="hljs-number">3</span> ] + tmp20 * matrix[ <span class="hljs-number">7</span> ] + tmp23* matrix[ <span class="hljs-number">11</span> ] ) -
                ( tmp16 * matrix[ <span class="hljs-number">3</span> ] + tmp21 * matrix[ <span class="hljs-number">7</span> ] + tmp22* matrix[ <span class="hljs-number">11</span> ] ) );

            <span class="hljs-keyword">var</span> out30 = d * ( ( tmp14* matrix[ <span class="hljs-number">10</span> ] + tmp17 * matrix[ <span class="hljs-number">14</span> ] + tmp13 * matrix[ <span class="hljs-number">6</span> ] ) -
                ( tmp16 * matrix[ <span class="hljs-number">14</span> ] + tmp12 * matrix[ <span class="hljs-number">6</span> ] + tmp15 * matrix[ <span class="hljs-number">10</span> ] ) );
            <span class="hljs-keyword">var</span> out31 = d * ( ( tmp20 * matrix[ <span class="hljs-number">14</span> ] + tmp12 * matrix[ <span class="hljs-number">2</span> ] + tmp19 * matrix[ <span class="hljs-number">10</span> ] ) -
                ( tmp18 * matrix[ <span class="hljs-number">10</span> ] + tmp21 * matrix[ <span class="hljs-number">14</span> ] + tmp13 * matrix[ <span class="hljs-number">2</span> ] ) );
            <span class="hljs-keyword">var</span> out32 = d * ( ( tmp18 * matrix[ <span class="hljs-number">6</span> ] + tmp23* matrix[ <span class="hljs-number">14</span> ] + tmp15 * matrix[ <span class="hljs-number">2</span> ] ) -
                ( tmp22* matrix[ <span class="hljs-number">14</span> ] + tmp14 * matrix[ <span class="hljs-number">2</span> ] + tmp19 * matrix[ <span class="hljs-number">6</span> ] ) );
            <span class="hljs-keyword">var</span> out33 = d * ( ( tmp22* matrix[ <span class="hljs-number">10</span> ] + tmp16 * matrix[ <span class="hljs-number">2</span> ] + tmp21 * matrix[ <span class="hljs-number">6</span> ] ) -
                ( tmp20 * matrix[ <span class="hljs-number">6</span> ] + tmp23* matrix[ <span class="hljs-number">10</span> ] + tmp17 * matrix[ <span class="hljs-number">2</span> ] ) );

            result[ <span class="hljs-number">0</span> ] = out00;
            result[ <span class="hljs-number">1</span> ] = out01;
            result[ <span class="hljs-number">2</span> ] = out02;
            result[ <span class="hljs-number">3</span> ] = out03;
            result[ <span class="hljs-number">4</span> ] = out10;
            result[ <span class="hljs-number">5</span> ] = out11;
            result[ <span class="hljs-number">6</span> ] = out12;
            result[ <span class="hljs-number">7</span> ] = out13;
            result[ <span class="hljs-number">8</span> ] = out20;
            result[ <span class="hljs-number">9</span> ] = out21;
            result[ <span class="hljs-number">10</span> ] = out22;
            result[ <span class="hljs-number">11</span> ] = out23;
            result[ <span class="hljs-number">12</span> ] = out30;
            result[ <span class="hljs-number">13</span> ] = out31;
            result[ <span class="hljs-number">14</span> ] = out32;
            result[ <span class="hljs-number">15</span> ] = out33;

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>comes from OpenSceneGraph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/*
      Matrix inversion technique:
      Given a matrix mat, we want to invert it.
      mat = [ r00 r01 r02 a
              r10 r11 r12 b
              r20 r21 r22 c
              tx  ty  tz  d ]
      We note that this matrix can be split into three matrices.
      mat = rot * trans * corr, where rot is rotation part, trans is translation part, and corr is the correction due to perspective (if any).
      rot = [ r00 r01 r02 0
              r10 r11 r12 0
              r20 r21 r22 0
              0   0   0   1 ]
      trans = [ 1  0  0  0
                0  1  0  0
                0  0  1  0
                tx ty tz 1 ]
      corr = [ 1 0 0 px
               0 1 0 py
               0 0 1 pz
               0 0 0 s ]

      where the elements of corr are obtained from linear combinations of the elements of rot, trans, and mat.
      So the inverse is mat' = (trans * corr)' * rot', where rot' must be computed the traditional way, which is easy since it is only a 3x3 matrix.
      This problem is simplified if [px py pz s] = [0 0 0 1], which will happen if mat was composed only of rotations, scales, and translations (which is common).  In this case, we can ignore corr entirely which saves on a lot of computations.
    */</span>

        inverse4x3: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Copy rotation components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> r00 = matrix[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> r01 = matrix[ <span class="hljs-number">1</span> ];
            <span class="hljs-keyword">var</span> r02 = matrix[ <span class="hljs-number">2</span> ];

            <span class="hljs-keyword">var</span> r10 = matrix[ <span class="hljs-number">4</span> ];
            <span class="hljs-keyword">var</span> r11 = matrix[ <span class="hljs-number">5</span> ];
            <span class="hljs-keyword">var</span> r12 = matrix[ <span class="hljs-number">6</span> ];

            <span class="hljs-keyword">var</span> r20 = matrix[ <span class="hljs-number">8</span> ];
            <span class="hljs-keyword">var</span> r21 = matrix[ <span class="hljs-number">9</span> ];
            <span class="hljs-keyword">var</span> r22 = matrix[ <span class="hljs-number">10</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Partially compute inverse of rot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            result[ <span class="hljs-number">0</span> ] = r11 * r22 - r12 * r21;
            result[ <span class="hljs-number">1</span> ] = r02 * r21 - r01 * r22;
            result[ <span class="hljs-number">2</span> ] = r01 * r12 - r02 * r11;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Compute determinant of rot from 3 elements just computed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> oneOverDet = <span class="hljs-number">1.0</span> / ( r00 * result[ <span class="hljs-number">0</span> ] + r10 * result[ <span class="hljs-number">1</span> ] + r20 * result[ <span class="hljs-number">2</span> ] );
            r00 *= oneOverDet;
            r10 *= oneOverDet;
            r20 *= oneOverDet; <span class="hljs-comment">// Saves on later computations</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Finish computing inverse of rot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            result[ <span class="hljs-number">0</span> ] *= oneOverDet;
            result[ <span class="hljs-number">1</span> ] *= oneOverDet;
            result[ <span class="hljs-number">2</span> ] *= oneOverDet;
            result[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">4</span> ] = r12 * r20 - r10 * r22; <span class="hljs-comment">// Have already been divided by det</span>
            result[ <span class="hljs-number">5</span> ] = r00 * r22 - r02 * r20; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">6</span> ] = r02 * r10 - r00 * r12; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">8</span> ] = r10 * r21 - r11 * r20; <span class="hljs-comment">// Have already been divided by det</span>
            result[ <span class="hljs-number">9</span> ] = r01 * r20 - r00 * r21; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">10</span> ] = r00 * r11 - r01 * r10; <span class="hljs-comment">// same</span>
            result[ <span class="hljs-number">11</span> ] = <span class="hljs-number">0.0</span>;
            result[ <span class="hljs-number">15</span> ] = <span class="hljs-number">1.0</span>;

            <span class="hljs-keyword">var</span> tx, ty, tz;

            <span class="hljs-keyword">var</span> d = matrix[ <span class="hljs-number">15</span> ];
            <span class="hljs-keyword">var</span> dm = d - <span class="hljs-number">1.0</span>;
            <span class="hljs-keyword">if</span> ( dm * dm &gt; <span class="hljs-number">1.0e-6</span> ) <span class="hljs-comment">// Involves perspective, so we must</span>
            { <span class="hljs-comment">// compute the full inverse</span>

                <span class="hljs-keyword">var</span> inv = Matrix._tmp0;
                result[ <span class="hljs-number">12</span> ] = result[ <span class="hljs-number">13</span> ] = result[ <span class="hljs-number">14</span> ] = <span class="hljs-number">0.0</span>;

                <span class="hljs-keyword">var</span> a = matrix[ <span class="hljs-number">3</span> ];
                <span class="hljs-keyword">var</span> b = matrix[ <span class="hljs-number">7</span> ];
                <span class="hljs-keyword">var</span> c = matrix[ <span class="hljs-number">11</span> ];
                <span class="hljs-keyword">var</span> px = result[ <span class="hljs-number">0</span> ] * a + result[ <span class="hljs-number">1</span> ] * b + result[ <span class="hljs-number">2</span> ] * c;
                <span class="hljs-keyword">var</span> py = result[ <span class="hljs-number">4</span> ] * a + result[ <span class="hljs-number">5</span> ] * b + result[ <span class="hljs-number">6</span> ] * c;
                <span class="hljs-keyword">var</span> pz = result[ <span class="hljs-number">8</span> ] * a + result[ <span class="hljs-number">9</span> ] * b + result[ <span class="hljs-number">10</span> ] * c;

                tx = matrix[ <span class="hljs-number">12</span> ];
                ty = matrix[ <span class="hljs-number">13</span> ];
                tz = matrix[ <span class="hljs-number">14</span> ];
                <span class="hljs-keyword">var</span> oneOverS = <span class="hljs-number">1.0</span> / ( d - ( tx * px + ty * py + tz * pz ) );

                tx *= oneOverS;
                ty *= oneOverS;
                tz *= oneOverS; <span class="hljs-comment">// Reduces number of calculations later on</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Compute inverse of trans*corr</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                inv[ <span class="hljs-number">0</span> ] = tx * px + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">1</span> ] = ty * px;
                inv[ <span class="hljs-number">2</span> ] = tz * px;
                inv[ <span class="hljs-number">3</span> ] = -px * oneOverS;
                inv[ <span class="hljs-number">4</span> ] = tx * py;
                inv[ <span class="hljs-number">5</span> ] = ty * py + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">6</span> ] = tz * py;
                inv[ <span class="hljs-number">7</span> ] = -py * oneOverS;
                inv[ <span class="hljs-number">8</span> ] = tx * pz;
                inv[ <span class="hljs-number">9</span> ] = ty * pz;
                inv[ <span class="hljs-number">10</span> ] = tz * pz + <span class="hljs-number">1.0</span>;
                inv[ <span class="hljs-number">11</span> ] = -pz * oneOverS;
                inv[ <span class="hljs-number">12</span> ] = -tx;
                inv[ <span class="hljs-number">13</span> ] = -ty;
                inv[ <span class="hljs-number">14</span> ] = -tz;
                inv[ <span class="hljs-number">15</span> ] = oneOverS;

                Matrix.preMult( result, inv ); <span class="hljs-comment">// Finish computing full inverse of mat</span>
            } <span class="hljs-keyword">else</span> {

                tx = matrix[ <span class="hljs-number">12</span> ];
                ty = matrix[ <span class="hljs-number">13</span> ];
                tz = matrix[ <span class="hljs-number">14</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Compute translation components of mat</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                result[ <span class="hljs-number">12</span> ] = -( tx * result[ <span class="hljs-number">0</span> ] + ty * result[ <span class="hljs-number">4</span> ] + tz * result[ <span class="hljs-number">8</span> ] );
                result[ <span class="hljs-number">13</span> ] = -( tx * result[ <span class="hljs-number">1</span> ] + ty * result[ <span class="hljs-number">5</span> ] + tz * result[ <span class="hljs-number">9</span> ] );
                result[ <span class="hljs-number">14</span> ] = -( tx * result[ <span class="hljs-number">2</span> ] + ty * result[ <span class="hljs-number">6</span> ] + tz * result[ <span class="hljs-number">10</span> ] );
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        },

        transpose: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( mat, dest )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>from glMatrix
If we are transposing ourselves we can skip a few steps but have to cache some values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( mat === dest ) {
                <span class="hljs-keyword">var</span> a01 = mat[ <span class="hljs-number">1</span> ],
                    a02 = mat[ <span class="hljs-number">2</span> ],
                    a03 = mat[ <span class="hljs-number">3</span> ];
                <span class="hljs-keyword">var</span> a12 = mat[ <span class="hljs-number">6</span> ],
                    a13 = mat[ <span class="hljs-number">7</span> ];
                <span class="hljs-keyword">var</span> a23 = mat[ <span class="hljs-number">11</span> ];

                mat[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">4</span> ];
                mat[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">8</span> ];
                mat[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">12</span> ];
                mat[ <span class="hljs-number">4</span> ] = a01;
                mat[ <span class="hljs-number">6</span> ] = mat[ <span class="hljs-number">9</span> ];
                mat[ <span class="hljs-number">7</span> ] = mat[ <span class="hljs-number">13</span> ];
                mat[ <span class="hljs-number">8</span> ] = a02;
                mat[ <span class="hljs-number">9</span> ] = a12;
                mat[ <span class="hljs-number">11</span> ] = mat[ <span class="hljs-number">14</span> ];
                mat[ <span class="hljs-number">12</span> ] = a03;
                mat[ <span class="hljs-number">13</span> ] = a13;
                mat[ <span class="hljs-number">14</span> ] = a23;
                <span class="hljs-keyword">return</span> mat;
            } <span class="hljs-keyword">else</span> {
                dest[ <span class="hljs-number">0</span> ] = mat[ <span class="hljs-number">0</span> ];
                dest[ <span class="hljs-number">1</span> ] = mat[ <span class="hljs-number">4</span> ];
                dest[ <span class="hljs-number">2</span> ] = mat[ <span class="hljs-number">8</span> ];
                dest[ <span class="hljs-number">3</span> ] = mat[ <span class="hljs-number">12</span> ];
                dest[ <span class="hljs-number">4</span> ] = mat[ <span class="hljs-number">1</span> ];
                dest[ <span class="hljs-number">5</span> ] = mat[ <span class="hljs-number">5</span> ];
                dest[ <span class="hljs-number">6</span> ] = mat[ <span class="hljs-number">9</span> ];
                dest[ <span class="hljs-number">7</span> ] = mat[ <span class="hljs-number">13</span> ];
                dest[ <span class="hljs-number">8</span> ] = mat[ <span class="hljs-number">2</span> ];
                dest[ <span class="hljs-number">9</span> ] = mat[ <span class="hljs-number">6</span> ];
                dest[ <span class="hljs-number">10</span> ] = mat[ <span class="hljs-number">10</span> ];
                dest[ <span class="hljs-number">11</span> ] = mat[ <span class="hljs-number">14</span> ];
                dest[ <span class="hljs-number">12</span> ] = mat[ <span class="hljs-number">3</span> ];
                dest[ <span class="hljs-number">13</span> ] = mat[ <span class="hljs-number">7</span> ];
                dest[ <span class="hljs-number">14</span> ] = mat[ <span class="hljs-number">11</span> ];
                dest[ <span class="hljs-number">15</span> ] = mat[ <span class="hljs-number">15</span> ];
                <span class="hljs-keyword">return</span> dest;
            }
        },

        makePerspective: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( fovy, aspect, znear, zfar, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            <span class="hljs-keyword">var</span> ymax = znear * <span class="hljs-built_in">Math</span>.tan( fovy * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">360.0</span> );
            <span class="hljs-keyword">var</span> ymin = -ymax;
            <span class="hljs-keyword">var</span> xmin = ymin * aspect;
            <span class="hljs-keyword">var</span> xmax = ymax * aspect;

            <span class="hljs-keyword">return</span> Matrix.makeFrustum( xmin, xmax, ymin, ymax, znear, zfar, result );
        },

        getFrustum: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            <span class="hljs-keyword">var</span> right = <span class="hljs-number">0.0</span>;
            <span class="hljs-keyword">var</span> left = <span class="hljs-number">0.0</span>;
            <span class="hljs-keyword">var</span> top = <span class="hljs-number">0.0</span>;
            <span class="hljs-keyword">var</span> bottom = <span class="hljs-number">0.0</span>;
            <span class="hljs-keyword">var</span> zNear,zFar;

            <span class="hljs-keyword">if</span> ( matrix[ <span class="hljs-number">0</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> || matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> || matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== -<span class="hljs-number">1.0</span> || matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">3</span> ] !== <span class="hljs-number">0.0</span> ) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>note: near and far must be used inside this method instead of zNear and zFar
because zNear and zFar are references and they may point to the same variable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> tempNear = matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] / ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] - <span class="hljs-number">1.0</span> );
            <span class="hljs-keyword">var</span> tempFar = matrix[ <span class="hljs-number">3</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] / ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] );

            left = tempNear * ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> ] - <span class="hljs-number">1.0</span> ) / matrix[ <span class="hljs-number">0</span> ];
            right = tempNear * ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> ] ) / matrix[ <span class="hljs-number">0</span> ];

            top = tempNear * ( <span class="hljs-number">1.0</span> + matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] ) / matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];
            bottom = tempNear * ( matrix[ <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] - <span class="hljs-number">1.0</span> ) / matrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];

            zNear = tempNear;
            zFar = tempFar;

            result.left = left;
            result.right = right;
            result.top = top;
            result.bottom = bottom;
            result.zNear = zNear;
            result.zFar = zFar;

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        },

        getPerspective: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, result )</span> {</span>
            <span class="hljs-keyword">var</span> c = {
                <span class="hljs-string">'right'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'left'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'top'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'bottom'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'zNear'</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">'zFar'</span>: <span class="hljs-number">0</span>
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>get frustum and compute results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>.getFrustum( matrix, c );
            <span class="hljs-keyword">if</span> ( r ) {
                result.fovy = <span class="hljs-number">180</span> / <span class="hljs-built_in">Math</span>.PI * ( <span class="hljs-built_in">Math</span>.atan( c.top / c.zNear ) - <span class="hljs-built_in">Math</span>.atan( c.bottom / c.zNear ) );
                result.aspectRatio = ( c.right - c.left ) / ( c.top - c.bottom );
            }
            result.zNear = c.zNear;
            result.zFar = c.zFar;
            <span class="hljs-keyword">return</span> result;
        },

        makeScale: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( x, y, z, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">0</span>, x, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, y, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, z, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span> );
            <span class="hljs-keyword">return</span> result;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>compute the 4 corners vector of the frustrum</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        computeFrustrumCornersVectors: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( projectionMatrix, vectorsArray )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>var znear = projectionMatrix[ 12 + 2 ] / ( projectionMatrix[ 8 + 2 ] - 1.0 );
var zfar = projectionMatrix[ 12 + 2 ] / ( projectionMatrix[ 8 + 2 ] + 1.0 );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> x = <span class="hljs-number">1.0</span> / projectionMatrix[ <span class="hljs-number">0</span> ];
            <span class="hljs-keyword">var</span> y = <span class="hljs-number">1.0</span> / projectionMatrix[ <span class="hljs-number">1</span> * <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ];

            vectorsArray[ <span class="hljs-number">0</span> ] = [ -x, y, <span class="hljs-number">1.0</span> ];
            vectorsArray[ <span class="hljs-number">1</span> ] = [ -x, -y, <span class="hljs-number">1.0</span> ];
            vectorsArray[ <span class="hljs-number">2</span> ] = [ x, -y, <span class="hljs-number">1.0</span> ];
            vectorsArray[ <span class="hljs-number">3</span> ] = [ x, y, <span class="hljs-number">1.0</span> ];
            <span class="hljs-keyword">return</span> vectorsArray;
        },

        makeFrustum: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( left, right,
            bottom, top,
            znear, zfar, result )</span> {</span>
            <span class="hljs-keyword">if</span> ( result === <span class="hljs-literal">undefined</span> ) {
                result = [];
            }
            <span class="hljs-keyword">var</span> X = <span class="hljs-number">2</span> * znear / ( right - left );
            <span class="hljs-keyword">var</span> Y = <span class="hljs-number">2</span> * znear / ( top - bottom );
            <span class="hljs-keyword">var</span> A = ( right + left ) / ( right - left );
            <span class="hljs-keyword">var</span> B = ( top + bottom ) / ( top - bottom );
            <span class="hljs-keyword">var</span> C = -( zfar + znear ) / ( zfar - znear );
            <span class="hljs-keyword">var</span> D = -<span class="hljs-number">2</span> * zfar * znear / ( zfar - znear );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">0</span>, X, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, Y, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">2</span>, A, B, C, -<span class="hljs-number">1</span> );
            <span class="hljs-keyword">this</span>.setRow( result, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, D, <span class="hljs-number">0</span> );
            <span class="hljs-keyword">return</span> result;
        },

        makeRotateFromQuat: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( quat, result )</span> {</span>
            <span class="hljs-keyword">this</span>.makeIdentity( result );
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setRotateFromQuat( result, quat );
        },

        setRotateFromQuat: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( matrix, quat )</span> {</span>
            <span class="hljs-keyword">var</span> length2 = Quat.length2( quat );
            <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.abs( length2 ) &lt;= <span class="hljs-built_in">Number</span>.MIN_VALUE ) {
                matrix[ <span class="hljs-number">0</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">1</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">2</span> ] = <span class="hljs-number">0.0</span>;

                matrix[ <span class="hljs-number">4</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">5</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">6</span> ] = <span class="hljs-number">0.0</span>;

                matrix[ <span class="hljs-number">8</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">9</span> ] = <span class="hljs-number">0.0</span>;
                matrix[ <span class="hljs-number">10</span> ] = <span class="hljs-number">0.0</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> rlength2;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>normalize quat if required.
We can avoid the expensive sqrt in this case since all coefficients below are products of two q components.
That is a square of a square root, so it is possible to avoid that</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> ( length2 !== <span class="hljs-number">1.0</span> ) {
                    rlength2 = <span class="hljs-number">2.0</span> / length2;
                } <span class="hljs-keyword">else</span> {
                    rlength2 = <span class="hljs-number">2.0</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Source: Gamasutra, Rotating Objects Using Quaternions</p>
<p><a href="http://www.gamasutra.com/features/19980703/quaternions_01.htm">http://www.gamasutra.com/features/19980703/quaternions_01.htm</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">var</span> wx, wy, wz, xx, yy, yz, xy, xz, zz, x2, y2, z2;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>calculate coefficients</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                x2 = rlength2 * quat[ <span class="hljs-number">0</span> ];
                y2 = rlength2 * quat[ <span class="hljs-number">1</span> ];
                z2 = rlength2 * quat[ <span class="hljs-number">2</span> ];

                xx = quat[ <span class="hljs-number">0</span> ] * x2;
                xy = quat[ <span class="hljs-number">0</span> ] * y2;
                xz = quat[ <span class="hljs-number">0</span> ] * z2;

                yy = quat[ <span class="hljs-number">1</span> ] * y2;
                yz = quat[ <span class="hljs-number">1</span> ] * z2;
                zz = quat[ <span class="hljs-number">2</span> ] * z2;

                wx = quat[ <span class="hljs-number">3</span> ] * x2;
                wy = quat[ <span class="hljs-number">3</span> ] * y2;
                wz = quat[ <span class="hljs-number">3</span> ] * z2;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Note.  Gamasutra gets the matrix assignments inverted, resulting
in left-handed rotations, which is contrary to OpenGL and OSGs
methodology.  The matrix assignment has been altered in the next
few lines of code to do the right thing.
Don Burns - Oct 13, 2001</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                matrix[ <span class="hljs-number">0</span> ] = <span class="hljs-number">1.0</span> - ( yy + zz );
                matrix[ <span class="hljs-number">4</span> ] = xy - wz;
                matrix[ <span class="hljs-number">8</span> ] = xz + wy;


                matrix[ <span class="hljs-number">0</span> + <span class="hljs-number">1</span> ] = xy + wz;
                matrix[ <span class="hljs-number">4</span> + <span class="hljs-number">1</span> ] = <span class="hljs-number">1.0</span> - ( xx + zz );
                matrix[ <span class="hljs-number">8</span> + <span class="hljs-number">1</span> ] = yz - wx;

                matrix[ <span class="hljs-number">0</span> + <span class="hljs-number">2</span> ] = xz - wy;
                matrix[ <span class="hljs-number">4</span> + <span class="hljs-number">2</span> ] = yz + wx;
                matrix[ <span class="hljs-number">8</span> + <span class="hljs-number">2</span> ] = <span class="hljs-number">1.0</span> - ( xx + yy );
            }
            <span class="hljs-keyword">return</span> matrix;
        }
    };

    <span class="hljs-keyword">return</span> Matrix;
} );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
