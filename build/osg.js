// osg-0.1.0.js commit 64c57d928295867afabb56810770b3de3e51b10f - http://github.com/cedricpinson/osgjs
var osg={version:"0.1.0",copyright:"Cedric Pinson - cedric.pinson@plopbyte.com",log:function(a){window.console!==void 0&&window.console.log(a)},info:function(a){window.console!==void 0&&window.console.info(a)},warn:function(a){window.console!==void 0&&window.console.warn(a)},debug:function(a){window.console!==void 0&&window.console.debug(a)},DEBUG:0,INFO:1,NOTICE:2,WARN:3};
osg.setNotifyLevel=function(a){var c=function(){};osg.debug=c;osg.info=c;osg.log=c;osg.warn=c;if(a<=osg.DEBUG)osg.debug=function(a){window.console!==void 0&&window.console.debug(a)};if(a<=osg.INFO)osg.info=function(a){window.console!==void 0&&window.console.info(a)};if(a<=osg.NOTICE)osg.log=function(a){window.console!==void 0&&window.console.log(a)};if(a<=osg.WARN)osg.warn=function(a){window.console!==void 0&&window.console.warn(a)}};osg.reportWebGLError=!1;osg.init=function(){osg.setNotifyLevel(osg.NOTICE)};
osg.isArray=function(a){return toString.call(a)==="[object Array]"};
osg.extend=function(){var a=Object.prototype.toString,c=Object.prototype.hasOwnProperty,e=osg.isArray,f=function(e){if(!e||a.call(e)!=="[object Object]"||e.nodeType||e.setInterval)return!1;if(e.constructor&&!c.call(e,"constructor")&&!c.call(e.constructor.prototype,"isPrototypeOf"))return!1;for(var f in e);return f===void 0||c.call(e,f)},g=arguments[0]||{},h=1,j=arguments.length,i=!1,k,m,n,p;typeof g==="boolean"&&(i=g,g=arguments[1]||{},h=2);typeof g!=="object"&&a.call(g)!=="[object Function]"&&(g=
{});j===h&&(g=this,--h);for(;h<j;h++)if((k=arguments[h])!==null)for(m in k)n=g[m],p=k[m],g!==p&&(i&&p&&(f(p)||e(p))?(n=n&&(f(n)||e(n))?n:e(p)?[]:{},g[m]=osg.extend(i,n,p)):p!==void 0&&(g[m]=p));return g};osg.objectInehrit=function(a,c){function e(){}e.prototype=a;var f=new e;c&&osg.objectMix(f,c,!1);return f};osg.objectMix=function(a,c,e){for(var f in c)if(!e||!a[f])a[f]=c[f];return a};osg.objectType={};osg.objectType.type=0;
osg.objectType.generate=function(a){var c=osg.objectType.type;osg.objectType[c]=a;osg.objectType[a]=c;osg.objectType.type+=1;return c};osg.Float32Array=Float32Array;osg.Int32Array=Int32Array;osg.Uint16Array=Uint16Array;
osg.Vec2={copy:function(a,c){c[0]=a[0];c[1]=a[1];return c},valid:function(a){return isNaN(a[0])?!1:isNaN(a[1])?!1:!0},mult:function(a,c,e){e[0]=a[0]*c;e[1]=a[1]*c;return e},length2:function(a){return a[0]*a[0]+a[1]*a[1]},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},distance:function(a,c){var e=a[0]-c[0],f=a[1]-c[1];return Math.sqrt(e*e+f*f)},normalize:function(a,c){var e=this.length2(a);e>0?(e=1/Math.sqrt(e),c[0]=a[0]*e,c[1]=a[1]*e):(c[0]=a[0],c[1]=a[1]);return c},dot:function(a,c){return a[0]*
c[0]+a[1]*c[1]},sub:function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];return e},add:function(a,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];return e},neg:function(a,c){c[0]=-a[0];c[1]=-a[1];return c},lerp:function(a,c,e,f){var g=1-a;f[0]=c[0]*g+a*e[0];f[1]=c[1]*g+a*e[1];return f}};
osg.Vec3={init:function(a){a[0]=0;a[1]=0;a[2]=0;return a},copy:function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},cross:function(a,c,e){var f=a[2]*c[0]-a[0]*c[2],g=a[0]*c[1]-a[1]*c[0];e[0]=a[1]*c[2]-a[2]*c[1];e[1]=f;e[2]=g;return e},valid:function(a){return isNaN(a[0])?!1:isNaN(a[1])?!1:isNaN(a[2])?!1:!0},mult:function(a,c,e){e[0]=a[0]*c;e[1]=a[1]*c;e[2]=a[2]*c;return e},length2:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},
distance:function(a,c){var e=a[0]-c[0],f=a[1]-c[1],g=a[2]-c[2];return Math.sqrt(e*e+f*f+g*g)},normalize:function(a,c){var e=this.length2(a);e>0?(e=1/Math.sqrt(e),c[0]=a[0]*e,c[1]=a[1]*e,c[2]=a[2]*e):(c[0]=a[0],c[1]=a[1],c[2]=a[2]);return c},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]},sub:function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];e[2]=a[2]-c[2];return e},add:function(a,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];return e},neg:function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c},
lerp:function(a,c,e,f){f[0]=c[0]+(e[0]-c[0])*a;f[1]=c[1]+(e[1]-c[1])*a;f[2]=c[2]+(e[2]-c[2])*a;return f}};
osg.Vec4={dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]},copy:function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},sub:function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];e[2]=a[2]-c[2];e[3]=a[3]-c[3];return e},mult:function(a,c){r[0]=a[0]*c;r[1]=a[1]*c;r[2]=a[2]*c;r[3]=a[3]*c;return r},add:function(a,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];e[3]=a[3]+c[3];return e},neg:function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c},lerp:function(a,c,e,f){var g=
1-a;f[0]=c[0]*g+a*e[0];f[1]=c[1]*g+a*e[1];f[2]=c[2]*g+a*e[2];f[3]=c[3]*g+a*e[3];return f}};osg.Object=function(){this._userdata=this._name=void 0};osg.Object.prototype={className:function(){return this._className},setName:function(a){this._name=a},getName:function(){return this._name},setUserData:function(a){this._userdata=a},getUserData:function(){return this._userdata}};
osg.Matrix={_tmp0:[],_tmp1:[],valid:function(a){for(var c=0;c<16;c++)if(isNaN(a[c]))return!1;return!0},setRow:function(a,c,e,f,g,h){c*=4;a[c+0]=e;a[c+1]=f;a[c+2]=g;a[c+3]=h},innerProduct:function(a,c,e,f){e*=4;return a[e+0]*c[0+f]+a[e+1]*c[4+f]+a[e+2]*c[8+f]+a[e+3]*c[12+f]},set:function(a,c,e,f){return a[c*4+e]=f},get:function(a,c,e){return a[c*4+e]},makeIdentity:function(a){a===void 0&&(a=[],osg.log("osg.Matrix.makeIdentity without matrix destination is deprecated"));osg.Matrix.setRow(a,0,1,0,0,
0);osg.Matrix.setRow(a,1,0,1,0,0);osg.Matrix.setRow(a,2,0,0,1,0);osg.Matrix.setRow(a,3,0,0,0,1);return a},makeTranslate:function(a,c,e,f){f===void 0&&(f=[]);osg.Matrix.setRow(f,0,1,0,0,0);osg.Matrix.setRow(f,1,0,1,0,0);osg.Matrix.setRow(f,2,0,0,1,0);osg.Matrix.setRow(f,3,a,c,e,1);return f},setTrans:function(a,c,e,f){a[12]=c;a[13]=e;a[14]=f;return a},getTrans:function(a,c){c[0]=a[12];c[1]=a[13];c[2]=a[14];return c},preMult:function(a,c){var e,f,g,h;e=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];f=c[4]*
a[0]+c[5]*a[4]+c[6]*a[8]+c[7]*a[12];g=c[8]*a[0]+c[9]*a[4]+c[10]*a[8]+c[11]*a[12];h=c[12]*a[0]+c[13]*a[4]+c[14]*a[8]+c[15]*a[12];a[0]=e;a[4]=f;a[8]=g;a[12]=h;e=c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13];f=c[4]*a[1]+c[5]*a[5]+c[6]*a[9]+c[7]*a[13];g=c[8]*a[1]+c[9]*a[5]+c[10]*a[9]+c[11]*a[13];h=c[12]*a[1]+c[13]*a[5]+c[14]*a[9]+c[15]*a[13];a[1]=e;a[5]=f;a[9]=g;a[13]=h;e=c[0]*a[2]+c[1]*a[6]+c[2]*a[10]+c[3]*a[14];f=c[4]*a[2]+c[5]*a[6]+c[6]*a[10]+c[7]*a[14];g=c[8]*a[2]+c[9]*a[6]+c[10]*a[10]+c[11]*a[14];h=c[12]*
a[2]+c[13]*a[6]+c[14]*a[10]+c[15]*a[14];a[2]=e;a[6]=f;a[10]=g;a[14]=h;e=c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15];f=c[4]*a[3]+c[5]*a[7]+c[6]*a[11]+c[7]*a[15];g=c[8]*a[3]+c[9]*a[7]+c[10]*a[11]+c[11]*a[15];h=c[12]*a[3]+c[13]*a[7]+c[14]*a[11]+c[15]*a[15];a[3]=e;a[7]=f;a[11]=g;a[15]=h;return a},postMult:function(a,c){btmp0=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];btmp1=c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13];btmp2=c[0]*a[2]+c[1]*a[6]+c[2]*a[10]+c[3]*a[14];btmp3=c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15];
c[0]=btmp0;c[1]=btmp1;c[2]=btmp2;c[3]=btmp3;btmp0=c[4]*a[0]+c[5]*a[4]+c[6]*a[8]+c[7]*a[12];btmp1=c[4]*a[1]+c[5]*a[5]+c[6]*a[9]+c[7]*a[13];btmp2=c[4]*a[2]+c[5]*a[6]+c[6]*a[10]+c[7]*a[14];btmp3=c[4]*a[3]+c[5]*a[7]+c[6]*a[11]+c[7]*a[15];c[4]=btmp0;c[5]=btmp1;c[6]=btmp2;c[7]=btmp3;btmp0=c[8]*a[0]+c[9]*a[4]+c[10]*a[8]+c[11]*a[12];btmp1=c[8]*a[1]+c[9]*a[5]+c[10]*a[9]+c[11]*a[13];btmp2=c[8]*a[2]+c[9]*a[6]+c[10]*a[10]+c[11]*a[14];btmp3=c[8]*a[3]+c[9]*a[7]+c[10]*a[11]+c[11]*a[15];c[8]=btmp0;c[9]=btmp1;c[10]=
btmp2;c[11]=btmp3;btmp0=c[12]*a[0]+c[13]*a[4]+c[14]*a[8]+c[15]*a[12];btmp1=c[12]*a[1]+c[13]*a[5]+c[14]*a[9]+c[15]*a[13];btmp2=c[12]*a[2]+c[13]*a[6]+c[14]*a[10]+c[15]*a[14];btmp3=c[12]*a[3]+c[13]*a[7]+c[14]*a[11]+c[15]*a[15];c[12]=btmp0;c[13]=btmp1;c[14]=btmp2;c[15]=btmp3;return c},multa:function(a,c,e){return e===a?this.preMult(a,c):e===c?this.postMult(a,c):(e===void 0&&(e=[]),e[0]=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12],e[1]=c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13],e[2]=c[0]*a[2]+c[1]*a[6]+c[2]*
a[10]+c[3]*a[14],e[3]=c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15],e[4]=c[4]*a[0]+c[5]*a[4]+c[6]*a[8]+c[7]*a[12],e[5]=c[4]*a[1]+c[5]*a[5]+c[6]*a[9]+c[7]*a[13],e[6]=c[4]*a[2]+c[5]*a[6]+c[6]*a[10]+c[7]*a[14],e[7]=c[4]*a[3]+c[5]*a[7]+c[6]*a[11]+c[7]*a[15],e[8]=c[8]*a[0]+c[9]*a[4]+c[10]*a[8]+c[11]*a[12],e[9]=c[8]*a[1]+c[9]*a[5]+c[10]*a[9]+c[11]*a[13],e[10]=c[8]*a[2]+c[9]*a[6]+c[10]*a[10]+c[11]*a[14],e[11]=c[8]*a[3]+c[9]*a[7]+c[10]*a[11]+c[11]*a[15],e[12]=c[12]*a[0]+c[13]*a[4]+c[14]*a[8]+c[15]*a[12],e[13]=
c[12]*a[1]+c[13]*a[5]+c[14]*a[9]+c[15]*a[13],e[14]=c[12]*a[2]+c[13]*a[6]+c[14]*a[10]+c[15]*a[14],e[15]=c[12]*a[3]+c[13]*a[7]+c[14]*a[11]+c[15]*a[15],e)},mult:function(a,c,e){var f=c[0],g=c[1],h=c[2],j=c[3],i=c[4],k=c[5],m=c[6],n=c[7],p=c[8],q=c[9],u=c[10],s=c[11],w=c[12],B=c[13],E=c[14],c=c[15],v=a[0],J=a[1],z=a[2],I=a[3],F=a[4],G=a[5],H=a[6],D=a[7],A=a[8],K=a[9],C=a[10],L=a[11],x=a[12],y=a[13],M=a[14],a=a[15];e[0]=f*v+g*F+h*A+j*x;e[1]=f*J+g*G+h*K+j*y;e[2]=f*z+g*H+h*C+j*M;e[3]=f*I+g*D+h*L+j*a;e[4]=
i*v+k*F+m*A+n*x;e[5]=i*J+k*G+m*K+n*y;e[6]=i*z+k*H+m*C+n*M;e[7]=i*I+k*D+m*L+n*a;e[8]=p*v+q*F+u*A+s*x;e[9]=p*J+q*G+u*K+s*y;e[10]=p*z+q*H+u*C+s*M;e[11]=p*I+q*D+u*L+s*a;e[12]=w*v+B*F+E*A+c*x;e[13]=w*J+B*G+E*K+c*y;e[14]=w*z+B*H+E*C+c*M;e[15]=w*I+B*D+E*L+c*a;return e},multOrig:function(a,c,e){if(e===a){for(var e=[],f=0;f<4;f++)e[0]=osg.Matrix.innerProduct(c,a,0,f),e[1]=osg.Matrix.innerProduct(c,a,1,f),e[2]=osg.Matrix.innerProduct(c,a,2,f),e[3]=osg.Matrix.innerProduct(c,a,3,f),a[0+f]=e[0],a[4+f]=e[1],a[8+
f]=e[2],a[12+f]=e[3];return a}else if(e===c){e=[];for(f=0;f<4;f++)e[0]=osg.Matrix.innerProduct(c,a,f,0),e[1]=osg.Matrix.innerProduct(c,a,f,1),e[2]=osg.Matrix.innerProduct(c,a,f,2),e[3]=osg.Matrix.innerProduct(c,a,f,3),this.setRow(c,f,e[0],e[1],e[2],e[3]);return c}e===void 0&&(e=[]);var f=c[0],g=c[1],h=c[2],j=c[3],i=c[4],k=c[5],m=c[6],n=c[7],p=c[8],q=c[9],u=c[10],s=c[11],w=c[12],B=c[13],E=c[14],c=c[15],v=a[0],J=a[1],z=a[2],I=a[3],F=a[4],G=a[5],H=a[6],D=a[7],A=a[8],K=a[9],C=a[10],L=a[11],x=a[12],y=
a[13],M=a[14],a=a[15];e[0]=f*v+g*F+h*A+j*x;e[1]=f*J+g*G+h*K+j*y;e[2]=f*z+g*H+h*C+j*M;e[3]=f*I+g*D+h*L+j*a;e[4]=i*v+k*F+m*A+n*x;e[5]=i*J+k*G+m*K+n*y;e[6]=i*z+k*H+m*C+n*M;e[7]=i*I+k*D+m*L+n*a;e[8]=p*v+q*F+u*A+s*x;e[9]=p*J+q*G+u*K+s*y;e[10]=p*z+q*H+u*C+s*M;e[11]=p*I+q*D+u*L+s*a;e[12]=w*v+B*F+E*A+c*x;e[13]=w*J+B*G+E*K+c*y;e[14]=w*z+B*H+E*C+c*M;e[15]=w*I+B*D+E*L+c*a;return e},makeLookAt:function(a,c,e,f){f===void 0&&(f=[]);c=osg.Vec3.sub(c,a,[]);osg.Vec3.normalize(c,c);e=osg.Vec3.cross(c,e,[]);osg.Vec3.normalize(e,
e);var g=osg.Vec3.cross(e,c,[]);osg.Vec3.normalize(g,g);f[0]=e[0];f[1]=g[0];f[2]=-c[0];f[3]=0;f[4]=e[1];f[5]=g[1];f[6]=-c[1];f[7]=0;f[8]=e[2];f[9]=g[2];f[10]=-c[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;osg.Matrix.multTranslate(f,osg.Vec3.neg(a,[]),f);return f},makeOrtho:function(a,c,e,f,g,h,j){j===void 0&&(j=[]);var i=-(c+a)/(c-a),k=-(f+e)/(f-e),m=-(h+g)/(h-g),n=osg.Matrix.setRow;n(j,0,2/(c-a),0,0,0);n(j,1,0,2/(f-e),0,0);n(j,2,0,0,-2/(h-g),0);n(j,3,i,k,m,1);return j},getLookAt:function(a,c,e,f,
g){g===void 0&&(g=1);var h=[];osg.Matrix.inverse(a,h)||osg.Matrix.makeIdentity(h);osg.Matrix.transformVec3(h,[0,0,0],c);osg.Matrix.transform3x3(a,[0,1,0],f);osg.Matrix.transform3x3(a,[0,0,-1],e);osg.Vec3.normalize(e,e);osg.Vec3.add(osg.Vec3.mult(e,g,[]),c,e)},getRotate:function(a,c){c===void 0&&(c=[]);var e;e=[];var f,g;f=a[0];g=a[5];var h=a[10];e[0]=1+f+g+h;e[1]=1+f-g-h;e[2]=1-f+g-h;e[3]=1-f-g+h;g=0;for(f=1;f<4;f++)e[f]>e[g]&&(g=f);g===0?(c[3]=e[0],c[0]=a[6]-a[9],c[1]=a[8]-a[2],c[2]=a[1]-a[4]):g==
1?(c[3]=a[6]-a[9],c[0]=e[1],c[1]=a[1]+a[4],c[2]=a[8]+a[2]):g==2?(c[3]=a[8]-a[2],c[0]=a[1]+a[4],c[1]=e[2],c[2]=a[6]+a[9]):(c[3]=a[1]-a[4],c[0]=a[8]+a[2],c[1]=a[6]+a[9],c[2]=e[3]);e=Math.sqrt(0.25/e[g]);c[3]*=e;c[0]*=e;c[1]*=e;c[2]*=e;return c},preMultTranslate:function(a,c){c[0]!==0&&(val=c[0],a[12]+=val*a[0],a[13]+=val*a[1],a[14]+=val*a[2],a[15]+=val*a[3]);c[1]!==0&&(val=c[1],a[12]+=val*a[4],a[13]+=val*a[5],a[14]+=val*a[6],a[15]+=val*a[7]);c[2]!==0&&(val=c[2],a[12]+=val*a[8],a[13]+=val*a[9],a[14]+=
val*a[10],a[15]+=val*a[11]);return a},multTranslate:function(a,c,e){e===void 0&&(e=[]);e!==a&&osg.Matrix.copy(a,e);var f;c[0]!==0&&(f=c[0],e[12]+=f*a[0],e[13]+=f*a[1],e[14]+=f*a[2],e[15]+=f*a[3]);c[1]!==0&&(f=c[1],e[12]+=f*a[4],e[13]+=f*a[5],e[14]+=f*a[6],e[15]+=f*a[7]);c[2]!==0&&(f=c[2],e[12]+=f*a[8],e[13]+=f*a[9],e[14]+=f*a[10],e[15]+=f*a[11]);return e},makeRotate:function(a,c,e,f,g){g===void 0&&(osg.log("osg.makeRotate without given matrix destination is deprecated"),g=[]);var h=Math.sqrt(c*c+
e*e+f*f),j=Math.sin(a),a=Math.cos(a);if(h>0){var i,k,m,n,p,h=1/h;c*=h;e*=h;f*=h;h=c*e;i=e*f;k=f*c;m=c*j;n=e*j;j*=f;p=1-a;g[0]=p*c*c+a;g[1]=p*h-j;g[2]=p*k+n;g[3]=0;g[4]=p*h+j;g[5]=p*e*e+a;g[6]=p*i-m;g[7]=0;g[8]=p*k-n;g[9]=p*i+m;g[10]=p*f*f+a;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1}else return osg.Matrix.makeIdentity(g);return g},transform3x3:function(a,c,e){e===void 0&&(e=[]);e[0]=a[0]*c[0]+a[1]*c[1]+a[2]*c[2];e[1]=a[4]*c[0]+a[5]*c[1]+a[6]*c[2];e[2]=a[8]*c[0]+a[9]*c[1]+a[10]*c[2];return e},transformVec3:function(a,
c,e){var f=1/(a[3]*c[0]+a[7]*c[1]+a[11]*c[2]+a[15]);e===void 0&&(osg.warn("deprecated, osg.Matrix.transformVec3 needs a third parameter as result"),e=[]);var g;g=e===c?[]:e;g[0]=(a[0]*c[0]+a[4]*c[1]+a[8]*c[2]+a[12])*f;g[1]=(a[1]*c[0]+a[5]*c[1]+a[9]*c[2]+a[13])*f;g[2]=(a[2]*c[0]+a[6]*c[1]+a[10]*c[2]+a[14])*f;e===c&&osg.Vec3.copy(g,e);return e},transformVec4:function(a,c,e){e===void 0&&(e=[]);var f;f=e===c?[]:e;f[0]=a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3];f[1]=a[4]*c[0]+a[5]*c[1]+a[6]*c[2]+a[7]*c[3];
f[2]=a[8]*c[0]+a[9]*c[1]+a[10]*c[2]+a[11]*c[3];f[3]=a[12]*c[0]+a[13]*c[1]+a[14]*c[2]+a[15]*c[3];e===c&&osg.Vec4.copy(f,e);return e},copy:function(a,c){c===void 0&&(c=[]);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},inverse:function(a,c){if(c===a)osg.Matrix.copy(a,osg.Matrix._tmp1),a=osg.Matrix._tmp1;return a[3]===0&&a[7]===0&&a[11]===0&&a[15]===1?this.inverse4x3(a,
c):this.inverse4x4(a,c)},inverse4x4:function(a,c){var e=a[10]*a[15],f=a[14]*a[11],g=a[6]*a[15],h=a[14]*a[7],j=a[6]*a[11],i=a[10]*a[7],k=a[2]*a[15],m=a[14]*a[3],n=a[2]*a[11],p=a[10]*a[3],q=a[2]*a[7],u=a[6]*a[3],s=a[8]*a[13],w=a[12]*a[9],B=a[4]*a[13],E=a[12]*a[5],v=a[4]*a[9],J=a[8]*a[5],z=a[0]*a[13],I=a[12]*a[1],F=a[0]*a[9],G=a[8]*a[1],H=a[0]*a[5],D=a[4]*a[1],A=e*a[5]+h*a[9]+j*a[13]-(f*a[5]+g*a[9]+i*a[13]),K=f*a[1]+k*a[9]+p*a[13]-(e*a[1]+m*a[9]+n*a[13]),C=g*a[1]+m*a[5]+q*a[13]-(h*a[1]+k*a[5]+u*a[13]),
L=i*a[1]+n*a[5]+u*a[9]-(j*a[1]+p*a[5]+q*a[9]),x=a[0]*A+a[4]*K+a[8]*C+a[12]*L;if(Math.abs(x)<1.0E-5)return osg.log("Warning can't inverse matrix "+a),!1;var x=1/x,y=x*(f*a[4]+g*a[8]+i*a[12]-(e*a[4]+h*a[8]+j*a[12])),e=x*(e*a[0]+m*a[8]+n*a[12]-(f*a[0]+k*a[8]+p*a[12])),g=x*(h*a[0]+k*a[4]+u*a[12]-(g*a[0]+m*a[4]+q*a[12])),j=x*(j*a[0]+p*a[4]+q*a[8]-(i*a[0]+n*a[4]+u*a[8])),i=x*(s*a[7]+E*a[11]+v*a[15]-(w*a[7]+B*a[11]+J*a[15])),n=x*(w*a[3]+z*a[11]+G*a[15]-(s*a[3]+I*a[11]+F*a[15])),p=x*(B*a[3]+I*a[7]+H*a[15]-
(E*a[3]+z*a[7]+D*a[15])),q=x*(J*a[3]+F*a[7]+D*a[11]-(v*a[3]+G*a[7]+H*a[11])),u=x*(B*a[10]+J*a[14]+w*a[6]-(v*a[14]+s*a[6]+E*a[10])),s=x*(F*a[14]+s*a[2]+I*a[10]-(z*a[10]+G*a[14]+w*a[2])),B=x*(z*a[6]+D*a[14]+E*a[2]-(H*a[14]+B*a[2]+I*a[6])),v=x*(H*a[10]+v*a[2]+G*a[6]-(F*a[6]+D*a[10]+J*a[2]));c[0]=x*A;c[1]=x*K;c[2]=x*C;c[3]=x*L;c[4]=y;c[5]=e;c[6]=g;c[7]=j;c[8]=i;c[9]=n;c[10]=p;c[11]=q;c[12]=u;c[13]=s;c[14]=B;c[15]=v;return!0},inverse4x3:function(a,c){var e=a[0],f=a[1],g=a[2],h=a[4],j=a[5],i=a[6],k=a[8],
m=a[9],n=a[10];c[0]=j*n-i*m;c[1]=g*m-f*n;c[2]=f*i-g*j;var p=1/(e*c[0]+h*c[1]+k*c[2]);e*=p;h*=p;k*=p;c[0]*=p;c[1]*=p;c[2]*=p;c[3]=0;c[4]=i*k-h*n;c[5]=e*n-g*k;c[6]=g*h-e*i;c[7]=0;c[8]=h*m-j*k;c[9]=f*k-e*m;c[10]=e*j-f*h;c[11]=0;c[15]=1;e=a[15];f=e-1;f*f>1.0E-6?(f=osg.Matrix._tmp0,c[12]=c[13]=c[14]=0,j=a[3],i=a[7],k=a[11],g=c[0]*j+c[1]*i+c[2]*k,h=c[4]*j+c[5]*i+c[6]*k,m=c[8]*j+c[9]*i+c[10]*k,j=a[12],i=a[13],k=a[14],e=1/(e-(j*g+i*h+k*m)),j*=e,i*=e,k*=e,f[0]=j*g+1,f[1]=i*g,f[2]=k*g,f[3]=-g*e,f[4]=j*h,f[5]=
i*h+1,f[6]=k*h,f[7]=-h*e,f[8]=j*m,f[9]=i*m,f[10]=k*m+1,f[11]=-m*e,f[12]=-j,f[13]=-i,f[14]=-k,f[15]=e,osg.Matrix.preMult(c,f)):(j=a[12],i=a[13],k=a[14],c[12]=-(j*c[0]+i*c[4]+k*c[8]),c[13]=-(j*c[1]+i*c[5]+k*c[9]),c[14]=-(j*c[2]+i*c[6]+k*c[10]));return!0},transpose:function(a,c){if(a===c){var e=a[1],f=a[2],g=a[3],h=a[6],j=a[7],i=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=e;a[6]=a[9];a[7]=a[13];a[8]=f;a[9]=h;a[11]=a[14];a[12]=g;a[13]=j;a[14]=i;return a}else return c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],
c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15],c},makePerspective:function(a,c,e,f,g){g===void 0&&(g=[]);var a=e*Math.tan(a*Math.PI/360),h=-a;return osg.Matrix.makeFrustum(h*c,a*c,h,a,e,f,g)},makeScale:function(a,c,e,f){f===void 0&&(f=[]);this.setRow(f,0,a,0,0,0);this.setRow(f,1,0,c,0,0);this.setRow(f,2,0,0,e,0);this.setRow(f,3,0,0,0,1);return f},computeFrustrumCornersVectors:function(a,c){var e=1/a[0],f=1/a[5];c[0]=
[-e,f,1];c[1]=[-e,-f,1];c[2]=[e,-f,1];c[3]=[e,f,1];return c},makeFrustum:function(a,c,e,f,g,h,j){j===void 0&&(j=[]);var i=2*g/(f-e),k=(c+a)/(c-a),e=(f+e)/(f-e),f=-(h+g)/(h-g),h=-2*h*g/(h-g);this.setRow(j,0,2*g/(c-a),0,0,0);this.setRow(j,1,0,i,0,0);this.setRow(j,2,k,e,f,-1);this.setRow(j,3,0,0,h,0);return j},makeRotateFromQuat:function(a,c){this.makeIdentity(c);return this.setRotateFromQuat(c,a)},setRotateFromQuat:function(a,c){var e=osg.Quat.length2(c);if(Math.abs(e)<=Number.MIN_VALUE)a[0]=0,a[1]=
0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[8]=0,a[9]=0,a[10]=0;else{var e=e!==1?2/e:2,f,g,h,j,i,k,m,n;f=e*c[0];g=e*c[1];h=e*c[2];e=c[0]*f;k=c[0]*g;m=c[0]*h;j=c[1]*g;i=c[1]*h;n=c[2]*h;f*=c[3];g*=c[3];h*=c[3];a[0]=1-(j+n);a[4]=k-h;a[8]=m+g;a[1]=k+h;a[5]=1-(e+n);a[9]=i-f;a[2]=m-g;a[6]=i+f;a[10]=1-(e+j)}return a}};osg.ShaderGeneratorType={VertexInit:0,VertexFunction:1,VertexMain:2,VertexEnd:3,FragmentInit:5,FragmentFunction:6,FragmentMain:7,FragmentEnd:8};osg.Shader=function(a,c){this.type=a;this.setText(c)};
osg.Shader.VERTEX_SHADER=35633;osg.Shader.FRAGMENT_SHADER=35632;
osg.Shader.prototype={setText:function(a){this.text=a},getText:function(){return this.text},compile:function(){this.shader=gl.createShader(this.type);gl.shaderSource(this.shader,this.text);gl.compileShader(this.shader);if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)&&!gl.isContextLost()){osg.log("can't compile shader:\n"+this.text+"\n");for(var a=("\n"+this.text).split("\n"),c="\n",e=0,f=a.length;e<f;++e)c+=e+" "+a[e]+"\n";osg.log(c);osg.log(gl.getShaderInfoLog(this.shader))}}};
osg.Shader.create=function(a,c){osg.log("osg.Shader.create is deprecated, use new osg.Shader with the same arguments instead");return new osg.Shader(a,c)};osg.StateAttribute=function(){osg.Object.call(this);this._dirty=!0};osg.StateAttribute.prototype=osg.objectInehrit(osg.Object.prototype,{isDirty:function(){return this._dirty},dirty:function(){this._dirty=!0},setDirty:function(a){this._dirty=a}});osg.StateAttribute.OFF=0;osg.StateAttribute.ON=1;osg.StateAttribute.OVERRIDE=2;
osg.StateAttribute.PROTECTED=4;osg.StateAttribute.INHERIT=8;osg.Uniform=function(){this.transpose=!1;this._dirty=!0;this.name="";this.type=void 0};osg.Uniform.isUniform=function(a){return a.prototype===osg.Uniform.prototype?!0:!1};
osg.Uniform.prototype={getName:function(){return this.name},getType:function(){return this.type},get:function(){return this.data},set:function(a){this.data=a;this.dirty()},dirty:function(){this._dirty=!0},apply:function(a){if(this._dirty)this.update.call(this.glData,this.data),this._dirty=!1;this.glCall(a,this.glData)},applyMatrix:function(a){if(this._dirty)this.update.call(this.glData,this.data),this._dirty=!1;this.glCall(a,this.transpose,this.glData)},update:function(a){for(var c=0,e=a.length;c<
e;++c)this[c]=a[c]},_updateArray:function(a){for(var c=0,e=a.length;c<e;++c)this[c]=a[c]},_updateFloat1:function(a){this[0]=a[0]},_updateFloat2:function(a){this[0]=a[0];this[1]=a[1]},_updateFloat3:function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2]},_updateFloat4:function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]=a[3]},_updateFloat9:function(a){this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]=a[3];this[4]=a[4];this[5]=a[5];this[6]=a[6];this[7]=a[7];this[8]=a[8]},_updateFloat16:function(a){this[0]=
a[0];this[1]=a[1];this[2]=a[2];this[3]=a[3];this[4]=a[4];this[5]=a[5];this[6]=a[6];this[7]=a[7];this[8]=a[8];this[9]=a[9];this[10]=a[10];this[11]=a[11];this[12]=a[12];this[13]=a[13];this[14]=a[14];this[15]=a[15]}};
osg.Uniform.createFloat1=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0]);var g=new osg.Uniform;g.data=[e];g.glCall=function(a,c){gl.uniform1fv(a,c)};g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat1;g.set=function(a){typeof a==="number"?this.data[0]=a:this.data=a;this.dirty()};g.name=f;g.type="float";return g};osg.Uniform.createFloat=osg.Uniform.createFloat1;osg.Uniform.float=osg.Uniform.createFloat1;
osg.Uniform.createFloatArray=function(a,c){var e=osg.Uniform.createFloat.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createFloat2=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform2fv(a,c)};g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat2;g.name=f;g.type="vec2";return g};osg.Uniform.vec2=osg.Uniform.createFloat2;
osg.Uniform.createFloat2Array=function(a,c){var e=osg.Uniform.createFloat2.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createFloat3=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform3fv(a,c)};g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat3;g.name=f;g.type="vec3";return g};osg.Uniform.vec3=osg.Uniform.createFloat3;
osg.Uniform.createFloat3Array=function(a,c){var e=osg.Uniform.createFloat3.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createFloat4=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0,0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform4fv(a,c)};g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat4;g.name=f;g.type="vec4";return g};osg.Uniform.vec4=osg.Uniform.createFloat4;
osg.Uniform.createFloat4Array=function(a,c){var e=osg.Uniform.createFloat4.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createInt1=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0]);var g=new osg.Uniform;g.data=[e];g.glCall=function(a,c){gl.uniform1iv(a,c)};g.set=function(a){typeof a==="number"?this.data[0]=a:this.data=a;this.dirty()};g.glData=new osg.Int32Array(g.data);g.name=f;g.type="int";return g};osg.Uniform.int=osg.Uniform.createInt1;
osg.Uniform.createInt=osg.Uniform.createInt1;osg.Uniform.createIntArray=function(a,c){var e=osg.Uniform.createInt.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createInt2=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform2iv(a,c)};g.glData=new osg.Int32Array(g.data);g.name=f;g.type="vec2i";return g};osg.Uniform.vec2i=osg.Uniform.createInt2;
osg.Uniform.createInt2Array=function(a,c){var e=osg.Uniform.createInt2.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createInt3=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform3iv(a,c)};g.glData=new osg.Int32Array(g.data);g.name=f;g.type="vec3i";return g};osg.Uniform.vec3i=osg.Uniform.createInt3;
osg.Uniform.createInt3Array=function(a,c){var e=osg.Uniform.createInt3.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createInt4=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[0,0,0,0]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c){gl.uniform4iv(a,c)};g.glData=new osg.Int32Array(g.data);g.name=f;g.type="vec4i";return g};osg.Uniform.vec4i=osg.Uniform.createInt4;
osg.Uniform.createInt4Array=function(a,c){var e=osg.Uniform.createInt4.call(this,a,c);e.update=osg.Uniform.prototype._updateArray;return e};osg.Uniform.createMatrix2=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[1,0,0,1]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c,e){gl.uniformMatrix2fv(a,c,e)};g.apply=g.applyMatrix;g.transpose=!1;g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat4;g.name=f;g.type="mat2";return g};osg.Uniform.createMat2=osg.Uniform.createMatrix2;
osg.Uniform.mat2=osg.Uniform.createMat2;osg.Uniform.createMatrix3=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[1,0,0,0,1,0,0,0,1]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c,e){gl.uniformMatrix3fv(a,c,e)};g.apply=g.applyMatrix;g.transpose=!1;g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat9;g.name=f;g.type="mat3";return g};osg.Uniform.createMat3=osg.Uniform.createMatrix3;osg.Uniform.mat3=osg.Uniform.createMatrix3;
osg.Uniform.createMatrix4=function(a,c){var e=a,f=c;f===void 0&&(f=e,e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var g=new osg.Uniform;g.data=e;g.glCall=function(a,c,e){gl.uniformMatrix4fv(a,c,e)};g.apply=g.applyMatrix;g.transpose=!1;g.glData=new osg.Float32Array(g.data);g.update=osg.Uniform.prototype._updateFloat16;g.name=f;g.type="mat4";return g};osg.Uniform.createMat4=osg.Uniform.createMatrix4;osg.Uniform.mat4=osg.Uniform.createMatrix4;
osg.Node=function(){osg.Object.call(this);this.children=[];this.parents=[];this.nodeMask=-1;this.boundingSphere=new osg.BoundingSphere;this.boundingSphereComputed=!1;this._updateCallbacks=[];this._cullCallback=void 0};
osg.Node.prototype=osg.objectInehrit(osg.Object.prototype,{getOrCreateStateSet:function(){if(this.stateset===void 0)this.stateset=new osg.StateSet;return this.stateset},getStateSet:function(){return this.stateset},accept:function(a){a.validNodeMask(this)&&(a.pushOntoNodePath(this),a.apply(this),a.popFromNodePath())},dirtyBound:function(){if(this.boundingSphereComputed===!0){this.boundingSphereComputed=!1;for(var a=0,c=this.parents.length;a<c;a++)this.parents[a].dirtyBound()}},setNodeMask:function(a){this.nodeMask=
a},getNodeMask:function(){return this.nodeMask},setStateSet:function(a){this.stateset=a},setUpdateCallback:function(a){this._updateCallbacks[0]=a},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(a){this._updateCallbacks.push(a)},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(a){this._cullCallback=a},getCullCallback:function(){return this._cullCallback},hasChild:function(a){for(var c=0,e=this.children.length;c<e;c++)if(this.children[c]===
a)return!0;return!1},addChild:function(a){var c=this.children.push(a);a.addParent(this);this.dirtyBound();return c},getChildren:function(){return this.children},getParents:function(){return this.parents},addParent:function(a){this.parents.push(a)},removeParent:function(a){for(var c=0,e=this.parents.length,f=this.parents;c<e;c++)if(f[c]===a){f.splice(c,1);break}},removeChildren:function(){var a=this.children;if(a.length!==0){for(var c=0,e=a.length;c<e;c++)a[c].removeParent(this);this.children.splice(0,
this.children.length);this.dirtyBound()}},removeChild:function(a){for(var c=0,e=this.children.length;c<e;c++)this.children[c]===a&&(a.removeParent(this),this.children.splice(c,1),this.dirtyBound())},traverse:function(a){for(var c=0,e=this.children.length;c<e;c++)this.children[c].accept(a)},ascend:function(a){for(var c=0,e=this.parents.length;c<e;c++)this.parents[c].accept(a)},getBound:function(){if(!this.boundingSphereComputed)this.computeBound(this.boundingSphere),this.boundingSphereComputed=!0;
return this.boundingSphere},computeBound:function(a){var c=new osg.BoundingBox;c.init();a.init();for(var e=0,f=this.children.length;e<f;e++){var g=this.children[e];(g.referenceFrame===void 0||g.referenceFrame===osg.Transform.RELATIVE_RF)&&c.expandBySphere(g.getBound())}if(!c.valid())return a;a._center=c.center();c=a._radius=0;for(e=this.children.length;c<e;c++)f=this.children[c],(f.referenceFrame===void 0||f.referenceFrame===osg.Transform.RELATIVE_RF)&&a.expandRadiusBySphere(f.getBound());return a},
getWorldMatrices:function(a){var c=function(a){this.nodePaths=[];this.halt=a;osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};c.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(a){a.parents.length===0||a===this.halt?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(a)}});a=new c(a);this.accept(a);for(var c=[],e=0,f=a.nodePaths.length;e<f;e++){var g=a.nodePaths[e];g.length===0?c.push(osg.Matrix.makeIdentity([])):c.push(osg.computeLocalToWorld(g))}return c}});
osg.Node.prototype.objectType=osg.objectType.generate("Node");osg.NodeVisitor=function(a){this.traversalMask=-1;this.nodeMaskOverride=0;this.traversalMode=a;if(a===void 0)this.traversalMode=osg.NodeVisitor.TRAVERSE_ALL_CHILDREN;this.nodePath=[]};osg.NodeVisitor.TRAVERSE_PARENTS=1;osg.NodeVisitor.TRAVERSE_ALL_CHILDREN=2;osg.NodeVisitor._traversalFunctions={};osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_PARENTS]=function(a){a.ascend(this)};
osg.NodeVisitor._traversalFunctions[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(a){a.traverse(this)};osg.NodeVisitor._pushOntoNodePath={};osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(a){this.nodePath.unshift(a)};osg.NodeVisitor._pushOntoNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(a){this.nodePath.push(a)};osg.NodeVisitor._popFromNodePath={};osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_PARENTS]=function(){return this.nodePath.shift()};
osg.NodeVisitor._popFromNodePath[osg.NodeVisitor.TRAVERSE_ALL_CHILDREN]=function(){this.nodePath.pop()};
osg.NodeVisitor.prototype={setNodeMaskOverride:function(a){this.nodeMaskOverride=a},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(a){this.traversalMask=a},getTraversalMask:function(){return this.traversalMask},pushOntoNodePath:function(a){osg.NodeVisitor._pushOntoNodePath[this.traversalMode].call(this,a)},popFromNodePath:function(){osg.NodeVisitor._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(a){return(this.traversalMask&(this.nodeMaskOverride|
a.getNodeMask()))!==0},apply:function(a){this.traverse(a)},traverse:function(a){osg.NodeVisitor._traversalFunctions[this.traversalMode].call(this,a)}};osg.Transform=function(){osg.Node.call(this);this.referenceFrame=osg.Transform.RELATIVE_RF};osg.Transform.RELATIVE_RF=0;osg.Transform.ABSOLUTE_RF=1;
osg.Transform.prototype=osg.objectInehrit(osg.Node.prototype,{setReferenceFrame:function(a){this.referenceFrame=a},getReferenceFrame:function(){return this.referenceFrame},computeBound:function(a){osg.Node.prototype.computeBound.call(this,a);if(!a.valid())return a;var c=osg.Matrix.makeIdentity([]);this.computeLocalToWorldMatrix(c);var e=osg.Vec3.copy(a._center,[]);e[0]+=a._radius;osg.Matrix.transformVec3(c,e,e);var f=osg.Vec3.copy(a._center,[]);f[1]+=a._radius;osg.Matrix.transformVec3(c,f,f);var g=
osg.Vec3.copy(a._center,[]);g[2]+=a._radius;osg.Matrix.transformVec3(c,g,g);osg.Matrix.transformVec3(c,a._center,a._center);osg.Vec3.sub(e,a._center,e);c=osg.Vec3.length(e);osg.Vec3.sub(f,a._center,f);f=osg.Vec3.length(f);osg.Vec3.sub(g,a._center,g);g=osg.Vec3.length(g);a._radius=c;if(a._radius<f)a._radius=f;if(a._radius<g)a._radius=g;return a}});
osg.computeLocalToWorld=function(a,c){var e=c;e===void 0&&(e=!0);var f=osg.Matrix.makeIdentity([]),g=0;if(e)for(g=a.length-1;g>0;g--)if(e=a[g],e.objectType===osg.Camera.prototype.objectType&&(e.getReferenceFrame!==osg.Transform.RELATIVE_RF||e.getParents().length===0))break;for(e=a.length;g<e;g++){var h=a[g];h.computeLocalToWorldMatrix&&h.computeLocalToWorldMatrix(f)}return f};
osg.BlendFunc=function(a,c,e,f){osg.StateAttribute.call(this);this._sourceFactor=osg.BlendFunc.ONE;this._destinationFactor=osg.BlendFunc.ZERO;this._sourceFactorAlpha=this._sourceFactor;this._destinationFactorAlpha=this._destinationFactor;this._separate=!1;a!==void 0&&this.setSource(a);c!==void 0&&this.setDestination(c);e!==void 0&&this.setSourceAlpha(e);f!==void 0&&this.setDestinationAlpha(f)};osg.BlendFunc.ZERO=0;osg.BlendFunc.ONE=1;osg.BlendFunc.SRC_COLOR=768;osg.BlendFunc.ONE_MINUS_SRC_COLOR=769;
osg.BlendFunc.SRC_ALPHA=770;osg.BlendFunc.ONE_MINUS_SRC_ALPHA=771;osg.BlendFunc.DST_ALPHA=772;osg.BlendFunc.ONE_MINUS_DST_ALPHA=773;osg.BlendFunc.DST_COLOR=774;osg.BlendFunc.ONE_MINUS_DST_COLOR=775;osg.BlendFunc.SRC_ALPHA_SATURATE=776;osg.BlendFunc.BLEND_DST_RGB=32968;osg.BlendFunc.BLEND_SRC_RGB=32969;osg.BlendFunc.BLEND_DST_ALPHA=32970;osg.BlendFunc.BLEND_SRC_ALPHA=32971;osg.BlendFunc.CONSTANT_COLOR=32769;osg.BlendFunc.ONE_MINUS_CONSTANT_COLOR=32770;osg.BlendFunc.CONSTANT_ALPHA=32771;
osg.BlendFunc.ONE_MINUS_CONSTANT_ALPHA=32772;osg.BlendFunc.BLEND_COLOR=32773;
osg.BlendFunc.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendFunc",cloneType:function(){return new osg.BlendFunc},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setSource:function(a){this.setSourceRGB(a);this.setSourceAlpha(a)},setDestination:function(a){this.setDestinationRGB(a);this.setDestinationAlpha(a)},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},
setSourceRGB:function(a){this._sourceFactor=typeof a==="string"?osg.BlendFunc[a]:a;this._separate=this.checkSeparate()},setSourceAlpha:function(a){this._sourceFactorAlpha=typeof a==="string"?osg.BlendFunc[a]:a;this._separate=this.checkSeparate()},setDestinationRGB:function(a){this._destinationFactor=typeof a==="string"?osg.BlendFunc[a]:a;this._separate=this.checkSeparate()},setDestinationAlpha:function(a){this._destinationFactorAlpha=typeof a==="string"?osg.BlendFunc[a]:a;this._separate=this.checkSeparate()},
apply:function(a){a=a.getGraphicContext();a.enable(a.BLEND);this._separate?a.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):a.blendFunc(this._sourceFactor,this._destinationFactor)}});osg.BlendColor=function(a){osg.StateAttribute.call(this);this._constantColor=Array(4);this._constantColor[0]=this._constantColor[1]=this._constantColor[2]=this._constantColor[3]=1;a!==void 0&&this.setConstantColor(a)};
osg.BlendColor.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"BlendColor",cloneType:function(){return new osg.BlendColor},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setConstantColor:function(a){osg.Vec4.copy(a,this._constantColor)},getConstantColor:function(){return this._constantColor},apply:function(a){a.getGraphicContext().blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3]);
this._dirty=!1}});osg.BoundingBox=function(){this.init()};
osg.BoundingBox.prototype={_cache_radius2_tmp:[0,0,0],init:function(){this._min=[Infinity,Infinity,Infinity];this._max=[-Infinity,-Infinity,-Infinity]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandBySphere:function(a){if(a.valid()){var c=this._max,e=this._min;e[0]=Math.min(e[0],a._center[0]-a._radius);e[1]=Math.min(e[1],a._center[1]-a._radius);e[2]=Math.min(e[2],a._center[2]-a._radius);c[0]=Math.max(c[0],a._center[0]+a._radius);
c[1]=Math.max(c[1],a._center[1]+a._radius);c[2]=Math.max(c[2],a._center[2]+a._radius)}},expandByVec3:function(a){var c=this._min,e=this._max;c[0]=Math.min(c[0],a[0]);c[1]=Math.min(c[1],a[1]);c[2]=Math.min(c[2],a[2]);e[0]=Math.max(e[0],a[0]);e[1]=Math.max(e[1],a[1]);e[2]=Math.max(e[2],a[2])},center:function(){var a=this._min,c=this._max;return[(a[0]+c[0])*0.5,(a[1]+c[1])*0.5,(a[2]+c[2])*0.5]},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var a=this._min,c=this._max,e=this._cache_radius2_tmp;
e[0]=c[0]-a[0];e[1]=c[1]-a[1];e[2]=c[2]-a[2];return 0.25*(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},corner:function(a){ret=[0,0,0];ret[0]=a&1?this._max[0]:this._min[0];ret[1]=a&2?this._max[1]:this._min[1];ret[2]=a&4?this._max[2]:this._min[2];return ret}};osg.BoundingSphere=function(){this._center=[0,0,0];this._radius=-1};
osg.BoundingSphere.prototype={init:function(){this._center=[0,0,0];this._radius=-1},valid:function(){return this._radius>=0},set:function(a,c){this._center=a;this._radius=c},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBox:function(a){if(a.valid()){var c;if(this.valid()){var e=new osg.BoundingBox;e._min[0]=a._min[0];e._min[1]=a._min[1];e._min[2]=a._min[2];e._max[0]=a._max[0];e._max[1]=a._max[1];e._max[2]=
a._max[2];for(var f=0;f<8;f++){var g=osg.Vec3.sub(a.corner(c),this._center,[]);osg.Vec3.normalize(g,g);nv[0]*=-this._radius;nv[1]*=-this._radius;nv[2]*=-this._radius;nv[0]+=this._center[0];nv[1]+=this._center[1];nv[2]+=this._center[2];e.expandBy(nv)}c=e.center();this._center[0]=c[0];this._center[1]=c[1];this._center[2]=c[2];this._radius=e.radius()}else c=a.center(),this._center[0]=c[0],this._center[1]=c[1],this._center[2]=c[2],this._radius=a.radius()}},expandByVec3:function(a){this.valid()?(a=osg.Vec3.sub(a,
this.center(),[]),r=osg.Vec3.length(a),r>this.radius()&&(dr=(r-this.radius())*0.5,this._center[0]+=a[0]*(dr/r),this._center[1]+=a[1]*(dr/r),this._center[2]+=a[2]*(dr/r),this._radius+=dr)):(this._center[0]=a[0],this._center[1]=a[1],this._center[2]=a[2],this._radius=0)},expandRadiusBySphere:function(a){if(a.valid())if(this.valid()){var c=osg.Vec3.sub,e=osg.Vec3.length,a=e(c(a._center,this._center,[]))+a._radius;if(a>this._radius)this._radius=a}else this._center=osg.Vec3.copy(a._center,[]),this._radius=
a._radius},expandBy:function(a){if(a.valid())if(this.valid()){var c=osg.Vec3.sub(this.center(),a.center(),[]);d=osg.Vec3.length(c);if(!(d+a.radius()<=this.radius()))d+this.radius()<=a.radius()?(this._center[0]=a._center[0],this._center[1]=a._center[1],this._center[2]=a._center[2],this._radius=a._radius):(new_radius=(this.radius()+d+a.radius())*0.5,ratio=(new_radius-this.radius())/d,this._center[0]+=(a._center[0]-this._center[0])*ratio,this._center[1]+=(a._center[1]-this._center[1])*ratio,this._center[2]+=
(a._center[2]-this._center[2])*ratio,this._radius=new_radius)}else this._center[0]=a._center[0],this._center[1]=a._center[1],this._center[2]=a._center[2],this._radius=a.radius()},contains:function(a){a=osg.Vec3.sub(a,this.center(),[]);return valid()&&osg.Vec3.length2(a)<=radius2()},intersects:function(a){var c=osg.Vec3.length2(osg.Vec3.sub(this.center(),a.center(),[]));return valid()&&a.valid()&&c<=(this.radius()+a.radius())*(this.radius()+a.radius())}};
osg.BufferArray=function(a,c,e){if(osg.BufferArray.instanceID===void 0)osg.BufferArray.instanceID=0;this.instanceID=osg.BufferArray.instanceID;osg.BufferArray.instanceID+=1;this.dirty();this._itemSize=e;typeof a==="string"&&(a=osg.BufferArray[a]);this._type=a;if(c!==void 0)this._elements=this._type===osg.BufferArray.ELEMENT_ARRAY_BUFFER?new osg.Uint16Array(c):new osg.Float32Array(c)};osg.BufferArray.ELEMENT_ARRAY_BUFFER=34963;osg.BufferArray.ARRAY_BUFFER=34962;
osg.BufferArray.prototype={setItemSize:function(a){this._itemSize=a},isValid:function(){return this._buffer!==void 0||this._elements!==void 0?!0:!1},releaseGLObjects:function(a){this._buffer!==void 0&&this._buffer!==null&&a.deleteBuffer(this._buffer);this._buffer=void 0},bind:function(a){var c=this._type,e=this._buffer;if(e)a.bindBuffer(c,e);else if(!e&&this._elements.length>0)this._buffer=a.createBuffer(),this._numItems=this._elements.length/this._itemSize,a.bindBuffer(c,this._buffer)},getItemSize:function(){return this._itemSize},
dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(a){if(this._dirty)a.bufferData(this._type,this._elements,a.STATIC_DRAW),this._dirty=!1},getElements:function(){return this._elements},setElements:function(a){this._elements=a;this._dirty=!0}};osg.BufferArray.create=function(a,c,e){osg.log("osg.BufferArray.create is deprecated, use new osg.BufferArray with same arguments instead");return new osg.BufferArray(a,c,e)};
osg.CullFace=function(a){osg.StateAttribute.call(this);if(a===void 0)a=osg.CullFace.BACK;this.setMode(a)};osg.CullFace.DISABLE=0;osg.CullFace.FRONT=1028;osg.CullFace.BACK=1029;osg.CullFace.FRONT_AND_BACK=1032;
osg.CullFace.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"CullFace",cloneType:function(){return new osg.CullFace},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setMode:function(a){typeof a==="string"&&(a=osg.CullFace[a]);this._mode=a},getMode:function(){return this._mode},apply:function(a){a=a.getGraphicContext();this._mode===osg.CullFace.DISABLE?a.disable(a.CULL_FACE):(a.enable(a.CULL_FACE),a.cullFace(this._mode));this._dirty=
!1}});osg.CullSettings=function(){this._computeNearFar=!0;this._nearFarRatio=0.0050;var a=[0,0,-1];this.bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0);this.bbCornerNear=~this.bbCornerFar&7};osg.CullSettings.prototype={setCullSettings:function(a){this._computeNearFar=a._computeNearFar;this._nearFarRatio=a._nearFarRatio},setNearFarRatio:function(a){this._nearFarRatio=a},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(a){this._computeNearFar=a},getComputeNearFar:function(){return this._computeNearFar}};
osg.Camera=function(){osg.Transform.call(this);osg.CullSettings.call(this);this.viewport=void 0;this.setClearColor([0,0,0,1]);this.setClearDepth(1);this.setClearMask(osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT);this.setViewMatrix(osg.Matrix.makeIdentity([]));this.setProjectionMatrix(osg.Matrix.makeIdentity([]));this.renderOrder=osg.Camera.NESTED_RENDER;this.renderOrderNum=0};osg.Camera.PRE_RENDER=0;osg.Camera.NESTED_RENDER=1;osg.Camera.POST_RENDER=2;osg.Camera.COLOR_BUFFER_BIT=16384;
osg.Camera.DEPTH_BUFFER_BIT=256;osg.Camera.STENCIL_BUFFER_BIT=1024;
osg.Camera.prototype=osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.Transform.prototype,{setClearDepth:function(a){this.clearDepth=a},getClearDepth:function(){return this.clearDepth},setClearMask:function(a){this.clearMask=a},getClearMask:function(){return this.clearMask},setClearColor:function(a){this.clearColor=a},getClearColor:function(){return this.clearColor},setViewport:function(a){this.viewport=a;this.getOrCreateStateSet().setAttributeAndMode(a)},getViewport:function(){return this.viewport},
setViewMatrix:function(a){this.modelviewMatrix=a},setProjectionMatrix:function(a){this.projectionMatrix=a},setProjectionMatrixAsOrtho:function(a,c,e,f,g,h){osg.Matrix.makeOrtho(a,c,e,f,g,h,this.getProjectionMatrix())},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(a,c){this.renderOrder=a;this.renderOrderNum=c},attachTexture:function(a,c,e){this.frameBufferObject&&
this.frameBufferObject.dirty();e===void 0&&(e=0);if(this.attachments===void 0)this.attachments={};this.attachments[a]={texture:c,level:e}},attachRenderBuffer:function(a,c){this.frameBufferObject&&this.frameBufferObject.dirty();if(this.attachments===void 0)this.attachments={};this.attachments[a]={format:c}},computeLocalToWorldMatrix:function(a){this.referenceFrame===osg.Transform.RELATIVE_RF&&osg.Matrix.preMult(a,this.modelviewMatrix);return!0},computeWorldToLocalMatrix:function(a){var c=[];osg.Matrix.inverse(this.modelviewMatrix,
c);this.referenceFrame===osg.Transform.RELATIVE_RF&&osg.Matrix.postMult(c,a);return!0}}));osg.Camera.prototype.objectType=osg.objectType.generate("Camera");osg.Depth=function(a,c,e,f){osg.StateAttribute.call(this);this._func=osg.Depth.LESS;this._near=0;this._far=1;this._writeMask=!0;if(a!==void 0)this._func=typeof a==="string"?osg.Depth[a]:a;if(c!==void 0)this._near=c;if(e!==void 0)this._far=e;if(f!==void 0)this._writeMask=f};osg.Depth.DISABLE=0;osg.Depth.NEVER=512;osg.Depth.LESS=513;
osg.Depth.EQUAL=514;osg.Depth.LEQUAL=515;osg.Depth.GREATE=516;osg.Depth.NOTEQU=517;osg.Depth.GEQUAL=518;osg.Depth.ALWAYS=519;
osg.Depth.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Depth",cloneType:function(){return new osg.Depth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setRange:function(a,c){this._near=a;this._far=c},setWriteMask:function(a){this._writeMask=a},apply:function(a){a=a.getGraphicContext();this._func===0?a.disable(a.DEPTH_TEST):(a.enable(a.DEPTH_TEST),a.depthFunc(this._func),a.depthMask(this._writeMask),a.depthRange(this._near,
this._far))}});osg.WGS_84_RADIUS_EQUATOR=6378137;osg.WGS_84_RADIUS_POLAR=6356752.3142;osg.EllipsoidModel=function(){this._radiusEquator=osg.WGS_84_RADIUS_EQUATOR;this._radiusPolar=osg.WGS_84_RADIUS_POLAR;this.computeCoefficients()};
osg.EllipsoidModel.prototype={setRadiusEquator:function(){this._radiusEquator=radius;this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(a){this._radiusPolar=a;this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(a,c,e,f){f===void 0&&(osg.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),f=[]);var g=Math.sin(a),h=Math.cos(a),j=
this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*g*g),a=(j+e)*h*Math.cos(c),c=(j+e)*h*Math.sin(c),e=(j*(1-this._eccentricitySquared)+e)*g;f[0]=a;f[1]=c;f[2]=e;return f},convertXYZToLatLongHeight:function(a,c,e,f){f===void 0&&(osg.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),f=[]);var g=Math.sqrt(a*a+c*c),h=Math.atan2(e*this._radiusEquator,g*this._radiusPolar),j=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*
this._radiusPolar),i=Math.sin(h),h=Math.cos(h);latitude=Math.atan((e+j*this._radiusPolar*i*i*i)/(g-this._eccentricitySquared*this._radiusEquator*h*h*h));longitude=Math.atan2(c,a);a=Math.sin(latitude);a=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*a*a);height=g/Math.cos(latitude)-a;f[0]=latitude;f[1]=longitude;f[2]=height;return f},computeLocalUpVector:function(a,c,e){var f,g,a=this.convertXYZToLatLongHeight(a,c,e,f,g,void 0);f=a[0];g=a[1];return[Math.cos(g)*Math.cos(f),Math.sin(g)*Math.cos(f),
Math.sin(f)]},isWGS84:function(){return this._radiusEquator==osg.WGS_84_RADIUS_EQUATOR&&this._radiusPolar==osg.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var a=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*a-a*a},computeLocalToWorldTransformFromLatLongHeight:function(a,c,e,f){f===void 0&&(osg.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),f=Array(16));e=this.convertLatLongHeightToXYZ(a,
c,e,f);osg.Matrix.makeTranslate(e[0],e[1],e[2],f);this.computeCoordinateFrame(a,c,f);return f},computeLocalToWorldTransformFromXYZ:function(a,c,e){var f=this.convertXYZToLatLongHeight(a,c,e),a=osg.Matrix.makeTranslate(a,c,e);this.computeCoordinateFrame(f[0],f[1],a);return a},computeCoordinateFrame:function(a,c,e){var a=[Math.cos(c)*Math.cos(a),Math.sin(c)*Math.cos(a),Math.sin(a)],c=[-Math.sin(c),Math.cos(c),0],f=osg.Vec3.cross(a,c,[]);osg.Matrix.set(e,0,0,c[0]);osg.Matrix.set(e,0,1,c[1]);osg.Matrix.set(e,
0,2,c[2]);osg.Matrix.set(e,1,0,f[0]);osg.Matrix.set(e,1,1,f[1]);osg.Matrix.set(e,1,2,f[2]);osg.Matrix.set(e,2,0,a[0]);osg.Matrix.set(e,2,1,a[1]);osg.Matrix.set(e,2,2,a[2])}};osg.FrameBufferObject=function(){osg.StateAttribute.call(this);this.fbo=void 0;this.attachments=[];this.dirty()};osg.FrameBufferObject.COLOR_ATTACHMENT0=36064;osg.FrameBufferObject.DEPTH_ATTACHMENT=36096;osg.FrameBufferObject.DEPTH_COMPONENT16=33189;
osg.FrameBufferObject.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new osg.FrameBufferObject},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setAttachment:function(a){this.attachments.push(a)},_reportFrameBufferError:function(a){switch(a){case 36054:osg.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:osg.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;
case 36057:osg.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:osg.debug("FRAMEBUFFER_UNSUPPORTED");break;default:osg.debug("FRAMEBUFFER unknown error "+a.toString(16))}},apply:function(a){var c=a.getGraphicContext();if(this.attachments.length>0)if(this.isDirty()){if(!this.fbo)this.fbo=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this.fbo);for(var e=!1,f=0,g=this.attachments.length;f<g;++f)if(this.attachments[f].texture===void 0)e=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,
e),c.renderbufferStorage(c.RENDERBUFFER,this.attachments[f].format,this.attachments[f].width,this.attachments[f].height),c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachments[f].attachment,c.RENDERBUFFER,e),e=!0;else{var h=this.attachments[f].texture;a.applyTextureAttribute(0,h);c.framebufferTexture2D(c.FRAMEBUFFER,this.attachments[f].attachment,h.getTextureTarget(),h.getTextureObject(),this.attachments[f].level)}a=c.checkFramebufferStatus(c.FRAMEBUFFER);a!==36053&&this._reportFrameBufferError(a);
e&&c.bindRenderbuffer(c.RENDERBUFFER,null);this.setDirty(!1)}else c.bindFramebuffer(c.FRAMEBUFFER,this.fbo),osg.reportWebGLError===!0&&(a=c.checkFramebufferStatus(c.FRAMEBUFFER),a!==36053&&this._reportFrameBufferError(a));else c.bindFramebuffer(c.FRAMEBUFFER,null)}});
osg.FrameStamp=function(){var a=0,c=0,e=0;this.setReferenceTime=function(a){c=a};this.setSimulationTime=function(a){e=a};this.getReferenceTime=function(){return c};this.getSimulationTime=function(){return e};this.setFrameNumber=function(c){a=c};this.getFrameNumber=function(){return a}};osg.Geometry=function(){osg.Node.call(this);this.primitives=[];this.attributes={};this.boundingBox=new osg.BoundingBox;this.boundingBoxComputed=!1;this.cacheAttributeList={}};
osg.Geometry.prototype=osg.objectInehrit(osg.Node.prototype,{releaseGLObjects:function(a){for(var c in this.attributes)this.attributes[c].releaseGLObjects(a);c=0;for(var e=this.primitives.length;c<e;c++){var f=this.primitives[c];f.getIndices!==void 0&&f.getIndices()!==void 0&&f.getIndices()!==null&&f.indices.releaseGLObjects(a)}},dirtyBound:function(){if(this.boundingBoxComputed===!0)this.boundingBoxComputed=!1;osg.Node.dirtyBound.call(this)},dirty:function(){this.cacheAttributeList={}},getPrimitives:function(){return this.primitives},
getAttributes:function(){return this.attributes},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},drawImplementation:function(a){var c=a.getLastProgramApplied(),e=c.instanceID;if(this.cacheAttributeList[e]===void 0){var f,g=c.attributesCache,h=[],c="//generated by Geometry::implementation\n";c+="state.lazyDisablingOfVertexAttributes();\n";c+="var attr;\n";for(var j=0,i=g.attributeKeys.length;j<i;j++){var k=g.attributeKeys[j];f=g[k];this.attributes[k]!==
void 0&&(h.push(f),c+='attr = this.attributes["'+k+'"];\n',c+="if (!attr.isValid()) { return; }\n",c+="state.setVertexAttribArray("+f+", attr, false);\n")}c+="state.applyDisablingOfVertexAttributes();\n";g=this.primitives;c+="var primitives = this.primitives;\n";f=0;for(g=g.length;f<g;++f)c+="primitives["+f+"].draw(state);\n";this.cacheAttributeList[e]=new Function("state",c)}this.cacheAttributeList[e].call(this,a)},drawImplementationDummy:function(a){a.getLastProgramApplied();for(var a=0,c=this.primitives.length;a<
c;++a);},getBoundingBox:function(){if(!this.boundingBoxComputed)this.computeBoundingBox(this.boundingBox),this.boundingBoxComputed=!0;return this.boundingBox},computeBoundingBox:function(a){var c=this.getAttributes().Vertex;if(c!==void 0&&c.getElements()!==void 0&&c.getItemSize()>2){var e=[0,0,0];vertexes=c.getElements();for(var c=0,f=vertexes.length;c<f;c+=3)e[0]=vertexes[c],e[1]=vertexes[c+1],e[2]=vertexes[c+2],a.expandByVec3(e)}return a},computeBound:function(a){a.init();var c=this.getBoundingBox();
a.expandByBox(c);return a}});osg.Geometry.prototype.objectType=osg.objectType.generate("Geometry");osg.Light=function(a){osg.StateAttribute.call(this);a===void 0&&(a=0);this._ambient=[0.2,0.2,0.2,1];this._diffuse=[0.8,0.8,0.8,1];this._specular=[0.2,0.2,0.2,1];this._position=[0,0,1,0];this._direction=[0,0,-1];this._spotCutoff=180;this._spotBlend=0.01;this._constantAttenuation=1;this._quadraticAttenuation=this._linearAttenuation=0;this._lightUnit=a;this._enabled=0;this.dirty()};osg.Light.uniforms={};
osg.Light.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Light",cloneType:function(){return new osg.Light(this._lightUnit)},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType+this._lightUnit},getOrCreateUniforms:function(){var a=osg.Light.uniforms,c=this.getTypeMember();if(a[c]===void 0){var e=osg.Uniform;a[c]={ambient:e.createFloat4([0.2,0.2,0.2,1],this.getUniformName("ambient")),diffuse:e.createFloat4([0.8,0.8,0.8,1],this.getUniformName("diffuse")),
specular:e.createFloat4([0.2,0.2,0.2,1],this.getUniformName("specular")),position:e.createFloat4([0,0,1,0],this.getUniformName("position")),direction:e.createFloat3([0,0,1],this.getUniformName("direction")),spotCutoff:e.createFloat1(180,this.getUniformName("spotCutoff")),spotBlend:e.createFloat1(0.01,this.getUniformName("spotBlend")),constantAttenuation:e.createFloat1(0,this.getUniformName("constantAttenuation")),linearAttenuation:e.createFloat1(0,this.getUniformName("linearAttenuation")),quadraticAttenuation:e.createFloat1(0,
this.getUniformName("quadraticAttenuation")),enable:e.createInt1(0,this.getUniformName("enable")),matrix:e.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("matrix")),invMatrix:e.createMatrix4(osg.Matrix.makeIdentity([]),this.getUniformName("invMatrix"))};a[c].uniformKeys=Object.keys(a[c])}return a[c]},setPosition:function(a){osg.Vec4.copy(a,this._position)},getPosition:function(){return this._position},setAmbient:function(a){this._ambient=a;this.dirty()},setSpecular:function(a){this._specular=
a;this.dirty()},setDiffuse:function(a){this._diffuse=a;this.dirty()},setSpotCutoff:function(a){this._spotCutoff=a;this.dirty()},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(a){this._spotBlend=a;this.dirty()},getSpotBlend:function(){return this._spotBlend},setConstantAttenuation:function(a){this._constantAttenuation=a;this.dirty()},setLinearAttenuation:function(a){this._linearAttenuation=a;this.dirty()},setQuadraticAttenuation:function(a){this._quadraticAttenuation=a;this.dirty()},
setDirection:function(a){this._direction=a;this.dirty()},getDirection:function(){return this._direction},setLightNumber:function(a){this._lightUnit=a;this.dirty()},getLightNumber:function(){return this._lightUnit},getPrefix:function(){return this.getType()+this._lightUnit},getParameterName:function(a){return this.getPrefix()+"_"+a},getUniformName:function(a){return this.getPrefix()+"_uniform_"+a},applyPositionedUniform:function(a){var c=this.getOrCreateUniforms();osg.Matrix.copy(a,c.matrix.get());
c.matrix.dirty();osg.Matrix.copy(a,c.invMatrix.get());c.invMatrix.get()[12]=0;c.invMatrix.get()[13]=0;c.invMatrix.get()[14]=0;osg.Matrix.inverse(c.invMatrix.get(),c.invMatrix.get());osg.Matrix.transpose(c.invMatrix.get(),c.invMatrix.get());c.invMatrix.dirty()},apply:function(){var a=this.getOrCreateUniforms();a.ambient.set(this._ambient);a.diffuse.set(this._diffuse);a.specular.set(this._specular);a.position.set(this._position);a.direction.set(this._direction);var c=Math.cos(this._spotCutoff*Math.PI/
180);a.spotCutoff.get()[0]=c;a.spotCutoff.dirty();a.spotBlend.get()[0]=(1-c)*this._spotBlend;a.spotBlend.dirty();a.constantAttenuation.get()[0]=this._constantAttenuation;a.constantAttenuation.dirty();a.linearAttenuation.get()[0]=this._linearAttenuation;a.linearAttenuation.dirty();a.quadraticAttenuation.get()[0]=this._quadraticAttenuation;a.quadraticAttenuation.dirty();this.setDirty(!1)},_replace:function(a,c,e,f){for(var g=0,h=c.length;g<h;g++)e=e.replace(RegExp(a+c[g],"g"),f.call(this,c[g]));return e},
_shader:{},_shaderCommon:{},generateShader:function(a){return this._shader[a]?this._shader[a].call(this):""},generateShaderCommon:function(a){return this._shaderCommon[a]?this._shaderCommon[a].call(this):""}});osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexInit]=function(){return"\nvarying vec3 FragNormal;\nvarying vec3 FragEyeVector;\n\n"};osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexFunction]=function(){return"\nvec3 computeNormal() {\n   return vec3(NormalMatrix * vec4(Normal, 0.0));\n}\n\nvec3 computeEyeVertex() {\n   return vec3(ModelViewMatrix * vec4(Vertex,1.0));\n}\n\n"};
osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.VertexMain]=function(){return"\n  FragEyeVector = computeEyeVertex();\n  FragNormal = computeNormal();\n"};osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentInit]=function(){return"varying vec3 FragNormal;\nvarying vec3 FragEyeVector;\n"};osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentFunction]=function(){return"\nfloat getLightAttenuation(vec3 lightDir, float constant, float linear, float quadratic) {\n    \n    float d = length(lightDir);\n    float att = 1.0 / ( constant + linear*d + quadratic*d*d);\n    return att;\n}\nvec4 computeLightContribution(vec4 materialAmbient,\n                              vec4 materialDiffuse,\n                              vec4 materialSpecular,\n                              float materialShininess,\n                              vec4 lightAmbient,\n                              vec4 lightDiffuse,\n                              vec4 lightSpecular,\n                              vec3 normal,\n                              vec3 eye,\n                              vec3 lightDirection,\n                              vec3 lightSpotDirection,\n                              float lightCosSpotCutoff,\n                              float lightSpotBlend,\n                              float lightAttenuation)\n{\n    vec3 L = lightDirection;\n    vec3 N = normal;\n    float NdotL = max(dot(L, N), 0.0);\n    float halfTerm = NdotL;\n    vec4 ambient = lightAmbient;\n    vec4 diffuse = vec4(0.0);\n    vec4 specular = vec4(0.0);\n    float spot = 0.0;\n\n    if (NdotL > 0.0) {\n        vec3 E = eye;\n        vec3 R = reflect(-L, N);\n        float RdotE = max(dot(R, E), 0.0);\n        if ( RdotE > 0.0) {\n           RdotE = pow( RdotE, materialShininess );\n        }\n        vec3 D = lightSpotDirection;\n        spot = 1.0;\n        if (lightCosSpotCutoff > 0.0) {\n          float cosCurAngle = dot(-L, D);\n          if (cosCurAngle < lightCosSpotCutoff) {\n             spot = 0.0;\n          } else {\n             if (lightSpotBlend > 0.0)\n               spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle-lightCosSpotCutoff)/(lightSpotBlend));\n          }\n        }\n        diffuse = lightDiffuse * ((halfTerm));\n        specular = lightSpecular * RdotE;\n    }\n\n    return (materialAmbient*ambient + (materialDiffuse*diffuse + materialSpecular*specular) * spot) * lightAttenuation;\n}\nfloat linearrgb_to_srgb1(const in float c)\n{\n  float v = 0.0;\n  if(c < 0.0031308) {\n    if ( c > 0.0)\n      v = c * 12.92;\n  } else {\n    v = 1.055 * pow(c, 1.0/2.4) - 0.055;\n  }\n  return v;\n}\nvec4 linearrgb_to_srgb(const in vec4 col_from)\n{\n  vec4 col_to;\n  col_to.r = linearrgb_to_srgb1(col_from.r);\n  col_to.g = linearrgb_to_srgb1(col_from.g);\n  col_to.b = linearrgb_to_srgb1(col_from.b);\n  col_to.a = col_from.a;\n  return col_to;\n}\nfloat srgb_to_linearrgb1(const in float c)\n{\n  float v = 0.0;\n  if(c < 0.04045) {\n    if (c >= 0.0)\n      v = c * (1.0/12.92);\n  } else {\n    v = pow((c + 0.055)*(1.0/1.055), 2.4);\n  }\n return v;\n}\nvec4 srgb2linear(const in vec4 col_from)\n{\n  vec4 col_to;\n  col_to.r = srgb_to_linearrgb1(col_from.r);\n  col_to.g = srgb_to_linearrgb1(col_from.g);\n  col_to.b = srgb_to_linearrgb1(col_from.b);\n  col_to.a = col_from.a;\n  return col_to;\n}\n"};
osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentMain]=function(){return"\n  vec3 normal = normalize(FragNormal);\n  vec3 eyeVector = normalize(-FragEyeVector);\n  vec4 lightColor = MaterialEmission;\n"};osg.Light.prototype._shaderCommon[osg.ShaderGeneratorType.FragmentEnd]=function(){return"\n  fragColor *= lightColor;\n"};
osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){var a="\nuniform vec4 Light_position;\nuniform vec3 Light_direction;\nuniform mat4 Light_matrix;\nuniform mat4 Light_invMatrix;\nuniform float Light_constantAttenuation;\nuniform float Light_linearAttenuation;\nuniform float Light_quadraticAttenuation;\nuniform vec4 Light_ambient;\nuniform vec4 Light_diffuse;\nuniform vec4 Light_specular;\nuniform float Light_spotCutoff;\nuniform float Light_spotBlend;\n";uniforms=Object.keys(this.getOrCreateUniforms());
return a=this._replace("Light_",uniforms,a,this.getUniformName)};
osg.Light.prototype._shader[osg.ShaderGeneratorType.FragmentMain]=function(){var a;a=this._replace("",["lightEye","lightDir","spotDirection","attenuation"],"\n  vec3 lightEye = vec3(Light_matrix * Light_position);\n  vec3 lightDir;\n  if (Light_position[3] == 1.0) {\n    lightDir = lightEye - FragEyeVector;\n  } else {\n    lightDir = lightEye;\n  }\n  vec3 spotDirection = normalize(mat3(vec3(Light_invMatrix[0]), vec3(Light_invMatrix[1]), vec3(Light_invMatrix[2]))*Light_direction);\n  float attenuation = getLightAttenuation(lightDir, Light_constantAttenuation, Light_linearAttenuation, Light_quadraticAttenuation);\n  lightDir = normalize(lightDir);\n  lightColor += computeLightContribution(MaterialAmbient,\n                                         MaterialDiffuse, \n                                         MaterialSpecular,\n                                         MaterialShininess,\n                                         Light_ambient,\n                                         Light_diffuse,\n                                         Light_specular,\n                                         normal,\n                                         eyeVector,\n                                         lightDir,\n                                         spotDirection,\n                                         Light_spotCutoff,\n                                         Light_spotBlend,\n                                         attenuation);\n",this.getParameterName);
uniforms=Object.keys(this.getOrCreateUniforms());return a=this._replace("Light_",uniforms,a,this.getUniformName)};osg.LightSource=function(){osg.Node.call(this);this._light=void 0};osg.LightSource.prototype=osg.objectInehrit(osg.Node.prototype,{getLight:function(){return this._light},setLight:function(a){this._light=a}});osg.LightSource.prototype.objectType=osg.objectType.generate("LightSource");
osg.LineWidth=function(a){osg.StateAttribute.call(this);this.lineWidth=1;if(a!==void 0)this.lineWidth=a};osg.LineWidth.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"LineWidth",cloneType:function(){return new osg.LineWidth},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(a){a.getGraphicContext().lineWidth(this.lineWidth)}});
osg.Material=function(){osg.StateAttribute.call(this);this.ambient=[0.2,0.2,0.2,1];this.diffuse=[0.8,0.8,0.8,1];this.specular=[0,0,0,1];this.emission=[0,0,0,1];this.shininess=12.5};
osg.Material.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{setEmission:function(a){osg.Vec4.copy(a,this.emission);this._dirty=!0},setAmbient:function(a){osg.Vec4.copy(a,this.ambient);this._dirty=!0},setSpecular:function(a){osg.Vec4.copy(a,this.specular);this._dirty=!0},setDiffuse:function(a){osg.Vec4.copy(a,this.diffuse);this._dirty=!0},setShininess:function(a){this.shininess=a;this._dirty=!0},getEmission:function(){return this.emission},getAmbient:function(){return this.ambient},getSpecular:function(){return this.specular},
getDiffuse:function(){return this.diffuse},getShininess:function(){return this.shininess},attributeType:"Material",cloneType:function(){return new osg.Material},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(){if(osg.Material.uniforms===void 0){osg.Material.uniforms={ambient:osg.Uniform.createFloat4([0,0,0,0],"MaterialAmbient"),diffuse:osg.Uniform.createFloat4([0,0,0,0],"MaterialDiffuse"),specular:osg.Uniform.createFloat4([0,
0,0,0],"MaterialSpecular"),emission:osg.Uniform.createFloat4([0,0,0,0],"MaterialEmission"),shininess:osg.Uniform.createFloat1([0],"MaterialShininess")};var a=[],c;for(c in osg.Material.uniforms)a.push(c);osg.Material.uniforms.uniformKeys=a}return osg.Material.uniforms},apply:function(){var a=this.getOrCreateUniforms();a.ambient.set(this.ambient);a.diffuse.set(this.diffuse);a.specular.set(this.specular);a.emission.set(this.emission);a.shininess.set([this.shininess]);this._dirty=!1},_shader:{},_shaderCommon:{},
generateShader:function(a){return this._shader[a]?this._shader[a].call(this):""}});osg.Material.prototype._shader[osg.ShaderGeneratorType.VertexInit]=function(){return"uniform vec4 MaterialAmbient;\nuniform vec4 MaterialDiffuse;\nuniform vec4 MaterialSpecular;\nuniform vec4 MaterialEmission;\nuniform float MaterialShininess;\n"};osg.Material.prototype._shader[osg.ShaderGeneratorType.FragmentInit]=function(){return"uniform vec4 MaterialAmbient;\nuniform vec4 MaterialDiffuse;\nuniform vec4 MaterialSpecular;\nuniform vec4 MaterialEmission;\nuniform float MaterialShininess;\n"};
osg.MatrixTransform=function(){osg.Transform.call(this);this.matrix=osg.Matrix.makeIdentity([])};
osg.MatrixTransform.prototype=osg.objectInehrit(osg.Transform.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(a){this.matrix=a},computeLocalToWorldMatrix:function(a){this.referenceFrame===osg.Transform.RELATIVE_RF&&osg.Matrix.preMult(a,this.matrix);return!0},computeWorldToLocalMatrix:function(a){var c=[];osg.Matrix.inverse(this.matrix,c);this.referenceFrame===osg.Transform.RELATIVE_RF&&osg.Matrix.postMult(c,a);return!0}});osg.MatrixTransform.prototype.objectType=osg.objectType.generate("MatrixTransform");
osg.PrimitiveSet=function(){};osg.PrimitiveSet.POINTS=0;osg.PrimitiveSet.LINES=1;osg.PrimitiveSet.LINE_LOOP=2;osg.PrimitiveSet.LINE_STRIP=3;osg.PrimitiveSet.TRIANGLES=4;osg.PrimitiveSet.TRIANGLE_STRIP=5;osg.PrimitiveSet.TRIANGLE_FAN=6;osg.DrawArrays=function(a,c,e){this.mode=a;this.first=c;this.count=e};osg.DrawArrays.prototype={draw:function(a){a.getGraphicContext().drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first}};
osg.DrawArrays.create=function(a,c,e){osg.log("osg.DrawArrays.create is deprecated, use new osg.DrawArrays with same arguments");return new osg.DrawArrays(a,c,e)};osg.DrawArrayLengths=function(a,c,e){this._mode=a;this._first=c;this._arrayLengths=e.slice(0)};
osg.DrawArrayLengths.prototype={draw:function(a){for(var a=a.getGraphicContext(),c=this._mode,e=this._first,f=this._arrayLengths,g=0,h=f.length;g<h;g++){var j=f[g];a.drawArrays(c,e,j);e+=j}},getMode:function(){return this._mode},getNumIndices:function(){for(var a=0,c=this._arrayLengths,e=0,f=c.length;e<f;e++)a+=c[e];return a},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(a){this._first=a}};
osg.DrawElements=function(a,c){this.mode=osg.PrimitiveSet.POINTS;if(a!==void 0)this.mode=a;this.offset=this.count=0;this.indices=c;c!==void 0&&this.setIndices(c)};
osg.DrawElements.prototype={getMode:function(){return this.mode},draw:function(a){a.setIndexArray(this.indices);a=a.getGraphicContext();a.drawElements(this.mode,this.count,a.UNSIGNED_SHORT,this.offset)},setIndices:function(a){this.indices=a;this.count=a.getElements().length},getIndices:function(){return this.indices},setFirst:function(a){this.offset=a},getFirst:function(){return this.offset},setCount:function(a){this.count=a},getCount:function(){return this.count}};
osg.DrawElements.create=function(a,c){osg.log("osg.DrawElements.create is deprecated, use new osg.DrawElements with same arguments");return new osg.DrawElements(a,c)};osg.Program=function(a,c){osg.StateAttribute.call(this);if(osg.Program.instanceID===void 0)osg.Program.instanceID=0;this.instanceID=osg.Program.instanceID;osg.Program.instanceID+=1;this.program=null;this.setVertexShader(a);this.setFragmentShader(c);this.dirty=!0};
osg.Program.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Program",cloneType:function(){var a=new osg.Program;a.default_program=!0;return a},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setVertexShader:function(a){this.vertex=a},setFragmentShader:function(a){this.fragment=a},getVertexShader:function(){return this.vertex},getFragmentShader:function(){return this.fragment},apply:function(){if(!this.program||this.isDirty()){if(this.default_program===
!0)return;this.vertex.shader||this.vertex.compile();this.fragment.shader||this.fragment.compile();this.program=gl.createProgram();gl.attachShader(this.program,this.vertex.shader);gl.attachShader(this.program,this.fragment.shader);gl.linkProgram(this.program);gl.validateProgram(this.program);if(!gl.getProgramParameter(this.program,gl.LINK_STATUS)&&!gl.isContextLost())return osg.log("can't link program\nvertex shader:\n"+this.vertex.text+"\n fragment shader:\n"+this.fragment.text),osg.log(gl.getProgramInfoLog(this.program)),
this.setDirty(!1),null;this.uniformsCache={};this.uniformsCache.uniformKeys=[];this.attributesCache={};this.attributesCache.attributeKeys=[];this.cacheUniformList(this.vertex.text);this.cacheUniformList(this.fragment.text);this.cacheAttributeList(this.vertex.text);this.setDirty(!1)}gl.useProgram(this.program)},cacheUniformList:function(a){a=a.match(/uniform\s+\w+\s+\w+/g);if(a!==null)for(var c=0,e=a.length;c<e;c++){var f=a[c].match(/uniform\s+\w+\s+(\w+)/)[1],g=gl.getUniformLocation(this.program,
f);g!==void 0&&g!==null&&this.uniformsCache[f]===void 0&&(this.uniformsCache[f]=g,this.uniformsCache.uniformKeys.push(f))}},cacheAttributeList:function(a){a=a.match(/attribute\s+\w+\s+\w+/g);if(a!==null)for(var c=0,e=a.length;c<e;c++){var f=a[c].match(/attribute\s+\w+\s+(\w+)/)[1],g=gl.getAttribLocation(this.program,f);g!==-1&&g!==void 0&&this.attributesCache[f]===void 0&&(this.attributesCache[f]=g,this.attributesCache.attributeKeys.push(f))}}});
osg.Program.create=function(a,c){console.log("osg.Program.create is deprecated use new osg.Program(vertex, fragment) instead");return new osg.Program(a,c)};osg.Projection=function(){osg.Node.call(this);this.projection=osg.Matrix.makeIdentity([])};osg.Projection.prototype=osg.objectInehrit(osg.Node.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(a){this.projection=a}});osg.Projection.prototype.objectType=osg.objectType.generate("Projection");
osg.Quat={copy:function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},makeIdentity:function(a){return osg.Quat.init(a)},zeroRotation:function(a){return osg.Quat.init(a)},init:function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a},sub:function(a,c,e){e[0]=a[0]-c[0];e[1]=a[1]-c[1];e[2]=a[2]-c[2];e[3]=a[3]-c[3];return e},add:function(a,c,e){e[0]=a[0]+c[0];e[1]=a[1]+c[1];e[2]=a[2]+c[2];e[3]=a[3]+c[3];return e},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]},length2:function(a){return a[0]*
a[0]+a[1]*a[1]+a[2]*a[2]+a[3]*a[3]},neg:function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c},makeRotate:function(a,c,e,f,g){var h=Math.sqrt(c*c+e*e+f*f);if(h<1.0E-7)return this.init();var h=1/h,j=Math.cos(0.5*a),a=Math.sin(0.5*a);g===void 0&&(g=[]);g[0]=c*a*h;g[1]=e*a*h;g[2]=f*a*h;g[3]=j;return g},lerp:function(a,c,e,f){f[0]=c[0]+(e[0]-c[0])*a;f[1]=c[1]+(e[1]-c[1])*a;f[2]=c[2]+(e[2]-c[2])*a;f[3]=c[3]+(e[3]-c[3])*a;return f},slerp:function(a,c,e,f){var g=this.dot(c,e);g<0&&(g=-g,this.neg(e,
e));var h,j;1-g>1.0E-5?(h=Math.acos(g),j=Math.sin(h),g=Math.sin((1-a)*h)/j,a=Math.sin(a*h)/j):g=1-a;f[0]=c[0]*g+e[0]*a;f[1]=c[1]*g+e[1]*a;f[2]=c[2]*g+e[2]*a;f[3]=c[3]*g+e[3]*a;return f},normalize:function(a,c){var e=1/this.length2(a);c[0]=a[0]*e;c[1]=a[1]*e;c[2]=a[2]*e;c[3]=a[3]*e;return c},conj:function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=a[3];return c},inverse:function(a,c){var e=1/this.length2(a);this.conj(a,c);c[0]*=e;c[1]*=e;c[2]*=e;c[3]*=e;return c},mult:function(a,c,e){e[0]=a[0]*c[3]+
a[1]*c[2]-a[2]*c[1]+a[3]*c[0];e[1]=-a[0]*c[2]+a[1]*c[3]+a[2]*c[0]+a[3]*c[1];e[2]=a[0]*c[1]-a[1]*c[0]+a[2]*c[3]+a[3]*c[2];e[3]=-a[0]*c[0]-a[1]*c[1]-a[2]*c[2]+a[3]*c[3];return e},div:function(a,c,e){c=1/c;e[0]=a[0]*c;e[1]=a[1]*c;e[2]=a[2]*c;e[3]=a[3]*c;return e},exp:function(a,c){var e=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),f=Math.exp(a[3]),g=0;e>1.0E-5&&(g=f*Math.sin(e)/e);c===void 0&&(c=[]);c[0]=g*a[0];c[1]=g*a[1];c[2]=g*a[2];c[3]=f*Math.cos(e);return c},ln:function(a,c){var e=a[0]*a[0]+a[1]*a[1]+
a[2]*a[2],f=Math.sqrt(e),g=0;f>1.0E-5&&(g=Math.atan2(f,a[3])/f);c===void 0&&(c=[]);e+=a[3]*a[3];c[0]=g*a[0];c[1]=g*a[1];c[2]=g*a[2];c[3]=0.5*Math.log(e);return c},squad:function(a,c,e,f,g,h){c=this.slerp(a,c,g);e=this.slerp(a,e,f);return this.slerp(2*a*(1-a),c,e,h)},computeTangent:function(a,c,e,f){c=this.inv(c);this.mult(e,c,void 0);this.ln(void 0,void 0);this.mult(a,c,void 0);this.ln(void 0,void 0);this.add(void 0,void 0,void 0);this.div(void 0,-4,void 0);this.exp(void 0,void 0);return this.mult(void 0,
q1,f)}};osg.RenderBin=function(){this._leafs=[];this.positionedAttribute=[];this._renderStage=void 0;this._bins={};this.stateGraphList=[];this._parent=void 0;this._binNum=0;this._sorted=!1;this._sortMode=osg.RenderBin.SORT_BY_STATE};osg.RenderBin.SORT_BY_STATE=0;osg.RenderBin.SORT_BACK_TO_FRONT=1;osg.RenderBin.BinPrototypes={RenderBin:function(){return new osg.RenderBin},DepthSortedBin:function(){var a=new osg.RenderBin;a._sortMode=osg.RenderBin.SORT_BACK_TO_FRONT;return a}};
osg.RenderBin.prototype={_createRenderBin:function(a){return a===void 0||osg.RenderBin.BinPrototypes[a]===void 0?osg.RenderBin.BinPrototypes.RenderBin():osg.RenderBin.BinPrototypes[a]()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var a=!1,c=0,e=this.stateGraphList.length;c<e;c++)for(var f=this.stateGraphList[c].leafs,g=0,h=f.length;g<h;g++){var j=f[g];isNaN(j.depth)?a=!0:this._leafs.push(j)}a&&
osg.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted.");this.stateGraphList.splice(0,this.stateGraphList.length)},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList();this._leafs.sort(function(a,c){return c.depth-a.depth})},sortImplementation:function(){var a=osg.RenderBin;switch(this._sortMode){case a.SORT_BACK_TO_FRONT:this.sortBackToFront()}},sort:function(){if(!this._sorted){for(var a=this._bins,
c=Object.keys(a),e=0,f=c.length;e<f;e++)a[c[e]].sort();this.sortImplementation();_sorted=!0}},setParent:function(a){this._parent=a},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(a,c){var e=this._bins[a];if(e===void 0)e=this._createRenderBin(c),e._parent=this,e._binNum=a,e._renderStage=this._renderStage,this._bins[a]=e;return e},getStage:function(){return this._renderStage},addStateGraph:function(a){this.stateGraphList.push(a)},reset:function(){this.stateGraphList.length=
0;this._bins={};this.positionedAttribute.length=0;this._leafs.length=0;this._sorted=!1},applyPositionedAttribute:function(a,c){for(var e=0,f=c.length;e<f;e++){var g=c[e],h=g[1],g=g[0];a.setGlobalDefaultValue(h);h.apply(a);h.applyPositionedUniform(g,a);a.haveAppliedAttribute(h)}},drawImplementation:function(a,c){for(var e=c,f=Object.keys(this._bins),g=this._bins,h=[],j=0,i=f.length;j<i;j++)h.push(g[f[j]]);h.sort(function(a,c){return a._binNum-c._binNum});f=0;for(g=h.length;f<g;f++){j=h[f];if(j.getBinNumber()>
0)break;e=j.drawImplementation(a,e)}for(e=this.drawLeafs(a,e);f<g;f++)j=h[f],e=j.drawImplementation(a,e);return e},drawLeafs:function(a,c){var e=this.stateGraphList,f=this._leafs,g,h,j,i=c,k=[],m=osg.Matrix;i&&osg.StateGraph.prototype.moveToRootStateGraph(a,c.parent);for(var n,p,q,u,s=0,w=f.length;s<w;s++)n=f[s],p=!1,i!==void 0?(i=i.parent,q=i.parent,u=n.parent,q!==u.parent?(u.moveStateGraph(a,q,u.parent),a.pushStateSet(u.stateset),p=!0):u!==i&&(a.pushStateSet(u.stateset),p=!0)):(n.parent.moveStateGraph(a,
void 0,n.parent.parent),a.pushStateSet(n.parent.stateset),p=!0),p===!0&&(a.apply(),g=a.getLastProgramApplied(),h=g.uniformsCache[a.modelViewMatrix.name],j=g.uniformsCache[a.projectionMatrix.name],g=g.uniformsCache[a.normalMatrix.name]),h!==void 0&&(a.modelViewMatrix.set(n.modelview),a.modelViewMatrix.apply(h)),j!==void 0&&(a.projectionMatrix.set(n.projection),a.projectionMatrix.apply(j)),g!==void 0&&(m.copy(n.modelview,k),k[12]=0,k[13]=0,k[14]=0,m.inverse(k,k),m.transpose(k,k),a.normalMatrix.set(k),
a.normalMatrix.apply(g)),n.geometry.drawImplementation(a),p===!0&&(a.popGeneratedProgram(),a.popStateSet()),i=n;f=0;for(s=e.length;f<s;f++)for(var w=e[f],B=0,E=w.leafs.length;B<E;B++)n=w.leafs[B],p=!1,i!==void 0?(i=i.parent,q=i.parent,u=n.parent,q!==u.parent?(u.moveStateGraph(a,q,u.parent),a.pushStateSet(u.stateset),p=!0):u!==i&&(a.pushStateSet(u.stateset),p=!0)):(n.parent.moveStateGraph(a,void 0,n.parent.parent),a.pushStateSet(n.parent.stateset),p=!0),p===!0&&(a.apply(),g=a.getLastProgramApplied(),
h=g.uniformsCache[a.modelViewMatrix.name],j=g.uniformsCache[a.projectionMatrix.name],g=g.uniformsCache[a.normalMatrix.name]),h!==void 0&&(a.modelViewMatrix.set(n.modelview),a.modelViewMatrix.apply(h)),j!==void 0&&(a.projectionMatrix.set(n.projection),a.projectionMatrix.apply(j)),g!==void 0&&(m.copy(n.modelview,k),k[12]=0,k[13]=0,k[14]=0,m.inverse(k,k),m.transpose(k,k),a.normalMatrix.set(k),a.normalMatrix.apply(g)),n.geometry.drawImplementation(a),p===!0&&(a.popGeneratedProgram(),a.popStateSet()),
i=n;return i}};osg.RenderStage=function(){osg.RenderBin.call(this);this.positionedAttribute=[];this.clearDepth=1;this.clearColor=[0,0,0,1];this.clearMask=osg.Camera.COLOR_BUFFER_BIT|osg.Camera.DEPTH_BUFFER_BIT;this.viewport=this.camera=void 0;this.preRenderList=[];this.postRenderList=[];this._renderStage=this};
osg.RenderStage.prototype=osg.objectInehrit(osg.RenderBin.prototype,{reset:function(){osg.RenderBin.prototype.reset.call(this);this.preRenderList.length=0;this.postRenderList.length=0},setClearDepth:function(a){this.clearDepth=a},getClearDepth:function(){return this.clearDepth},setClearColor:function(a){this.clearColor=a},getClearColor:function(){return this.clearColor},setClearMask:function(a){this.clearMask=a},getClearMask:function(){return this.clearMask},setViewport:function(a){this.viewport=
a},getViewport:function(){return this.viewport},setCamera:function(a){this.camera=a},addPreRenderStage:function(a,c){for(var e=0,f=this.preRenderList.length;e<f;e++)if(c<this.preRenderList[e].order)break;e<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(e,0,{order:c,renderStage:a}):this.preRenderList.push({order:c,renderStage:a})},addPostRenderStage:function(a,c){for(var e=0,f=this.postRenderList.length;e<f;e++)if(c<this.postRenderList[e].order)break;e<this.postRenderList.length?
this.postRenderList=this.postRenderList.splice(e,0,{order:c,renderStage:a}):this.postRenderList.push({order:c,renderStage:a})},drawPreRenderStages:function(a,c){for(var e=c,f=0,g=this.preRenderList.length;f<g;++f)e=this.preRenderList[f].renderStage.draw(a,e);return e},draw:function(a,c){var e=this.drawPreRenderStages(a,c),e=this.drawImplementation(a,e);return e=this.drawPostRenderStages(a,e)},sort:function(){for(var a=0,c=this.preRenderList.length;a<c;++a)this.preRenderList[a].renderStage.sort();
for(osg.RenderBin.prototype.sort.call(this);a<c;++a)this.postRenderList[a].renderStage.sort()},drawPostRenderStages:function(a,c){for(var e=c,f=0,g=this.postRenderList.length;f<g;++f)e=this.postRenderList[f].renderStage.draw(a,e);return e},applyCamera:function(a){var c=a.getGraphicContext();if(this.camera===void 0)c.bindFramebuffer(c.FRAMEBUFFER,null);else{var c=this.camera.getViewport(),e=this.camera.frameBufferObject;if(!e)e=new osg.FrameBufferObject,this.camera.frameBufferObject=e;if(e.isDirty()&&
this.camera.attachments!==void 0)for(var f in this.camera.attachments){var g=this.camera.attachments[f],h;if(g.texture===void 0)h={attachment:f,format:g.format,width:c.width(),height:c.height()};else if(g.texture!==void 0&&(h={attachment:f,texture:g.texture,level:g.level},g.format))h.format=g.format;e.setAttachment(h)}e.apply(a)}},drawImplementation:function(a,c){var e=a.getGraphicContext();this.applyCamera(a);this.viewport===void 0&&osg.log("RenderStage does not have a valid viewport");a.applyAttribute(this.viewport);
this.clearMask&e.COLOR_BUFFER_BIT&&e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]);this.clearMask&e.DEPTH_BUFFER_BIT&&(e.depthMask(!0),e.clearDepth(this.clearDepth));e.clear(this.clearMask);this.positionedAttribute&&this.applyPositionedAttribute(a,this.positionedAttribute);return osg.RenderBin.prototype.drawImplementation.call(this,a,c)}});osg.ShaderGenerator=function(){this.cache=[]};
osg.ShaderGenerator.prototype={getActiveTypeMember:function(a){for(var c=[],e=0,f=a.attributeMap.attributeKeys.length;e<f;e++){var g=a.attributeMap.attributeKeys[e],h=a.attributeMap[g];h.length===0&&h.globalDefault.applyPositionedUniform===void 0||(h.globalDefault.getOrCreateUniforms!==void 0||h.globalDefault.writeToShader!==void 0)&&c.push(g)}e=0;for(f=a.textureAttributeMapList.length;e<f;e++)if(g=a.textureAttributeMapList[e],g!==void 0)for(var h=0,j=g.attributeKeys.length;h<j;h++){var i=g.attributeKeys[h],
k=g[i];k.length!==0&&(k.globalDefault.getOrCreateUniforms!==void 0||k.globalDefault.writeToShader!==void 0)&&c.push(i+e)}return c},getActiveAttributeMapKeys:function(a){for(var c=[],e=0,f=a.attributeMap.attributeKeys.length;e<f;e++){var g=a.attributeMap.attributeKeys[e],h=a.attributeMap[g];h.length===0&&h.globalDefault.applyPositionedUniform===void 0||(h.globalDefault.getOrCreateUniforms!==void 0||h.globalDefault.writeToShader!==void 0)&&c.push(g)}return c},getActiveTextureAttributeMapKeys:function(a){for(var c=
[],e=0,f=a.textureAttributeMapList.length;e<f;e++){var g=a.textureAttributeMapList[e];if(g!==void 0){c[e]=[];for(var h=0,j=g.attributeKeys.length;h<j;h++){var i=g.attributeKeys[h],k=g[i];k.length!==0&&(k.globalDefault.getOrCreateUniforms!==void 0||k.globalDefault.writeToShader!==void 0)&&c[e].push(i)}}}return c},getActiveUniforms:function(a,c,e){for(var f={},g=0,h=c.length;g<h;g++){var j=c[g];if(a.attributeMap[j].globalDefault.getOrCreateUniforms!==void 0)for(var j=a.attributeMap[j].globalDefault.getOrCreateUniforms(),
i=0,k=j.uniformKeys.length;i<k;i++){var m=j[j.uniformKeys[i]];f[m.name]=m}}c=0;for(g=e.length;c<g;c++)if(h=e[c],h!==void 0){j=0;for(i=h.length;j<i;j++)if(k=a.textureAttributeMapList[c][h[j]].globalDefault,k.getOrCreateUniforms!==void 0)for(var k=k.getOrCreateUniforms(c),m=0,n=k.uniformKeys.length;m<n;m++){var p=k[k.uniformKeys[m]];f[p.name]=p}}var a=[],q;for(q in f)a.push(q);f.uniformKeys=a;return f},getOrCreateProgram:function(a){for(var c=this.getActiveTypeMember(a),e=0,f=this.cache.length;e<f;++e)if(this.compareAttributeMap(c,
this.cache[e].flattenKeys)===0)return this.cache[e];var e=this.getActiveAttributeMapKeys(a),f=this.getActiveTextureAttributeMapKeys(a),g=this.getOrCreateVertexShader(a,e,f),h=this.getOrCreateFragmentShader(a,e,f),g=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,g),new osg.Shader(gl.FRAGMENT_SHADER,h));g.flattenKeys=c;g.activeAttributeKeys=e;g.activeTextureAttributeKeys=f;g.activeUniforms=this.getActiveUniforms(a,e,f);g.generated=!0;osg.log(g.vertex.text);osg.log(g.fragment.text);this.cache.push(g);
return g},compareAttributeMap:function(a,c){for(var e,f=0,g=a.length;f<g;f++)if(e=a[f],c.indexOf(e)===-1)return 1;return c.length!==a.length?-1:0},fillTextureShader:function(a,c,e){for(var f="",g={},h=0,j=c.length;h<j;h++){var i=c[h];if(i!==void 0)for(var k=a[h],m=0,n=i.length;m<n;m++){var p=i[m],q=k[p].globalDefault;q.generateShaderCommon!==void 0&&g[p]===void 0&&(f+=q.generateShaderCommon(h,e),g[p]=!0);q.generateShader&&(f+=q.generateShader(h,e))}}return f},fillShader:function(a,c,e){for(var f=
"",g={},h=0,j=c.length;h<j;h++){var i=a[c[h]].globalDefault,k=i.getType();i.generateShaderCommon!==void 0&&g[k]===void 0&&(f+=i.generateShaderCommon(e),g[k]=!0);i.generateShader&&(f+=i.generateShader(e))}return f},getOrCreateVertexShader:function(a,c,e){var f=osg.ShaderGeneratorType,g="\n#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 Vertex;\nattribute vec4 Color;\nattribute vec3 Normal;\nuniform int ArrayColorEnabled;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\nuniform mat4 NormalMatrix;\nvarying vec4 VertexColor;\n";
g+=this._writeShaderFromMode(a,c,e,f.VertexInit);g+="\nvec4 ftransform() {\n  return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);\n}";g+=this._writeShaderFromMode(a,c,e,f.VertexFunction);g+="\nvoid main(void) {\n  gl_Position = ftransform();\n  if (ArrayColorEnabled == 1)\n    VertexColor = Color;\n  else\n    VertexColor = vec4(1.0,1.0,1.0,1.0);\n";g+=this._writeShaderFromMode(a,c,e,f.VertexMain);g+="}\n";return g},_writeShaderFromMode:function(a,c,e,f){var g="";g+=this.fillTextureShader(a.textureAttributeMapList,
e,f);g+=this.fillShader(a.attributeMap,c,f);return g},getOrCreateFragmentShader:function(a,c,e){var f="\n#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 VertexColor;\nuniform int ArrayColorEnabled;\nvec4 fragColor;\n",g=osg.ShaderGeneratorType;f+=this._writeShaderFromMode(a,c,e,g.FragmentInit);f+=this._writeShaderFromMode(a,c,e,g.FragmentFunction);f+="void main(void) {\n  fragColor = VertexColor;\n";f+=this._writeShaderFromMode(a,c,e,g.FragmentMain);f+=this._writeShaderFromMode(a,c,e,g.FragmentEnd);
f+="\n  gl_FragColor = fragColor;\n}";return f}};
osg.createTexturedBoxGeometry=function(a,c,e,f,g,h){var j=new osg.Geometry;f/=2;g/=2;h/=2;var i=[],k=[],m=[];i[0]=a-f;i[1]=c-g;i[2]=e+h;m[0]=0;m[1]=-1;m[2]=0;k[0]=0;k[1]=1;i[3]=a-f;i[4]=c-g;i[5]=e-h;m[3]=0;m[4]=-1;m[5]=0;k[2]=0;k[3]=0;i[6]=a+f;i[7]=c-g;i[8]=e-h;m[6]=0;m[7]=-1;m[8]=0;k[4]=1;k[5]=0;i[9]=a+f;i[10]=c-g;i[11]=e+h;m[9]=0;m[10]=-1;m[11]=0;k[6]=1;k[7]=1;i[12]=a+f;i[13]=c+g;i[14]=e+h;m[12]=0;m[13]=1;m[14]=0;k[8]=0;k[9]=1;i[15]=a+f;i[16]=c+g;i[17]=e-h;m[15]=0;m[16]=1;m[17]=0;k[10]=0;k[11]=
0;i[18]=a-f;i[19]=c+g;i[20]=e-h;m[18]=0;m[19]=1;m[20]=0;k[12]=1;k[13]=0;i[21]=a-f;i[22]=c+g;i[23]=e+h;m[21]=0;m[22]=1;m[23]=0;k[14]=1;k[15]=1;i[24]=a+f;i[25]=c-g;i[26]=e+h;m[24]=1;m[25]=0;m[26]=0;k[16]=0;k[17]=1;i[27]=a+f;i[28]=c-g;i[29]=e-h;m[27]=1;m[28]=0;m[29]=0;k[18]=0;k[19]=0;i[30]=a+f;i[31]=c+g;i[32]=e-h;m[30]=1;m[31]=0;m[32]=0;k[20]=1;k[21]=0;i[33]=a+f;i[34]=c+g;i[35]=e+h;m[33]=1;m[34]=0;m[35]=0;k[22]=1;k[23]=1;i[36]=a-f;i[37]=c+g;i[38]=e+h;m[36]=-1;m[37]=0;m[38]=0;k[24]=0;k[25]=1;i[39]=a-
f;i[40]=c+g;i[41]=e-h;m[39]=-1;m[40]=0;m[41]=0;k[26]=0;k[27]=0;i[42]=a-f;i[43]=c-g;i[44]=e-h;m[42]=-1;m[43]=0;m[44]=0;k[28]=1;k[29]=0;i[45]=a-f;i[46]=c-g;i[47]=e+h;m[45]=-1;m[46]=0;m[47]=0;k[30]=1;k[31]=1;i[48]=a-f;i[49]=c+g;i[50]=e+h;m[48]=0;m[49]=0;m[50]=1;k[32]=0;k[33]=1;i[51]=a-f;i[52]=c-g;i[53]=e+h;m[51]=0;m[52]=0;m[53]=1;k[34]=0;k[35]=0;i[54]=a+f;i[55]=c-g;i[56]=e+h;m[54]=0;m[55]=0;m[56]=1;k[36]=1;k[37]=0;i[57]=a+f;i[58]=c+g;i[59]=e+h;m[57]=0;m[58]=0;m[59]=1;k[38]=1;k[39]=1;i[60]=a+f;i[61]=
c+g;i[62]=e-h;m[60]=0;m[61]=0;m[62]=-1;k[40]=0;k[41]=1;i[63]=a+f;i[64]=c-g;i[65]=e-h;m[63]=0;m[64]=0;m[65]=-1;k[42]=0;k[43]=0;i[66]=a-f;i[67]=c-g;i[68]=e-h;m[66]=0;m[67]=0;m[68]=-1;k[44]=1;k[45]=0;i[69]=a-f;i[70]=c+g;i[71]=e-h;m[69]=0;m[70]=0;m[71]=-1;k[46]=1;k[47]=1;j.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,i,3);j.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,m,3);j.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,
k,2);a=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],1));j.getPrimitives().push(a);return j};
osg.createTexturedQuadGeometry=function(a,c,e,f,g,h,j,i,k,m,n,p,q){p===void 0&&q===void 0&&(p=m,q=n,n=m=0);var u=new osg.Geometry,s=[];s[0]=a+j;s[1]=c+i;s[2]=e+k;s[3]=a;s[4]=c;s[5]=e;s[6]=a+f;s[7]=c+g;s[8]=e+h;s[9]=a+f+j;s[10]=c+g+i;s[11]=e+h+k;p===void 0&&(p=1);q===void 0&&(q=1);a=[];a[0]=m;a[1]=q;a[2]=m;a[3]=n;a[4]=p;a[5]=n;a[6]=p;a[7]=q;f=osg.Vec3.cross([f,g,h],[j,i,k],[]);g=[];g[0]=f[0];g[1]=f[1];g[2]=f[2];g[3]=f[0];g[4]=f[1];g[5]=f[2];g[6]=f[0];g[7]=f[1];g[8]=f[2];g[9]=f[0];g[10]=f[1];g[11]=
f[2];u.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,s,3);u.getAttributes().Normal=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,g,3);u.getAttributes().TexCoord0=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,a,2);s=new osg.DrawElements(osg.PrimitiveSet.TRIANGLES,new osg.BufferArray(osg.BufferArray.ELEMENT_ARRAY_BUFFER,[0,1,2,0,2,3],1));u.getPrimitives().push(s);return u};
osg.createTexturedBox=function(a,c,e,f,g,h){osg.log("osg.createTexturedBox is deprecated use instead osg.createTexturedBoxGeometry");return osg.createTexturedBoxGeometry(a,c,e,f,g,h)};osg.createTexturedQuad=function(a,c,e,f,g,h,j,i,k,m,n,p,q){osg.log("osg.createTexturedQuad is deprecated use instead osg.createTexturedQuadGeometry");return osg.createTexturedQuadGeometry(a,c,e,f,g,h,j,i,k,m,n,p,q)};
osg.createAxisGeometry=function(a){a===void 0&&(a=5);if(osg.createAxisGeometry.getShader===void 0)osg.createAxisGeometry.getShader=function(){if(osg.createAxisGeometry.getShader.program===void 0){var a=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,"#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 Vertex;\nattribute vec4 Color;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvarying vec4 FragColor;\n\nvec4 ftransform() {\nreturn ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);\n}\n\nvoid main(void) {\ngl_Position = ftransform();\nFragColor = Color;\n}"),
new osg.Shader(gl.FRAGMENT_SHADER,"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 FragColor;\nvoid main(void) {\ngl_FragColor = FragColor;\n}"));osg.createAxisGeometry.getShader.program=a}return osg.createAxisGeometry.getShader.program};var c=new osg.Geometry,e=[];e.push(0,0,0);e.push(a,0,0);e.push(0,0,0);e.push(0,a,0);e.push(0,0,0);e.push(0,0,a);a=[];a.push(1,0,0,1);a.push(1,0,0,1);a.push(0,1,0,1);a.push(0,1,0,1);a.push(0,0,1,1);a.push(0,0,1,1);c.getAttributes().Vertex=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,
e,3);c.getAttributes().Color=new osg.BufferArray(osg.BufferArray.ARRAY_BUFFER,a,4);e=new osg.DrawArrays(osg.PrimitiveSet.LINES,0,6);c.getPrimitives().push(e);c.getOrCreateStateSet().setAttributeAndMode(osg.createAxisGeometry.getShader());return c};osg.Stack=function(){};osg.Stack.create=function(){var a=[];a.globalDefault=void 0;a.lastApplied=void 0;a.back=function(){return this[this.length-1]};return a};
osg.StateGraph=function(){this.depth=0;this.children={};this.children.keys=[];this.leafs=[];this.parent=this.stateset=void 0};
osg.StateGraph.prototype={clean:function(){this.leafs.splice(0,this.leafs.length);this.parent=this.stateset=void 0;for(var a=this.children.keys,c=0,e=a.length;c<e;c++)this.children[a[c]].clean();this.children={};a.splice(0,a.length);this.children.keys=a},getStateSet:function(){return this.stateset},findOrInsert:function(a){var c;this.children[a.id]?c=this.children[a.id]:(c=new osg.StateGraph,c.parent=this,c.depth=this.depth+1,c.stateset=a,this.children[a.id]=c,this.children.keys.push(a.id));return c},
moveToRootStateGraph:function(a,c){for(;c;)c.stateSet&&a.popStateSet(),c=c._parent},moveStateGraph:function(a,c,e){var f;if(!(e===c||e===void 0))if(c===void 0){f=[];do e.stateset!==void 0&&f.push(e.stateset),e=e.parent;while(e);f.reverse();for(c=0,l=f.length;c<l;++c)a.pushStateSet(f[c])}else if(c.parent===e.parent)c.stateset!==void 0&&a.popStateSet(),e.stateset!==void 0&&a.pushStateSet(e.stateset);else{for(;c.depth>e.depth;)c.stateset!==void 0&&a.popStateSet(),c=c.parent;for(f=[];e.depth>c.depth;)e.stateset!==
void 0&&f.push(e.stateset),e=e.parent;for(;c!==e;)c.stateset!==void 0&&a.popStateSet(),c=c.parent,e.stateset!==void 0&&f.push(e.stateset),e=e.parent;f.reverse();stackLength=f.length;for(c=0;c<stackLength;++c)a.pushStateSet(f[c])}}};
osg.State=function(){this._graphicContext=void 0;this.currentVBO=null;this.vertexAttribList=[];this.programs=osg.Stack.create();this.stateSets=osg.Stack.create();this.uniforms={};this.uniforms.uniformKeys=[];this.textureAttributeMapList=[];this.attributeMap={};this.attributeMap.attributeKeys=[];this.modeMap={};this.shaderGenerator=new osg.ShaderGenerator;this.modelViewMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"ModelViewMatrix");this.projectionMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),
"ProjectionMatrix");this.normalMatrix=osg.Uniform.createMatrix4(osg.Matrix.makeIdentity([]),"NormalMatrix");this.uniformArrayState={};this.uniformArrayState.uniformKeys=[];this.uniformArrayState.Color=osg.Uniform.createInt1(0,"ArrayColorEnabled");this.uniformArrayState.uniformKeys.push("Color");this.vertexAttribMap={};this.vertexAttribMap._disable=[];this.vertexAttribMap._keys=[]};
osg.State.prototype={setGraphicContext:function(a){this._graphicContext=a},getGraphicContext:function(){return this._graphicContext},pushStateSet:function(a){this.stateSets.push(a);a.attributeMap&&this.pushAttributeMap(this.attributeMap,a.attributeMap);if(a.textureAttributeMapList)for(var c=a.textureAttributeMapList,e=0,f=c.length;e<f;e++)if(c[e]!==void 0){if(!this.textureAttributeMapList[e])this.textureAttributeMapList[e]={},this.textureAttributeMapList[e].attributeKeys=[];this.pushAttributeMap(this.textureAttributeMapList[e],
c[e])}a.uniforms&&this.pushUniformsList(this.uniforms,a.uniforms)},applyStateSet:function(a){this.pushStateSet(a);this.apply();this.popStateSet()},popAllStateSets:function(){for(;this.stateSets.length;)this.popStateSet()},popStateSet:function(){var a=this.stateSets.pop();a.program&&this.programs.pop();a.attributeMap&&this.popAttributeMap(this.attributeMap,a.attributeMap);if(a.textureAttributeMapList)for(var c=a.textureAttributeMapList,e=0,f=c.length;e<f;e++)c[e]!==void 0&&this.popAttributeMap(this.textureAttributeMapList[e],
c[e]);a.uniforms&&this.popUniformsList(this.uniforms,a.uniforms)},haveAppliedAttribute:function(a){var c=this.attributeMap[a.getTypeMember()];c.lastApplied=a;c.asChanged=!0},applyAttribute:function(a){var c=a.getTypeMember(),e=this.attributeMap[c];if(e===void 0)e=osg.Stack.create(),this.attributeMap[c]=e,this.attributeMap[c].globalDefault=a.cloneType(),this.attributeMap.attributeKeys.push(c);if(e.lastApplied!==a)a.apply&&a.apply(this),e.lastApplied=a,e.asChanged=!0},applyTextureAttribute:function(a,
c){var e=this.getGraphicContext();e.activeTexture(e.TEXTURE0+a);e=c.getTypeMember();if(!this.textureAttributeMapList[a])this.textureAttributeMapList[a]={},this.textureAttributeMapList[a].attributeKeys=[];var f=this.textureAttributeMapList[a][e];if(f===void 0)f=osg.Stack.create(),this.textureAttributeMapList[a][e]=f,f.globalDefault=c.cloneType(),this.textureAttributeMapList[a].attributeKeys.push(e);if(f.lastApplied!==c)c.apply&&c.apply(this),f.lastApplied=c,f.asChanged=!0},getLastProgramApplied:function(){return this.programs.lastApplied},
pushGeneratedProgram:function(){var a;if(this.attributeMap.Program!==void 0&&this.attributeMap.Program.length!==0&&(a=this.attributeMap.Program.back().object,value=this.attributeMap.Program.back().value,a!==void 0&&value!==osg.StateAttribute.OFF))return this.programs.push(this.getObjectPair(a,value)),a;a={textureAttributeMapList:this.textureAttributeMapList,attributeMap:this.attributeMap};var c=this.stateSets.back().getShaderGenerator();if(c===void 0)c=this.shaderGenerator;a=c.getOrCreateProgram(a);
this.programs.push(this.getObjectPair(a,osg.StateAttribute.ON));return a},popGeneratedProgram:function(){this.programs.pop()},applyWithoutProgram:function(){this.applyAttributeMap(this.attributeMap);this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var a=this._graphicContext;this.applyAttributeMap(this.attributeMap);this.applyTextureAttributeMapList(this.textureAttributeMapList);this.pushGeneratedProgram();var c=this.programs.back().object;if(this.programs.lastApplied!==
c)c.apply(this),this.programs.lastApplied=c;var e,f,g,h;if(c.generated===!0){e=c.uniformsCache;f=c.activeUniforms;c=!1;for(g=0,l=f.uniformKeys.length;g<l;g++){var j=f.uniformKeys[g],a=e[j];a!==void 0?f[j].apply(a):(c=!0,delete f[j])}if(c){e=[];for(h in f)h!=="uniformKeys"&&e.push(h);f.uniformKeys=e}}else{var i=c.program;e=c.uniformsCache;j=this.uniforms;f=[];g=c.trackUniforms;var k;if(c.trackAttributes!==void 0&&g===void 0){var m=c.trackAttributes.attributeKeys;if(m!==void 0)for(g=0,l=m.length;g<
l;g++)if(h=m[g],attributeStack=this.attributeMap[h],attributeStack!==void 0&&(h=attributeStack.globalDefault,h.getOrCreateUniforms!==void 0)){h=h.getOrCreateUniforms();for(k=0,b=h.uniformKeys.length;k<b;k++)f.push(h[h.uniformKeys[k]])}m=c.trackAttributes.textureAttributeKeys;if(m!==void 0)for(g=0,l=m.length;g<l;g++){var n=m[g];if(n!==void 0)for(var p=0,q=n.length;p<q;p++)if(h=n[p],k=this.textureAttributeMapList[g],k!==void 0&&(attributeStack=k[h],attributeStack!==void 0&&(h=attributeStack.globalDefault,
h.getOrCreateUniforms!==void 0))){h=h.getOrCreateUniforms(g);for(k=0,b=h.uniformKeys.length;k<b;k++)f.push(h[h.uniformKeys[k]])}}h={};for(g=0,l=f.length;g<l;g++)m=f[g],n=a.getUniformLocation(i,m.name),n!==void 0&&n!==null&&(h[m.name]=f[g]);c.trackUniforms=h}for(g=0,l=e.uniformKeys.length;g<l;g++)i=e.uniformKeys[g],f=e[i],a=j[i],a===void 0?c.trackUniforms!==void 0&&(a=c.trackUniforms[i],a!==void 0&&a.apply(f)):(a=a.length===0?a.globalDefault:a.back().object,a.apply(f))}},applyUniformList:function(a,
c){for(var e,f,g=this.getLastProgramApplied().uniformsCache,h=0,j=g.uniformKeys.length;h<j;h++){var i=g.uniformKeys[h];e=g[i];f=c[i];if(f===void 0){f=a[i];if(f===void 0)continue;f=f.length===0?f.globalDefault:f.back().object}f.apply(e)}},applyAttributeMap:function(a){for(var c,e=0,f=a.attributeKeys.length;e<f;e++)if(c=a[a.attributeKeys[e]],c!==void 0){var g;g=c.length===0?c.globalDefault:c.back().object;if(c.asChanged){if(c.lastApplied!==g)g.apply&&g.apply(this),c.lastApplied=g;c.asChanged=!1}}},
getObjectPair:function(a,c){return{object:a,value:c}},pushUniformsList:function(a,c){for(var e,f,g=0,h=c.uniformKeys.length;g<h;g++){uniformPair=c[c.uniformKeys[g]];f=uniformPair.getUniform();e=f.name;if(a[e]===void 0)a[e]=osg.Stack.create(),a[e].globalDefault=f,a.uniformKeys.push(e);var j=uniformPair.getValue();e=a[e];e.length===0?e.push(this.getObjectPair(f,j)):e[e.length-1].value&osg.StateAttribute.OVERRIDE&&!(j&osg.StateAttribute.PROTECTED)?e.push(e[e.length-1]):e.push(this.getObjectPair(f,j))}},
popUniformsList:function(a,c){for(var e=0,f=c.uniformKeys.length;e<f;e++)a[c.uniformKeys[e]].pop()},applyTextureAttributeMapList:function(a){for(var c=this._graphicContext,e,f=0,g=a.length;f<g;f++)if(e=a[f],e!==void 0)for(var h=0,j=e.attributeKeys.length;h<j;h++){var i=e[e.attributeKeys[h]];if(i!==void 0){var k;k=i.length===0?i.globalDefault:i.back().object;if(i.asChanged)c.activeTexture(c.TEXTURE0+f),k.apply(this,f),i.lastApplied=k,i.asChanged=!1}}},setGlobalDefaultValue:function(a){var c=a.getTypeMember();
this.attributeMap[c]?this.attributeMap[c].globalDefault=a:(this.attributeMap[c]=osg.Stack.create(),this.attributeMap[c].globalDefault=a,this.attributeMap.attributeKeys.push(c))},pushAttributeMap:function(a,c){for(var e,f=0,g=c.attributeKeys.length;f<g;f++){e=c.attributeKeys[f];var h=c[e],j=h.getAttribute();if(a[e]===void 0)a[e]=osg.Stack.create(),a[e].globalDefault=j.cloneType(),a.attributeKeys.push(e);h=h.getValue();e=a[e];e.length===0?e.push(this.getObjectPair(j,h)):e[e.length-1].value&osg.StateAttribute.OVERRIDE&&
!(h&osg.StateAttribute.PROTECTED)?e.push(e[e.length-1]):e.push(this.getObjectPair(j,h));e.asChanged=!0}},popAttributeMap:function(a,c){for(var e,f=0,g=c.attributeKeys.length;f<g;f++)type=c.attributeKeys[f],e=a[type],e.pop(),e.asChanged=!0},setIndexArray:function(a){var c=this._graphicContext;if(this.currentIndexVBO!==a)a.bind(c),this.currentIndexVBO=a;a.isDirty()&&a.compile(c)},lazyDisablingOfVertexAttributes:function(){for(var a=this.vertexAttribMap._keys,c=0,e=a.length;c<e;c++){var f=a[c];this.vertexAttribMap[f]&&
(this.vertexAttribMap._disable[f]=!0)}},applyDisablingOfVertexAttributes:function(){for(var a=this.vertexAttribMap._keys,c=0,e=a.length;c<e;c++)if(this.vertexAttribMap._disable[a[c]]===!0){var f=a[c];this._graphicContext.disableVertexAttribArray(f);this.vertexAttribMap._disable[f]=!1;this.vertexAttribMap[f]=!1}c=this.programs.lastApplied;if(c!==void 0&&c.generated===!0&&(e=!1,this.previousAppliedProgram!==this.programs.lastApplied?(e=!0,this.previousAppliedProgram=this.programs.lastApplied):(a=c.attributesCache.Color,
this.vertexAttribMap[a]!==this.previousColorAttrib&&(e=!0)),e&&(a=c.attributesCache.Color,a!==void 0)))this.vertexAttribMap[a]?this.uniformArrayState.Color.set([1]):this.uniformArrayState.Color.set([0]),this.previousColorAttrib=this.vertexAttribMap[a],this.uniformArrayState.Color.apply(c.uniformsCache.ArrayColorEnabled)},setVertexAttribArray:function(a,c,e){var f=this.vertexAttribMap;f._disable[a]=!1;var g=this._graphicContext,h=!1;c.isDirty()&&(c.bind(g),c.compile(g),h=!0);f[a]!==c&&(h||c.bind(g),
f[a]||(g.enableVertexAttribArray(a),f[a]===void 0&&f._keys.push(a)),f[a]=c,g.vertexAttribPointer(a,c._itemSize,g.FLOAT,e,0,0))}};osg.StateSet=function(){osg.Object.call(this);this.id=osg.StateSet.instance++;this.attributeMap={};this.attributeMap.attributeKeys=[];this.textureAttributeMapList=[];this._binName=void 0;this._binNumber=0;this._shaderGenerator=void 0};osg.StateSet.instance=0;osg.StateSet.AttributePair=function(a,c){this._object=a;this._value=c};
osg.StateSet.AttributePair.prototype={getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}};
osg.StateSet.prototype=osg.objectInehrit(osg.Object.prototype,{getAttributePair:function(a,c){return new osg.StateSet.AttributePair(a,c)},addUniform:function(a,c){if(c===void 0)c=osg.StateAttribute.ON;if(!this.uniforms)this.uniforms={},this.uniforms.uniformKeys=[];var e=a.name;this.uniforms[e]=this.getAttributePair(a,c);this.uniforms.uniformKeys.indexOf(e)===-1&&this.uniforms.uniformKeys.push(e)},getUniform:function(a){if(this.uniforms&&this.uniforms[a])return this.uniforms[a].getAttribute()},getUniformList:function(){return this.uniforms},
setTextureAttributeAndMode:function(a,c,e){if(e===void 0)e=osg.StateAttribute.ON;this._setTextureAttribute(a,this.getAttributePair(c,e))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(a,c){return this.textureAttributeMapList[a]===void 0||this.textureAttributeMapList[a][c]===void 0?void 0:this.textureAttributeMapList[a][c].getAttribute()},removeTextureAttribute:function(a,c){if(!(this.textureAttributeMapList[a]===void 0||this.textureAttributeMapList[a][c]===
void 0)){delete this.textureAttributeMapList[a][c];var e=this.textureAttributeMapList[a].attributeKeys.indexOf(c);this.textureAttributeMapList[a].attributeKeys.splice(e,1)}},getAttribute:function(a){return this.attributeMap[a]===void 0?void 0:this.attributeMap[a].getAttribute()},setAttributeAndMode:function(a,c){if(c===void 0)c=osg.StateAttribute.ON;this._setAttribute(this.getAttributePair(a,c))},setAttribute:function(a,c){if(c===void 0)c=osg.StateAttribute.ON;this._setAttribute(this.getAttributePair(a,
c))},removeAttribute:function(a){this.attributeMap[a]!==void 0&&(delete this.attributeMap[a],this.attributeMap.attributeKeys.splice(this.attributeMap.attributeKeys.indexOf(a),1))},setRenderingHint:function(a){a==="OPAQUE_BIN"?this.setRenderBinDetails(0,"RenderBin"):a==="TRANSPARENT_BIN"?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},setRenderBinDetails:function(a,c){this._binNumber=a;this._binName=c},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},
getBinName:function(){return this._binName},setBinNumber:function(a){this._binNumber=a},setBinName:function(a){this._binName=a},getAttributeList:function(){for(var a=this.attributeMap,c=a.attributeKeys,e=c.length,f=Array(e),g=0;g<e;g++)f[g]=a[c[g]];return f},setShaderGenerator:function(a){this._shaderGenerator=a},getShaderGenerator:function(){return this._shaderGenerator},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(a,c){if(this.textureAttributeMapList[a]===void 0)this.textureAttributeMapList[a]=
{},this.textureAttributeMapList[a].attributeKeys=[];var e=c.getAttribute().getTypeMember();this.textureAttributeMapList[a][e]=c;this.textureAttributeMapList[a].attributeKeys.indexOf(e)===-1&&this.textureAttributeMapList[a].attributeKeys.push(e)},_setAttribute:function(a){var c=a.getAttribute().getTypeMember();this.attributeMap[c]=a;this.attributeMap.attributeKeys.indexOf(c)===-1&&this.attributeMap.attributeKeys.push(c)}});osg.StateSet.prototype.setTextureAttributeAndModes=osg.StateSet.prototype.setTextureAttributeAndMode;
osg.StateSet.prototype.setAttributeAndModes=osg.StateSet.prototype.setAttributeAndMode;osg.Texture=function(){osg.StateAttribute.call(this);this.setDefaultParameters()};osg.Texture.DEPTH_COMPONENT=6402;osg.Texture.ALPHA=6406;osg.Texture.RGB=6407;osg.Texture.RGBA=6408;osg.Texture.LUMINANCE=6409;osg.Texture.LUMINANCE_ALPHA=6410;osg.Texture.LINEAR=9729;osg.Texture.NEAREST=9728;osg.Texture.NEAREST_MIPMAP_NEAREST=9984;osg.Texture.LINEAR_MIPMAP_NEAREST=9985;osg.Texture.NEAREST_MIPMAP_LINEAR=9986;
osg.Texture.LINEAR_MIPMAP_LINEAR=9987;osg.Texture.CLAMP_TO_EDGE=33071;osg.Texture.REPEAT=10497;osg.Texture.MIRRORED_REPEAT=33648;osg.Texture.TEXTURE_2D=3553;osg.Texture.TEXTURE_CUBE_MAP=34067;osg.Texture.TEXTURE_BINDING_CUBE_MAP=34068;osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_X=34069;osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_X=34070;osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Y=34071;osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;osg.Texture.TEXTURE_CUBE_MAP_POSITIVE_Z=34073;
osg.Texture.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;osg.Texture.MAX_CUBE_MAP_TEXTURE_SIZE=34076;osg.Texture.UNSIGNED_BYTE=5121;osg.Texture.FLOAT=5126;
osg.Texture.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Texture",_className:"Texture",cloneType:function(){var a=new osg.Texture;a.default_type=!0;return a},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(a){if(osg.Texture.uniforms===void 0)osg.Texture.uniforms=[];if(osg.Texture.uniforms[a]===void 0){var c=this.getType()+a,e={};e.texture=osg.Uniform.createInt1(a,c);e.uniformKeys=Object.keys(e);
osg.Texture.uniforms[a]=e}return osg.Texture.uniforms[a]},setDefaultParameters:function(){this._minFilter=this._magFilter=osg.Texture.LINEAR;this._wrapT=this._wrapS=osg.Texture.CLAMP_TO_EDGE;this._textureHeight=this._textureWidth=0;this._unrefImageDataAfterApply=!1;this.setInternalFormat(osg.Texture.RGBA);this._textureTarget=osg.Texture.TEXTURE_2D;this._type=osg.Texture.UNSIGNED_BYTE},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(a,
c){this._textureWidth=a;this._textureHeight=c},init:function(a){if(!this._textureObject)this._textureObject=a.createTexture(),this.dirty()},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(a){if(this._textureObject!==void 0&&this._textureObject!==null)a.deleteTexture(this._textureObject),this._textureObject=null,this._image=void 0},setWrapS:function(a){this._wrapS=typeof a==="string"?osg.Texture[a]:a},setWrapT:function(a){this._wrapT=
typeof a==="string"?osg.Texture[a]:a},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMinFilter:function(a){this._minFilter=typeof a==="string"?osg.Texture[a]:a},setMagFilter:function(a){this._magFilter=typeof a==="string"?osg.Texture[a]:a},setImage:function(a,c){this._image=a;this.setImageFormat(c);this.dirty()},getImage:function(){return this._image},setImageFormat:function(a){a?
(typeof a==="string"&&(a=osg.Texture[a]),this._imageFormat=a):this._imageFormat=osg.Texture.RGBA;this.setInternalFormat(this._imageFormat)},setType:function(a){this._type=typeof a==="string"?osg.Texture[a]:a},setUnrefImageDataAfterApply:function(a){this._unrefImageDataAfterApply=a},setInternalFormat:function(a){this._internalFormat=a},getInternalFormat:function(){return this._internalFormat},setFromCanvas:function(a,c){this.setImage(a,c)},setFromTypedArray:function(a,c){this.setImage(a,c)},isImageReady:function(a){if(a)if(a instanceof
Image){if(a.complete)return a.naturalWidth!==void 0&&a.naturalWidth===0?!1:!0}else if(a instanceof HTMLCanvasElement)return!0;else if(a instanceof Uint8Array)return!0;return!1},applyFilterParameter:function(a,c){a.texParameteri(c,a.TEXTURE_MAG_FILTER,this._magFilter);a.texParameteri(c,a.TEXTURE_MIN_FILTER,this._minFilter);a.texParameteri(c,a.TEXTURE_WRAP_S,this._wrapS);a.texParameteri(c,a.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(a,c){(this._minFilter===a.NEAREST_MIPMAP_NEAREST||this._minFilter===
a.LINEAR_MIPMAP_NEAREST||this._minFilter===a.NEAREST_MIPMAP_LINEAR||this._minFilter===a.LINEAR_MIPMAP_LINEAR)&&a.generateMipmap(c)},apply:function(a){a=a.getGraphicContext();if(this._textureObject!==void 0&&!this.isDirty())a.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)a.bindTexture(this._textureTarget,null);else{var c=this._image;if(c!==void 0)if(this.isImageReady(c)){if(this._textureObject||this.init(a),this.setDirty(!1),a.bindTexture(this._textureTarget,this._textureObject),
c instanceof Image?(this.setTextureSize(c.naturalWidth,c.naturalHeight),a.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):c instanceof HTMLCanvasElement?(this.setTextureSize(c.width,c.height),a.texImage2D(this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,this._image)):c instanceof Uint8Array&&a.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image),
this.applyFilterParameter(a,this._textureTarget),this.generateMipmap(a,this._textureTarget),this._unrefImageDataAfterApply)this._image=void 0}else a.bindTexture(this._textureTarget,null);else this._textureHeight!==0&&this._textureWidth!==0&&(this._textureObject||this.init(a),a.bindTexture(this._textureTarget,this._textureObject),a.texImage2D(this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(a,this._textureTarget),
this.generateMipmap(a,this._textureTarget),this.setDirty(!1))}},setShaderGeneratorFunction:function(a,c){this[c]=a},generateShader:function(a,c){return this[c]?this[c].call(this,a):""}});osg.Texture.prototype[osg.ShaderGeneratorType.VertexInit]=function(a){var c="attribute vec2 TexCoord"+a+";\n";c+="varying vec2 FragTexCoord"+a+";\n";return c};osg.Texture.prototype[osg.ShaderGeneratorType.VertexMain]=function(a){return"FragTexCoord"+a+" = TexCoord"+a+";\n"};
osg.Texture.prototype[osg.ShaderGeneratorType.FragmentInit]=function(a){var c="varying vec2 FragTexCoord"+a+";\n";c+="uniform sampler2D Texture"+a+";\n";c+="vec4 texColor"+a+";\n";return c};osg.Texture.prototype[osg.ShaderGeneratorType.FragmentMain]=function(a){var c="texColor"+a+" = texture2D( Texture"+a+", FragTexCoord"+a+".xy );\n";c+="fragColor = fragColor * texColor"+a+";\n";return c};
osg.Texture.createFromURL=function(a,c){var e=new osg.Texture;osgDB.Promise.when(osgDB.readImage(a)).then(function(a){e.setImage(a,c)});return e};osg.Texture.createFromImg=function(a,c){var e=new osg.Texture;e.setImage(a,c);return e};osg.Texture.createFromImage=osg.Texture.createFromImg;osg.Texture.createFromCanvas=function(a,c){var e=new osg.Texture;e.setFromCanvas(a,c);return e};osg.Texture.create=function(a){osg.log("osg.Texture.create is deprecated, use osg.Texture.createFromURL instead");return osg.Texture.createFromURL(a)};
osg.TextureCubeMap=function(){osg.Texture.call(this);this._images={}};
osg.TextureCubeMap.prototype=osg.objectInehrit(osg.Texture.prototype,{_className:"TextureCubeMap",setDefaultParameters:function(){osg.Texture.prototype.setDefaultParameters.call(this);this._textureTarget=osg.Texture.TEXTURE_CUBE_MAP},cloneType:function(){var a=new osg.TextureCubeMap;a.default_type=!0;return a},setImage:function(a,c,e){typeof a==="string"&&(a=osg.Texture[a]);this._images[a]===void 0&&(this._images[a]={});typeof e==="string"&&(e=osg.Texture[e]);if(e===void 0)e=osg.Texture.RGBA;this._images[a].image=
c;this._images[a].format=e;this._images[a].dirty=!0;this.dirty()},getImage:function(a){return this._images[a].image},applyTexImage2D_load:function(a,c,e,f,g,h,j){if(!j)return!1;if(!osg.Texture.prototype.isImageReady(j))return!1;j instanceof Image?this.setTextureSize(j.naturalWidth,j.naturalHeight):j instanceof HTMLCanvasElement&&this.setTextureSize(j.width,j.height);a.texImage2D(c,0,f,g,h,j);return!0},_applyImageTarget:function(a,c,e){var f=this._images[e];if(!f)return 0;if(!f.dirty)return 1;return this.applyTexImage2D_load(a,
e,0,c,f.format,a.UNSIGNED_BYTE,f.image)?(f.dirty=!1,this._unrefImageDataAfterApply&&delete this._images[e],1):0},apply:function(a){a=a.getGraphicContext();if(this._textureObject!==void 0&&!this.isDirty())a.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)a.bindTexture(this._textureTarget,null);else{this._textureObject||this.init(a);a.bindTexture(this._textureTarget,this._textureObject);var c=this._internalFormat,e=0;e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_POSITIVE_X);
e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_NEGATIVE_X);e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_POSITIVE_Y);e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_NEGATIVE_Y);e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_POSITIVE_Z);e+=this._applyImageTarget(a,c,a.TEXTURE_CUBE_MAP_NEGATIVE_Z);e===6&&(this.setDirty(!1),this.applyFilterParameter(a,this._textureTarget),this.generateMipmap(a,this._textureTarget))}}});
osg.UpdateVisitor=function(){osg.NodeVisitor.call(this);var a=new osg.FrameStamp;this.getFrameStamp=function(){return a};this.setFrameStamp=function(c){a=c}};osg.UpdateVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{apply:function(a){for(var c=a.getUpdateCallbackList(),e=0,f=c.length;e<f;e++)if(!c[e].update(a,this))return;this.traverse(a)}});
osg.Viewport=function(a,c,e,f){osg.StateAttribute.call(this);a===void 0&&(a=0);c===void 0&&(c=0);e===void 0&&(e=800);f===void 0&&(f=600);this._x=a;this._y=c;this._width=e;this._height=f;this._dirty=!0};
osg.Viewport.prototype=osg.objectInehrit(osg.StateAttribute.prototype,{attributeType:"Viewport",cloneType:function(){return new osg.Viewport},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(a){a.getGraphicContext().viewport(this._x,this._y,this._width,this._height);this._dirty=!1},setViewport:function(a,c,e,f){this._x=a;this._y=c;this._width=e;this._height=f;this.dirty()},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},
height:function(){return this._height},computeWindowMatrix:function(){var a=osg.Matrix.makeTranslate(1,1,1),c=osg.Matrix.makeScale(0.5*this._width,0.5*this._height,0.5),e=osg.Matrix.makeTranslate(this._x,this._y,0);return osg.Matrix.preMult(e,osg.Matrix.preMult(c,a))}});osg.CullStack=function(){this._modelviewMatrixStack=[];this._projectionMatrixStack=[];this._viewportStack=[];this._bbCornerNear=this._bbCornerFar=0};
osg.CullStack.prototype={getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return this._modelviewMatrixStack[this._modelviewMatrixStack.length-1]},getViewport:function(){return this._viewportStack.length===0?void 0:this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(){var a=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];return[-a[2],-a[6],-a[10]]},pushViewport:function(a){this._viewportStack.push(a)},
popViewport:function(){this._viewportStack.pop()},pushModelviewMatrix:function(a){this._modelviewMatrixStack.push(a);a=this.getLookVectorLocal();this._bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0);this._bbCornerNear=~this._bbCornerFar&7},popModelviewMatrix:function(){this._modelviewMatrixStack.pop();var a;a=this._modelviewMatrixStack.length!==0?this.getLookVectorLocal():[0,0,-1];this._bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0);this._bbCornerNear=~this._bbCornerFar&7},pushProjectionMatrix:function(a){this._projectionMatrixStack.push(a)},
popProjectionMatrix:function(){this._projectionMatrixStack.pop()}};
osg.CullVisitor=function(){osg.NodeVisitor.call(this);osg.CullSettings.call(this);osg.CullStack.call(this);this._rootRenderStage=this._currentRenderStage=this._currentRenderBin=this._currentStateGraph=this._rootStateGraph=void 0;this._computedNear=Number.POSITIVE_INFINITY;this._computedFar=Number.NEGATIVE_INFINITY;var a=[0,0,-1];this._bbCornerFar=(a[0]>=0?1:0)|(a[1]>=0?2:0)|(a[2]>=0?4:0);this._bbCornerNear=~this._bbCornerFar&7;this._reserveMatrixStack=[[]];this._reserveMatrixStack.current=0;this._reserveLeafStack=
[{}];this._reserveLeafStack.current=0;this._renderBinStack=[]};
osg.CullVisitor.prototype=osg.objectInehrit(osg.CullStack.prototype,osg.objectInehrit(osg.CullSettings.prototype,osg.objectInehrit(osg.NodeVisitor.prototype,{distance:function(a,c){return-(a[0]*c[2]+a[1]*c[6]+a[2]*c[10]+c[14])},handleCullCallbacksAndTraverse:function(a){var c=a.getCullCallback();(!c||c.cull(a,this))&&this.traverse(a)},updateCalculatedNearFar:function(a,c){var e=c.getBoundingBox(),f;f=this.distance(e.corner(this._bbCornerNear),a);e=this.distance(e.corner(this._bbCornerFar),a);if(f>
e){var g=f;f=e;e=g}if(e<0)return!1;if(f<this._computedNear)this._computedNear=f;if(e>this._computedFar)this._computedFar=e;return!0},clampProjectionMatrix:function(a,c,e,f,g){if(e<c-1.0E-6)return osg.log("clampProjectionMatrix not applied, invalid depth range, znear = "+c+"  zfar = "+e),!1;var h,j;e<c+1.0E-6&&(e=(c+e)*0.5,c=e-1.0E-6,e+=1.0E-6);if(Math.abs(osg.Matrix.get(a,0,3))<1.0E-6&&Math.abs(osg.Matrix.get(a,1,3))<1.0E-6&&Math.abs(osg.Matrix.get(a,2,3))<1.0E-6)j=(e-c)*0.02,j<1&&(j=1),h=c-j,j=e+
j,c=h,e=j,osg.Matrix.set(a,2,2,-2/(j-h)),osg.Matrix.set(a,3,2,-(j+h)/(j-h));else{h=c*0.98;j=e*1.02;c=e*f;h<c&&(h=c);var c=h,e=j,f=osg.Matrix.get(a,2,2),i=osg.Matrix.get(a,3,2),k=osg.Matrix.get(a,2,3),m=osg.Matrix.get(a,3,3);h=(-h*f+i)/(-h*k+m);j=(-j*f+i)/(-j*k+m);f=Math.abs(2/(h-j));osg.Matrix.postMult([1,0,0,0,0,1,0,0,0,0,f,0,0,0,-(h+j)/2*f,1],a)}g!==void 0&&(g[0]=c,g[1]=e);return!0},setStateGraph:function(a){this._currentStateGraph=this._rootStateGraph=a},setRenderStage:function(a){this._currentRenderBin=
this._rootRenderStage=a},reset:function(){this._modelviewMatrixStack.splice(0,this._modelviewMatrixStack.length);this._projectionMatrixStack.splice(0,this._projectionMatrixStack.length);this._reserveMatrixStack.current=0;this._reserveLeafStack.current=0;this._computedNear=Number.POSITIVE_INFINITY;this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(a){this._currentRenderBin=a},addPositionedAttribute:function(a){var c=
this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];this._currentRenderBin.getStage().positionedAttribute.push([c,a])},pushStateSet:function(a){this._currentStateGraph=this._currentStateGraph.findOrInsert(a);if(a.getBinName()!==void 0){var c=this._currentRenderBin;this._renderBinStack.push(c);this._currentRenderBin=c.getStage().findOrInsert(a.getBinNumber(),a.getBinName())}},popStateSet:function(){var a=this._currentStateGraph,c=a.getStateSet();this._currentStateGraph=a.parent;if(c.getBinName()!==
void 0)a=this._renderBinStack,this._currentRenderBin=a.length===0?this._currentRenderBin.getStage():a.pop()},popProjectionMatrix:function(){this._computeNearFar===!0&&this._computedFar>=this._computedNear&&this.clampProjectionMatrix(this._projectionMatrixStack[this._projectionMatrixStack.length-1],this._computedNear,this._computedFar,this._nearFarRatio);osg.CullStack.prototype.popProjectionMatrix.call(this)},apply:function(a){this[a.objectType].call(this,a)},_getReservedMatrix:function(){var a=this._reserveMatrixStack[this._reserveMatrixStack.current++];
this._reserveMatrixStack.current===this._reserveMatrixStack.length&&this._reserveMatrixStack.push(osg.Matrix.makeIdentity([]));return a},_getReservedLeaf:function(){var a=this._reserveLeafStack[this._reserveLeafStack.current++];this._reserveLeafStack.current===this._reserveLeafStack.length&&this._reserveLeafStack.push({});return a}})));
osg.CullVisitor.prototype[osg.Camera.prototype.objectType]=function(a){var c=a.getStateSet();c&&this.pushStateSet(c);a.light&&this.addPositionedAttribute(a.light);var e=this._getReservedMatrix(),f=this._getReservedMatrix();a.getReferenceFrame()===osg.Transform.RELATIVE_RF?(osg.Matrix.mult(this._projectionMatrixStack[this._projectionMatrixStack.length-1],a.getProjectionMatrix(),f),osg.Matrix.mult(this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],a.getViewMatrix(),e)):(osg.Matrix.copy(a.getViewMatrix(),
e),osg.Matrix.copy(a.getProjectionMatrix(),f));this.pushProjectionMatrix(f);this.pushModelviewMatrix(e);a.getViewport()&&this.pushViewport(a.getViewport());var e=this._computedNear,f=this._computedFar,g=new osg.CullSettings;g.setCullSettings(this);this._computedNear=Number.POSITIVE_INFINITY;this._computedFar=Number.NEGATIVE_INFINITY;this.setCullSettings(a);if(a.getRenderOrder()===osg.Camera.NESTED_RENDER)this.handleCullCallbacksAndTraverse(a);else{var h=this.getCurrentRenderBin().getStage(),j=new osg.RenderStage;
j.setCamera(a);j.setClearDepth(a.getClearDepth());j.setClearColor(a.getClearColor());j.setClearMask(a.getClearMask());h=a.getViewport()===void 0?h.getViewport():a.getViewport();j.setViewport(h);h=this.getCurrentRenderBin();this.setCurrentRenderBin(j);this.handleCullCallbacksAndTraverse(a);this.setCurrentRenderBin(h);a.getRenderOrder()===osg.Camera.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(j,a.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(j,a.renderOrderNum)}this.popModelviewMatrix();
this.popProjectionMatrix();a.getViewport()&&this.popViewport();this.setCullSettings(g);this._computedNear=e;this._computedFar=f;c&&this.popStateSet()};
osg.CullVisitor.prototype[osg.MatrixTransform.prototype.objectType]=function(a){var c=this._getReservedMatrix();a.getReferenceFrame()===osg.Transform.RELATIVE_RF?osg.Matrix.mult(this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],a.getMatrix(),c):osg.Matrix.copy(a.getMatrix(),c);this.pushModelviewMatrix(c);(c=a.getStateSet())&&this.pushStateSet(c);a.light&&this.addPositionedAttribute(a.light);this.handleCullCallbacksAndTraverse(a);c&&this.popStateSet();this.popModelviewMatrix()};
osg.CullVisitor.prototype[osg.Projection.prototype.objectType]=function(a){lastMatrixStack=this._projectionMatrixStack[this._projectionMatrixStack.length-1];var c=this._getReservedMatrix();osg.Matrix.mult(lastMatrixStack,a.getProjectionMatrix(),c);this.pushProjectionMatrix(c);(c=a.getStateSet())&&this.pushStateSet(c);this.handleCullCallbacksAndTraverse(a);c&&this.popStateSet();this.popProjectionMatrix()};
osg.CullVisitor.prototype[osg.Node.prototype.objectType]=function(a){var c=a.getStateSet();c&&this.pushStateSet(c);a.light&&this.addPositionedAttribute(a.light);this.handleCullCallbacksAndTraverse(a);c&&this.popStateSet()};osg.CullVisitor.prototype[osg.LightSource.prototype.objectType]=function(a){var c=a.getStateSet();c&&this.pushStateSet(c);var e=a.getLight();e&&this.addPositionedAttribute(e);this.handleCullCallbacksAndTraverse(a);c&&this.popStateSet()};
osg.CullVisitor.prototype[osg.Geometry.prototype.objectType]=function(a){var c=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],e=a.getBoundingBox();if(!this._computeNearFar||!e.valid()||this.updateCalculatedNearFar(c,a)){var f=a.getStateSet();f&&this.pushStateSet(f);this.handleCullCallbacksAndTraverse(a);var g=this._currentStateGraph.leafs;g.length===0&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var h=this._getReservedLeaf(),j=0;e.valid()&&(j=this.distance(e.center(),
c));isNaN(j)?osg.warn("warning geometry has a NaN depth, "+c+" center "+e.center()):(h.parent=this._currentStateGraph,h.projection=this._projectionMatrixStack[this._projectionMatrixStack.length-1],h.geometry=a,h.modelview=c,h.depth=j,g.push(h));f&&this.popStateSet()}};
var osgAnimation={EaseOutQuad:function(a){return-(a*(a-2))},EaseInQuad:function(a){return a*a},EaseOutCubic:function(a){a-=1;return a*a*a+1},EaseInCubic:function(a){return a*a*a},EaseOutQuart:function(a){a-=1;return-(a*a*a*a-1)},EaseInQuart:function(a){return a*a*a*a},EaseOutElastic:function(a){return Math.pow(2,-10*a)*Math.sin((a-0.075)*2*Math.PI/0.3)+1}};osgAnimation.easeOutQuad=osgAnimation.EaseOutQuad;osgAnimation.easeInQuad=osgAnimation.EaseInQuad;osgAnimation.easeOutCubic=osgAnimation.EaseOutCubic;
osgAnimation.easeInCubic=osgAnimation.EaseInCubic;osgAnimation.easeOutQuart=osgAnimation.EaseOutQuart;osgAnimation.easeInQuart=osgAnimation.EaseInQuart;osgAnimation.easeOutElastic=osgAnimation.EaseOutElastic;osgAnimation.Animation=function(){osg.Object.call(this);this._channels=[]};
osgAnimation.Animation.prototype=osg.objectInehrit(osg.Object.prototype,{getChannels:function(){return this._channels},getDuration:function(){for(var a=1E5,c=-1E5,e=0,f=this._channels.length;e<f;e++)var g=this._channels[e],a=Math.min(a,g.getStartTime()),c=Math.max(c,g.getEndTime());return c-a}});osgAnimation.BasicAnimationManager=function(){osg.Object.call(this);this._animations={};this._actives={};this._actives._keys=[];this._lastUpdate=void 0;this._targets=[]};
osgAnimation.BasicAnimationManager.prototype=osg.objectInehrit(osg.Object.prototype,{_updateAnimation:function(a,c,e){var f=a.duration,g=a.weight,h=a.anim,j=a.start,i=a.loop;if(i>0&&c-j>=i*f)return!0;c=(c-j)%f;(a=a.callback)&&a(c);h=h.getChannels();a=0;for(f=h.length;a<f;a++)h[a].update(c,g,e);return!1},update:function(a,c){this.updateManager(c.getFrameStamp().getSimulationTime());return!0},updateManager:function(a){for(var c=this._targets,e=0,f=c.length;e<f;e++)c[e].reset();if(this._actives._keys.length>
0)for(c=this._actives._keys.length-1;c>=0;){for(var e=this._actives[c],f=this._actives[c]._keys,g=[],h=0,j=f.length;h<j;h++){var i=e[f[h]];if(i.start===void 0)i.start=a;this._updateAnimation(i,a,c)&&g.push(h)}for(g=g.length-1;g>=0;g--)h=f[g],f.splice(g,1),delete e[h];c--}},stopAll:function(){},isPlaying:function(a){if(this._actives._keys.length>0)for(var c=this._actives._keys.length-1;c>=0;){if(this._actives[c][a])return!0;c--}return!1},stopAnimation:function(a){if(this._actives._keys.length>0)for(var c=
this._actives._keys.length-1,e=function(a){return a!=="_keys"};c>=0;){if(this._actives[c][a]){delete this._actives[c][a];this._actives[c]._keys=Object.keys(this._actives[c]).filter(e);break}c--}},playAnimationObject:function(a){if(a.name!==void 0){var c=this._animations[a.name];if(c===void 0)osg.log("no animation "+a.name+" found");else if(!this.isPlaying(a.name)){if(a.priority===void 0)a.priority=0;if(a.weight===void 0)a.weight=1;if(a.timeFactor===void 0)a.timeFactor=1;if(a.loop===void 0)a.loop=
0;if(this._actives[a.priority]===void 0)this._actives[a.priority]={},this._actives[a.priority]._keys=[],this._actives._keys.push(a.priority);a.start=void 0;a.duration=c.getDuration();a.anim=c;this._actives[a.priority][a.name]=a;this._actives[a.priority]._keys.push(a.name)}}},playAnimation:function(a,c,e){var f=a;if(typeof a==="object")if(a.getName===void 0)return this.playAnimationObject(a);else f=a.getName();return this.playAnimationObject({name:f,priority:c,weight:e})},registerAnimation:function(a){this._animations[a.getName()]=
a;this.buildTargetList()},getAnimationMap:function(){return this._animations},buildTargetList:function(){this._targets.length=0;for(var a=Object.keys(this._animations),c=0,e=a.length;c<e;c++)for(var f=this._animations[a[c]].getChannels(),g=0,h=f.length;g<h;g++)this._targets.push(f[g].getTarget())}});osgAnimation.Channel=function(a,c){osg.Object.call(this);this._sampler=a;this._target=c;this._targetName=void 0;this._data={value:void 0,key:0}};
osgAnimation.Channel.prototype=osg.objectInehrit(osg.Object.prototype,{getKeyframes:function(){return this._sampler.getKeyframes()},setKeyframes:function(a){this._sampler.setKeyframes(a)},getStartTime:function(){return this._sampler.getStartTime()},getEndTime:function(){return this._sampler.getEndTime()},getSampler:function(){return this._sampler},setSampler:function(a){this._sampler=a},getTarget:function(){return this._target},setTarget:function(a){this._target=a},setTargetName:function(a){this._targetName=
a},getTargetName:function(){return this._targetName},update:function(a,c,e){c=c||1;e=e||0;if(!(c<1.0E-4)){var f=this._data;this._sampler.getValueAt(a,f);this._target.update.call(this._target,c,f.value,e)}},reset:function(){this._target.reset()}});
osgAnimation.Vec3LerpChannel=function(a,c){var e=new osgAnimation.Sampler;a||(a=[]);c||(c=new osgAnimation.Vec3Target);osgAnimation.Channel.call(this,e,c);e.setInterpolator(osgAnimation.Vec3LerpInterpolator);this.setKeyframes(a);this._data.value=osg.Vec3.copy(c.getValue(),[])};osgAnimation.Vec3LerpChannel.prototype=osgAnimation.Channel.prototype;
osgAnimation.FloatLerpChannel=function(a,c){var e=new osgAnimation.Sampler;a||(a=[]);c||(c=new osgAnimation.FloatTarget);osgAnimation.Channel.call(this,e,c);e.setInterpolator(osgAnimation.FloatLerpInterpolator);this.setKeyframes(a);this._data.value=c.getValue()};osgAnimation.FloatLerpChannel.prototype=osgAnimation.Channel.prototype;
osgAnimation.QuatLerpChannel=function(a,c){var e=new osgAnimation.Sampler;a||(a=[]);c||(c=new osgAnimation.QuatTarget);osgAnimation.Channel.call(this,e,c);e.setInterpolator(osgAnimation.QuatLerpInterpolator);this.setKeyframes(a);this._data.value=osg.Quat.copy(c.getValue(),[])};osgAnimation.QuatLerpChannel.prototype=osgAnimation.Channel.prototype;osgAnimation.QuatSlerpChannel=function(a,c){osgAnimation.QuatLerpChannel.call(this,a,c);this.getSampler().setInterpolator(osgAnimation.QuatSlerpInterpolator)};
osgAnimation.QuatSlerpChannel.prototype=osgAnimation.Channel.prototype;osgAnimation.Vec3LerpInterpolator=function(a,c,e){var f,g;f=a[a.length-1];if(c>=f.t)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2];else if(f=a[0],g=f.t,c<=g)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2];else{for(f=e.key;a[f+1].t<c;)f++;g=f+1;var h=a[f].t,j=a[f][0],i=a[f][1],k=a[f][2],m=a[g][1],n=a[g][2],c=(c-h)/(a[g].t-h);e.value[0]=j+(a[g][0]-j)*c;e.value[1]=i+(m-i)*c;e.value[2]=k+(n-k)*c;e.key=f}};
osgAnimation.QuatLerpInterpolator=function(a,c,e){var f,g;f=a[a.length-1];if(c>=f.t)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2],e.value[3]=f[3];else if(f=a[0],g=f.t,c<=g)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2],e.value[3]=f[3];else{for(f=e.key;a[f+1].t<c;)f++;g=f+1;var h=a[f].t,j=a[f][0],i=a[f][1],k=a[f][2],m=a[f][3],n=a[g][1],p=a[g][2],q=a[g][3],c=(c-h)/(a[g].t-h);e.value[0]=j+(a[g][0]-j)*c;e.value[1]=i+(n-i)*c;e.value[2]=k+(p-k)*c;e.value[3]=m+(q-m)*c;e.key=f}};
osgAnimation.QuatSlerpInterpolator=function(a,c,e){var f,g;f=a[a.length-1];if(c>=f.t)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2],e.value[3]=f[3];else if(f=a[0],g=f.t,c<=g)e.key=0,e.value[0]=f[0],e.value[1]=f[1],e.value[2]=f[2],e.value[3]=f[3];else{for(f=e.key;a[f+1].t<c;)f++;g=f+1;var h=a[f].t;osg.Quat.slerp((c-h)/(a[g].t-h),a[f],a[g],e.value);e.key=f}};
osgAnimation.FloatLerpInterpolator=function(a,c,e){var f,g;f=a[a.length-1];if(c>=f.t)e.key=0,e.value=f[0];else if(f=a[0],g=f.t,c<=g)e.key=0,e.value=f[0];else{for(f=e.key;a[f+1].t<c;)f++;g=f+1;var h=a[f].t,j=a[f][0];e.value=j+(a[g][0]-j)*((c-h)/(a[g].t-h));e.key=f}};osgAnimation.FloatStepInterpolator=function(a,c,e){var f,g;f=a[a.length-1];if(c>=f.t)e.key=0,e.value=f[0];else if(f=a[0],g=f.t,c<=g)e.key=0,e.value=f[0];else{for(f=e.key;a[f+1].t<c;)f++;e.value=a[f][0];e.key=f}};
osgAnimation.createVec3Keyframe=function(a,c){var e=c.slice(0);e.t=a;return e};osgAnimation.createQuatKeyframe=function(a,c){var e=c.slice(0);e.t=a;return e};osgAnimation.createFloatKeyframe=function(a,c){var e=[c];e.t=a;return e};osgAnimation.LinkVisitor=function(){osg.NodeVisitor.call(this);this._animations=void 0;this._nbLinkTarget=0};
osgAnimation.LinkVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setAnimationMap:function(a){this._animations=a;this._animationKeys=Object.keys(a)},apply:function(a){for(var c=a.getUpdateCallbackList(),e=0,f=c.length;e<f;e++){var g=c[e];g instanceof osgAnimation.AnimationUpdateCallback&&this.link(g)}this.traverse(a)},link:function(a){for(var c=0,e=this._animations,f=this._animationKeys,g=0,h=f.length;g<h;g++)c+=a.linkAnimation(e[f[g]]);this._nbLinkedTarget+=c;osg.log("linked "+c+' for "'+
a.getName()+'"')}});osgAnimation.Sampler=function(a,c){a||(a=[]);this._keys=a;this._interpolator=c};
osgAnimation.Sampler.prototype={getKeyframes:function(){return this._keys},setKeyframes:function(a){this._keys=a},setInterpolator:function(a){this._interpolator=a},getInterpolator:function(){return this._interpolator},getStartTime:function(){return this._keys.length===0?void 0:this._keys[0].t},getEndTime:function(){return this._keys.length===0?void 0:this._keys[this._keys.length-1].t},getValueAt:function(a,c){if(this._keys[c.key].t>a)c.key=0;this._interpolator(this._keys,a,c)}};
osgAnimation.StackedTranslate=function(a,c){osg.Object.call(this);c||(c=[0,0,0]);this._translate=c;this._target=void 0;this.setName(a)};
osgAnimation.StackedTranslate.prototype=osg.objectInehrit(osg.Object.prototype,{setTranslate:function(a){osg.Vec3.copy(a,this._translate)},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){this._target!==void 0&&osg.Vec3.copy(this._target.getValue(),this._translate)},getOrCreateTarget:function(){if(!this._target)this._target=new osgAnimation.Vec3Target(this._translate);return this._target},applyToMatrix:function(a){osg.Matrix.preMultTranslate(a,this._translate)}});
osgAnimation.StackedRotateAxis=function(a,c,e){osg.Object.call(this);c||(c=[1,0,0]);e||(e=0);this._axis=c;this._angle=e;this._target=void 0;this.setName(a);this._matrixTmp=[];osg.Matrix.makeIdentity(this._matrixTmp);this._quatTmp=[];osg.Quat.makeIdentity(this._quatTmp)};
osgAnimation.StackedRotateAxis.prototype=osg.objectInehrit(osg.Object.prototype,{setAxis:function(a){osg.Vec3.copy(a,this._axis)},setAngle:function(a){this._angle=a},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){if(this._target!==void 0)this._angle=this._target.getValue()},getOrCreateTarget:function(){if(!this._target)this._target=new osgAnimation.FloatTarget(this._angle);return this._target},applyToMatrix:function(a){var c=this._axis,e=this._quatTmp,
f=this._matrixTmp;osg.Quat.makeRotate(this._angle,c[0],c[1],c[2],e);osg.Matrix.setRotateFromQuat(f,e);osg.Matrix.preMult(a,f)}});osgAnimation.StackedQuaternion=function(a,c){osg.Object.call(this);c||(c=[0,0,0,1]);this._quaternion=c;this._target=void 0;this._matrixTmp=[];osg.Matrix.makeIdentity(this._matrixTmp);this.setName(a)};
osgAnimation.StackedQuaternion.prototype=osg.objectInehrit(osg.Object.prototype,{setQuaternion:function(a){osg.Quat.copy(a,this._quaternion)},setTarget:function(a){this._target=a},getTarget:function(){return this._target},update:function(){this._target!==void 0&&osg.Quat.copy(this._target.getValue(),this._quaternion)},getOrCreateTarget:function(){if(!this._target)this._target=new osgAnimation.QuatTarget(this._quaternion);return this._target},applyToMatrix:function(a){var c=this._matrixTmp;osg.Matrix.setRotateFromQuat(c,
this._quaternion);osg.Matrix.preMult(a,c)}});osgAnimation.Target=function(){this._lastPriority=this._count=this._priorityWeight=this._weight=0;this._target=void 0};osgAnimation.Target.prototype={reset:function(){this._priorityWeight=this._weight=0},getValue:function(){return this._target}};osgAnimation.Vec3Target=function(){osgAnimation.Target.call(this);this._target=[0,0,0]};
osgAnimation.Vec3Target.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,c,e){if(this._weight||this._priorityWeight){if(this._lastPriority!=e)this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=e;this._priorityWeight+=a;t=(1-this._weight)*a/this._priorityWeight;osg.Vec3.lerp(t,this._target,c,this._target)}else this._priorityWeight=a,this._lastPriority=e,osg.Vec3.copy(c,this._target)}});
osgAnimation.FloatTarget=function(a){osgAnimation.Target.call(this);this._target=[a]};
osgAnimation.FloatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,c,e){if(this._weight||this._priorityWeight){if(this._lastPriority!=e)this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=e;this._priorityWeight+=a;t=(1-this._weight)*a/this._priorityWeight;this._target+=(c-this._target)*t}else this._priorityWeight=a,this._lastPriority=e,this._target=c}});
osgAnimation.QuatTarget=function(){osgAnimation.Target.call(this);this._target=[];osg.Quat.makeIdentity(this._target)};
osgAnimation.QuatTarget.prototype=osg.objectInehrit(osgAnimation.Target.prototype,{update:function(a,c,e){if(this._weight||this._priorityWeight){if(this._lastPriority!=e)this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=e;this._priorityWeight+=a;t=(1-this._weight)*a/this._priorityWeight;osg.Quat.lerp(t,this._target,c,this._target);osg.Quat.normalize(this._target,this._target)}else this._priorityWeight=a,this._lastPriority=e,osg.Quat.copy(c,this._target)}});
osgAnimation.AnimationUpdateCallback=function(){};osgAnimation.AnimationUpdateCallback.prototype=osg.objectInehrit(osg.Object.prototype,{linkChannel:function(){},linkAnimation:function(a){var c=this.getName();if(c.length===0)return osg.log("no name on an update callback, discard"),0;for(var e=0,a=a.getChannels(),f=0,g=a.length;f<g;f++){var h=a[f];h.getTargetName()===c&&(this.linkChannel(h),e++)}return e}});
osgAnimation.UpdateMatrixTransform=function(){osgAnimation.AnimationUpdateCallback.call(this);this._stackedTransforms=[]};
osgAnimation.UpdateMatrixTransform.prototype=osg.objectInehrit(osgAnimation.AnimationUpdateCallback.prototype,{getStackedTransforms:function(){return this._stackedTransforms},update:function(a){a=a.getMatrix();osg.Matrix.makeIdentity(a);for(var c=this._stackedTransforms,e=0,f=c.length;e<f;e++){var g=c[e];g.update();g.applyToMatrix(a)}return!0},linkChannel:function(a){for(var c=a.getName(),e=this._stackedTransforms,f=0,g=e.length;f<g;f++){var h=e[f],j=h.getName();if(c.length>0&&j===c&&(h=h.getOrCreateTarget()))return a.setTarget(h),
!0}osg.log("can't link channel "+c+", does not contain a symbolic name that can be linked to TransformElements")}});var osgUtil={TriangleHit:function(a,c,e,f,g,h,j,i){this.index=a;this.normal=c;this.r1=e;this.v1=f;this.r2=g;this.v2=h;this.r3=j;this.v3=i},TriangleIntersect:function(){this.hits=[];this.nodePath=[]}};
osgUtil.TriangleIntersect.prototype={setNodePath:function(a){this.nodePath=a},set:function(a,c){this.start=a;this.end=c;this.dir=osg.Vec3.sub(c,a,[]);this.length=osg.Vec3.length(this.dir);osg.Vec3.mult(this.dir,1/this.length,this.dir)},applyDrawElementsTriangles:function(a,c,e){for(var f=[],g=[],h=[],j,i=0;i<a;i+=3)j=e[i]*3,f[0]=c[j],f[1]=c[j+1],f[2]=c[j+2],j=e[i+1]*3,g[0]=c[j],g[1]=c[j+1],g[2]=c[j+2],j=e[i+2]*3,h[0]=c[j],h[1]=c[j+1],h[2]=c[j+2],this.intersect(f,g,h)},applyDrawElementsTriangleStrip:function(a,
c,e){for(var f=[],g=[],h=[],j,i,k,m=2,n=0;m<a;m++,n++)m%2?(j=e[n]*3,i=e[n+2]*3,k=e[n+1]*3):(j=e[n]*3,i=e[n+1]*3,k=e[n+2]*3),f[0]=c[j],f[1]=c[j+1],f[2]=c[j+2],g[0]=c[i],g[1]=c[i+1],g[2]=c[i+2],h[0]=c[k],h[1]=c[k+1],h[2]=c[k+2],this.intersect(f,g,h)},applyDrawElementsTriangleFan:function(a,c,e){var f=[],g=[],h=[],j=e[0]*3;f[0]=c[j];f[1]=c[j+1];f[2]=c[j+2];for(var i,k=2,m=1;k<a;k++,m++)j=e[m]*3,i=e[m+1]*3,g[0]=c[j],g[1]=c[j+1],g[2]=c[j+2],h[0]=c[i],h[1]=c[i+1],h[2]=c[i+2],this.intersect(f,g,h)},applyDrawArraysTriangles:function(a,
c,e){for(var f=[],g=[],h=[];a<c;a+=9)f[0]=e[a],f[1]=e[a+1],f[2]=e[a+2],g[0]=e[a+3],g[1]=e[a+4],g[2]=e[a+5],h[0]=e[a+6],h[1]=e[a+7],h[2]=e[a+8],this.intersect(f,g,h)},applyDrawArraysTriangleStrip:function(a,c,e){for(var f=[],g=[],h=[],j,i,k=2,m=a;k<c;k++,m++)k%2?(a=m*3,j=(m+2)*3,i=(m+1)*3):(a=m*3,j=(m+1)*3,i=(m+2)*3),f[0]=e[a],f[1]=e[a+1],f[2]=e[a+2],g[0]=e[j],g[1]=e[j+1],g[2]=e[j+2],h[0]=e[i],h[1]=e[i+1],h[2]=e[i+2],this.intersect(f,g,h)},applyDrawArraysTriangleFan:function(a,c,e){var f=[],g=[],h=
[],j=a*3;f[0]=e[j];f[1]=e[j+1];f[2]=e[j+2];for(var i,j=2,k=a+1;j<c;j++,k++)a=k*3,i=(k+1)*3,g[0]=e[a],g[1]=e[a+1],g[2]=e[a+2],h[0]=e[i],h[1]=e[i+1],h[2]=e[i+2],this.intersect(f,g,h)},apply:function(a){if(a.getAttributes().Vertex)for(var c,e=a.getAttributes().Vertex.getElements(),f=this.index=0,g=a.primitives.length;f<g;f++)if(c=a.primitives[f],c.getIndices!==void 0){var h=c.indices.getElements();switch(c.getMode()){case gl.TRIANGLES:this.applyDrawElementsTriangles(c.getCount(),e,h);break;case gl.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(c.getCount(),
e,h);break;case gl.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(c.getCount(),e,h)}}else switch(c.getMode()){case gl.TRIANGLES:this.applyDrawArraysTriangles(c.getFirst(),c.getCount(),e);break;case gl.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(c.getFirst(),c.getCount(),e);break;case gl.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(c.getFirst(),c.getCount(),e)}},intersect:function(a,c,e){this.index++;if(!(a==c||c==e||a==e)){var f=osg.Vec3.sub(c,a,[]),g=osg.Vec3.cross(f,this.dir,[]),h=osg.Vec3.dot(osg.Vec3.sub(this.start,
a,[]),g),j=osg.Vec3.dot(osg.Vec3.sub(e,a,[]),g);if(j>=0){if(h<0)return;if(h>j)return}else{if(h>0)return;if(h<j)return}var g=osg.Vec3.sub(e,c,[]),i=osg.Vec3.cross(g,this.dir,[]),k=osg.Vec3.dot(osg.Vec3.sub(this.start,c,[]),i),i=osg.Vec3.dot(osg.Vec3.sub(a,c,[]),i);if(i>=0){if(k<0)return;if(k>i)return}else{if(k>0)return;if(k<i)return}var m=osg.Vec3.sub(a,e,[]),n=osg.Vec3.cross(m,this.dir,[]),m=osg.Vec3.dot(osg.Vec3.sub(this.start,e,[]),n),n=osg.Vec3.dot(osg.Vec3.sub(c,e,[]),n);if(n>=0){if(m<0)return;
if(m>n)return}else{if(m>0)return;if(m<n)return}if(h===0)h=0;else if(j!==0)h/=j;else return;if(k===0)k=0;else if(i!==0)k/=i;else return;if(m===0)j=0;else if(n!==0)j=m/n;else return;i=k+j+h;if(i!==1){if(i===0)return;i=1/i;k*=i;j*=i;h*=i}i=[];osg.Vec3.add(osg.Vec3.mult(a,k,[]),osg.Vec3.mult(c,j,[]),i);osg.Vec3.add(osg.Vec3.mult(e,h,[]),i,i);if(osg.Vec3.valid(i)){if(i=osg.Vec3.dot(osg.Vec3.sub(i,this.start,[]),this.dir),!(i<0)&&!(i>this.length))f=osg.Vec3.cross(f,g,[]),osg.Vec3.normalize(f,f),g=i/this.length,
i=[],i[0]=this.start[0]*(1-g)+this.end[0]*g,i[1]=this.start[1]*(1-g)+this.end[1]*g,i[2]=this.start[2]*(1-g)+this.end[2]*g,this.hits.push({ratio:g,nodepath:this.nodePath.slice(0),triangleHit:new osgUtil.TriangleHit(this.index-1,f,k,a,j,c,h,e),point:i}),this.hit=!0}else osg.log("Warning: TriangleIntersect "),osg.log("hit:     "+i),osg.log("         "+a),osg.log("         "+c),osg.log("         "+e)}}};
osgUtil.IntersectVisitor=function(){osg.NodeVisitor.call(this);this.matrix=[];this.hits=[];this.nodePath=[]};
osgUtil.IntersectVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{addLineSegment:function(a,c){this.start=a;this.end=c},intersectSegmentWithSphere:function(a,c,e){var f=osg.Vec3.sub(a,e.center),e=osg.Vec3.length2(f)-e.radius*e.radius;if(e<0)return!0;c=osg.Vec3.sub(c,a);a=osg.Vec3.length2(c);f=osg.Vec3.dot(f,c)*2;e=f*f-4*a*e;if(e<0)return!1;e=Math.sqrt(e);c=0.5*a;a=(-f-e)*c;f=(-f+e)*c;return a<=0&&f<=0?!1:a>=1&&f>=1?!1:!0},pushModelMatrix:function(a){if(this.matrix.length>0){var c=osg.Matrix.copy(this.matrix[this.matrix.length-
1]);osg.Matrix.preMult(c,a);this.matrix.push(c)}else this.matrix.push(a)},getModelMatrix:function(){return this.matrix.length===0?osg.Matrix.makeIdentity([]):this.matrix[this.matrix.length-1]},popModelMatrix:function(){return this.matrix.pop()},getWindowMatrix:function(){return this.windowMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getViewMatrix:function(){return this.viewMatrix},intersectSegmentWithGeometry:function(a,c,e){ti=new osgUtil.TriangleIntersect;ti.setNodePath(this.nodePath);
ti.set(a,c);ti.apply(e);a=ti.hits.length;if(a>0){for(c=0;c<a;c++)this.hits.push(ti.hits[c]);return!0}return!1},pushCamera:function(a){this.projectionMatrix=a.getProjectionMatrix();this.viewMatrix=a.getViewMatrix();a=a.getViewport();if(a!==void 0)this.windowMatrix=a.computeWindowMatrix()},applyCamera:function(a){this.pushCamera(a);this.traverse(a)},applyNode:function(a){a.getMatrix&&this.pushModelMatrix(a.getMatrix());if(a.primitives){var c=[];osg.Matrix.copy(this.getWindowMatrix(),c);osg.Matrix.preMult(c,
this.getProjectionMatrix());osg.Matrix.preMult(c,this.getViewMatrix());osg.Matrix.preMult(c,this.getModelMatrix());var e=[];if(!osg.Matrix.inverse(c,e))return;c=osg.Matrix.transformVec3(e,this.start,Array(3));e=osg.Matrix.transformVec3(e,this.end,Array(3));this.intersectSegmentWithGeometry(c,e,a)}a.traverse&&this.traverse(a);a.getMatrix&&this.popModelMatrix()},apply:function(a){this.enterNode(a)!==!1&&(a.getViewMatrix?this.applyCamera(a):this.applyNode(a))},enterNode:function(a){return a.boundingSphere!==
void 0&&!this.intersectSegmentWithSphere?!1:!0}});
(function(){var a=function(a){if(a!==void 0)a.object!==void 0&&a.field!==void 0&&this.createInternalSlider(param),this._uniform=this.createInternalSliderUniform(param)};a.prototype={setTargetHTML:function(a){this.parent=a},addToDom:function(a){var e=document.createElement("div");e.innerHTML=a;this.parent.appendChild(e)},getValue:function(a){return window.localStorage?window.localStorage.getItem(a):null},setValue:function(a,e){window.localStorage&&window.localStorage.setItem(a,e)},createHTMLSlider:function(a,
e,f,g){var h=a.max,j=a.step,i=g+"(this.value)",a='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>'.replace(/MIN/g,a.min),a=a.replace(/MAX/g,h+j),a=a.replace("STEP",j),a=a.replace("VALUE",e),a=a.replace(/NAME/g,f),a=a.replace(/UPDATE/g,g);return a=a.replace("ONCHANGE",i)},createUniformFunction:function(a,e,f,g,h){self=this;return function(){return function(j){g.get()[f]=j;g.dirty();osg.debug(e+" value "+
j);document.getElementById(h).innerHTML=Number(j).toFixed(4);self.setValue(h,j);if(a.onchange!==void 0)a.onchange(g.get())}}()},createFunction:function(a,e,f,g,h,j){self=this;return function(){return function(i){typeof i==="string"&&(i=parseFloat(i));typeof g[h]==="number"?g[h]=i:g[h][f]=i;osg.debug(e+" value "+i);document.getElementById(j).innerHTML=Number(i).toFixed(4);self.setValue(j,i);if(a.onchange!==void 0)a.onchange(g[h])}}()},getCallbackName:function(a,e){return"change_"+e+"_"+a},copyDefaultValue:function(a){var e=
a.value;return e=Array.isArray(a.value)?a.value.slice():[e]},createInternalSliderUniform:function(a){var e=a.value,f=a.uniform;if(f===void 0)f=a.type,f=f.charAt(0).toUpperCase()+f.slice(1),f=osg.Uniform["create"+f](e,a.name);for(var g=this.getCallbackName(a.name,a.id),h=e.length,j=0;j<h;j++){var i=j.toString(),k=a.name+i,i=g+i,m=e[j],n=this.getValue(i);n!==null?m=n:a.uniform&&a.uniform.get()[j]!==void 0&&(m=a.uniform.get()[j]);this.addToDom(this.createHTMLSlider(a,m,k,i));window[i]=this.createUniformFunction(a,
k,j,f,i);osg.log(k+" "+m);window[i](m)}return this.uniform=f},createInternalSlider:function(a){for(var e=a.value,f=a.name,g=e.length,h=this.getCallbackName(f,a.id),j=a.object,i=a.field,k=0;k<g;k++){var m=k.toString(),n=f+m,m=h+m,p=e[k],p=this.getValue(m),p=p!==null?p:typeof j[i]==="number"?j[i]:j[i][k];this.addToDom(this.createHTMLSlider(a,p,n,m));window[m]=this.createFunction(a,n,k,j,i,m);osg.log(n+" "+p);window[m](p)}},createSlider:function(a){a.html!==void 0&&this.setTargetHTML(a.html);if(a.id===
void 0)a.id=a.name;a.value=this.copyDefaultValue(a);if(a.type!==void 0)return this.createInternalSliderUniform(a);else{if(a.object===void 0)a.object={data:a.value},a.field="data";return this.createInternalSlider(a)}}};osgUtil.ParameterVisitor=function(){osg.NodeVisitor.call(this);this.arraySlider=new a;this.setTargetHTML(document.body)};osgUtil.ParameterVisitor.createSlider=function(c){(new a).createSlider(c)};osgUtil.ParameterVisitor.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setTargetHTML:function(a){this.targetHTML=
a;this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(a,e){var f=a.match(RegExp("(uniform).*?((?:[a-z][a-z]+)).*?((?:[a-z][a-z]+)).*?..*?..*?(.)(.).*?(\\{.*?\\})",["g"]));if(f!==null)for(var g=RegExp("(uniform).*?((?:[a-z][a-z]+)).*?((?:[a-z][a-z]+)).*?..*?..*?(.)(.).*?(\\{.*?\\})",["i"]),h=0,j=f.length;h<j;h++){var i=f[h].match(g);if(i!==null){var k=i[2],m=i[3],i=JSON.parse(i[6]);i.type=k;i.name=m;var n=i.value;i.value=function(){return n};e[m]=i}}return e},getUniformFromStateSet:function(a,
e){var f=a.getUniformList();if(f)for(var g=Object.keys(e),h=0,j=g.length;h<j;h++){var i=g[h];if(f[i]!==void 0&&e[i].uniform===void 0)e[i].uniform=f[i].object}},findExistingUniform:function(a,e){var f=function(){osg.NodeVisitor.call(this,osg.NodeVisitor.TRAVERSE_PARENTS)};f.prototype=osg.objectInehrit(osg.NodeVisitor.prototype,{setUniformMap:function(a){this.uniformMap=a},apply:function(a){var c=a.getStateSet();c&&osgUtil.ParameterVisitor.prototype.getUniformFromStateSet(c,this.uniformMap);this.traverse(a)}});
f=new f;f.setUniformMap(e);a.accept(f)},applyProgram:function(a,e){var f=e.getAttribute("Program"),g=f.getName();f.getVertexShader().getText();var h={};this.getUniformList(f.getVertexShader().getText(),h);this.getUniformList(f.getFragmentShader().getText(),h);f=Object.keys(h);g===void 0&&(g=function(a){var c=0,e=0;if(a.length==0)return c;for(i=0;i<a.length;i++)e=a.charCodeAt(i),c=(c<<5)-c+e,c&=c;c<0&&(c=-c);return c}(f.join("")).toString());this.findExistingUniform(a,h);for(var j=!1,i=0;i<f.length;i++){j=
h[f[i]];j.id=g;var k=this.arraySlider.createSlider(j);j.uniform===void 0&&k&&e.addUniform(k);j=!0}if(j)g=document.createElement("div"),g.innerHTML="<p> </p>",this.targetHTML.appendChild(g);osg.log(h)},applyStateSet:function(a,e){e.getAttribute("Program")!==void 0&&this.applyProgram(a,e)},apply:function(a){var e=this.targetHTML;e===void 0||e===null||(e=a.getStateSet(),e!==void 0&&this.applyStateSet(a,e),this.traverse(a))}})})();
(function(){osgUtil.Composer=function(){osg.Node.call(this);this._stack=[];this._dirty=this._renderToScreen=!1;var a=function(){};a.prototype={update:function(a){a.isDirty()&&a.build()}};this.setUpdateCallback(new a);this.getOrCreateStateSet().setAttributeAndModes(new osg.Depth("DISABLE"))};osgUtil.Composer.prototype=osg.objectInehrit(osg.Node.prototype,{dirty:function(){for(var a=0,c=this._stack.length;a<c;a++)this._stack[a].filter.dirty()},addPass:function(a,c,e){c instanceof osg.Texture?this._stack.push({filter:a,
texture:c}):c!==void 0&&e!==void 0?this._stack.push({filter:a,width:Math.floor(c),height:Math.floor(e)}):this._stack.push({filter:a})},renderToScreen:function(a,c){this._renderToScreen=!0;this._renderToScreenWidth=a;this._renderToScreenHeight=c},isDirty:function(){for(var a=0,c=this._stack.length;a<c;a++)if(this._stack[a].filter.isDirty())return!0;return!1},build:function(){var a=this;this.removeChildren();var c,e=this;this._stack.forEach(function(f,g,h){f.filter.isDirty()&&f.filter.build();var j=
f.filter.getStateSet(),i;f.texture!==void 0?(j=f.texture.getWidth(),i=f.texture.getHeight()):f.width!==void 0&&f.height!==void 0?(j=f.width,i=f.height):(i=j.getTextureAttribute(0,"Texture"),i===void 0&&osg.warn("osgComposer can't find any information to setup texture output size"),j=i.getWidth(),i=i.getHeight());var k=new osg.Camera;k.setClearMask(0);var m,n;g===h.length-1&&e._renderToScreen===!0?(j=e._renderToScreenWidth,i=e._renderToScreenHeight):(k.setRenderOrder(osg.Camera.PRE_RENDER,0),m=f.texture,
m===void 0&&(m=new osg.Texture,m.setTextureSize(j,i)),k.attachTexture(osg.FrameBufferObject.COLOR_ATTACHMENT0,m,0));n=new osg.Viewport(0,0,j,i);var p=osg.Matrix.makeOrtho(-j/2,j/2,-i/2,i/2,-5,5,[]);k.setReferenceFrame(osg.Transform.ABSOLUTE_RF);k.setViewport(n);k.setProjectionMatrix(p);k.setStateSet(f.filter.getStateSet());n=osg.createTexturedQuadGeometry(-j/2,-i/2,0,j,0,0,0,i,0);f.filter.buildGeometry!==void 0&&(n=f.filter.buildGeometry(n));n.setName("composer layer");c=m;g+1<h.length&&h[g+1].filter.getStateSet().setTextureAttributeAndModes(0,
c);k.addChild(n);f.filter.getStateSet().addUniform(osg.Uniform.createFloat2([j,i],"RenderSize"));k.setName("Composer Pass"+g);a.addChild(k)});this._resultTexture=c}});osgUtil.Composer.Filter=function(){this._stateSet=new osg.StateSet;this._dirty=!0};osgUtil.Composer.Filter.prototype={getStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}};osgUtil.Composer.Filter.defaultVertexShader="#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 Vertex;\nattribute vec2 TexCoord0;\nvarying vec2 FragTexCoord0;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\nvoid main(void) {\n  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);\n  FragTexCoord0 = TexCoord0;\n}\n";
osgUtil.Composer.Filter.defaultFragmentShaderHeader="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 FragTexCoord0;\nuniform vec2 RenderSize;\nuniform sampler2D Texture0;\n";osgUtil.Composer.Filter.shaderUtils="vec4 packFloatTo4x8(in float v) {\nvec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\nreturn enc;\n}\n \nvec4 pack2FloatTo4x8(in vec2 val) {\n const vec2 bitSh = vec2(256.0, 1.0);\n const vec2 bitMsk = vec2(0.0, 1.0/256.0);\n vec2 res1 = fract(val.x * bitSh);\n res1 -= res1.xx * bitMsk;\n vec2 res2 = fract(val.y * bitSh);\n res2 -= res2.xx * bitMsk;\n return vec4(res1.x,res1.y,res2.x,res2.y);\n}\n \nfloat unpack4x8ToFloat( vec4 rgba ) {\n return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n \nvec2 unpack4x8To2Float(in vec4 val) {\n const vec2 unshift = vec2(1.0/256.0, 1.0);\n return vec2(dot(val.xy, unshift), dot(val.zw, unshift));\n}\nvec2 encodeNormal (vec3 n)\n{\n    float f = sqrt(8.0*n.z+8.0);\n    return n.xy / f + 0.5;\n}\nvec3 decodeNormal (vec2 enc)\n{\n    vec2 fenc = enc*4.0-2.0;\n    float f = dot(fenc,fenc);\n    float g = sqrt(1.0-f/4.0);\n    vec3 n;\n    n.xy = fenc*g;\n    n.z = 1.0-f/2.0;\n    return n;\n}\n";
osgUtil.Composer.Filter.Helper={getOrCreatePascalCoefficients:function(){var a=osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients.cache;if(a!==void 0)return a;a=function(a){for(var e=[[1]],f=0;f<a-1;f++){Math.pow(2,f);var g=e[f],h=g.length,j=h+1,i=Array(h);i[0]=1;for(var j=i[j-1]=1,k=0;k<h-1;k++){var m=g[k]+g[k+1];i[j++]=m}e.push(i)}(function(){for(var a=0;a<e.length;a++)for(var c=e[a],f=Math.pow(2,a),g=0;g<c.length;g++)c[g]/=f})();return e}(20);return osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients.cache=
a}};osgUtil.Composer.Filter.Custom=function(a,c){osgUtil.Composer.Filter.call(this);this._fragmentShader=a;this._uniforms=c;this._vertexShader=osgUtil.Composer.Filter.defaultVertexShader};osgUtil.Composer.Filter.Custom.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){var a=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,this._vertexShader),new osg.Shader(gl.FRAGMENT_SHADER,this._fragmentShader));if(this._uniforms){var c=0,e=this._fragmentShader.match(/uniform\s+\w+\s+\w+/g);
if(e!==null)for(var f=0,g=e.length;f<g;f++){var h=e[f].match(/uniform\s+(\w+)\s+(\w+)/),j=h[1],h=h[2];this._uniforms[h]!==void 0&&(uniform_value=this._uniforms[h],j.search("sampler")!==-1?(this._stateSet.setTextureAttributeAndModes(c,uniform_value),j=osg.Uniform.createInt1(c,h),c++):j=osg.Uniform.isUniform(uniform_value)?uniform_value:osg.Uniform[j](this._uniforms[h],h),this._stateSet.addUniform(j))}}this._stateSet.setAttributeAndModes(a);this._dirty=!1}});osgUtil.Composer.Filter.AverageHBlur=function(a){osgUtil.Composer.Filter.call(this);
a===void 0?this.setBlurSize(5):this.setBlurSize(a);this._pixelSize=1};osgUtil.Composer.Filter.AverageHBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setBlurSize:function(a){a%2!==1&&(a+=1);this._nbSamples=a;this.dirty()},setPixelSize:function(a){this._pixelSize=a;this.dirty()},getUVOffset:function(a){return"vec2(float("+a+"), 0.0)/RenderSize[0];"},getShaderBlurKernel:function(){var a=this._nbSamples,c=[];c.push(" pixel = texture2D(Texture0, FragTexCoord0 );");c.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }");
c.push(" vec2 offset;");for(var e=1;e<Math.ceil(a/2);e++)c.push(" offset = "+this.getUVOffset(e*this._pixelSize)),c.push(" pixel += texture2D(Texture0, FragTexCoord0 + offset);"),c.push(" pixel += texture2D(Texture0, FragTexCoord0 - offset);");c.push(" pixel /= float("+a+");");return c},build:function(){var a=osgUtil.Composer.Filter.defaultVertexShader,c=[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform float width;\nvoid main (void)\n{\n  vec4 pixel;",this.getShaderBlurKernel().join("\n"),
"  gl_FragColor = vec4(pixel);\n}\n"].join("\n"),a=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,a),new osg.Shader(gl.FRAGMENT_SHADER,c));this._stateSet.getUniform("Texture0")===void 0&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0"));this._stateSet.setAttributeAndModes(a);this._dirty=!1}});osgUtil.Composer.Filter.AverageVBlur=function(a){osgUtil.Composer.Filter.AverageHBlur.call(this,a)};osgUtil.Composer.Filter.AverageVBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.AverageHBlur.prototype,
{getUVOffset:function(a){return"vec2(0.0, float("+a+"))/RenderSize[1];"}});osgUtil.Composer.Filter.BilateralHBlur=function(a){osgUtil.Composer.Filter.call(this);a===void 0&&(a={});var c=a.nbSamples,e=a.depthTexture,a=a.radius;c===void 0?this.setBlurSize(5):this.setBlurSize(c);this._depthTexture=e;this._radius=osg.Uniform.createFloat(1,"radius");this._pixelSize=osg.Uniform.createFloat(1,"pixelSize");this.setRadius(a)};osgUtil.Composer.Filter.BilateralHBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,
{setBlurSize:function(a){a%2!==1&&(a+=1);osg.log("BlurSize "+a);this._nbSamples=a;this.dirty()},setPixelSize:function(a){this._pixelSize.get()[0]=a;this._pixelSize.dirty()},setRadius:function(a){this._radius.get()[0]=a;this._radius.dirty()},getUVOffset:function(a){return"vec2(0.0, float("+a+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var a=this._nbSamples,c=[];c.push(" pixel = texture2D(Texture0, FragTexCoord0 );");c.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }");
c.push(" vec2 offset, tmpUV;");c.push(" depth = getDepthValue(texture2D(Texture1, FragTexCoord0 ));");for(var e=1;e<Math.ceil(a/2);e++)c.push(" offset = "+this.getUVOffset(e)),c.push(" tmpUV =  FragTexCoord0 + offset;"),c.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),c.push(" if ( abs(depth-tmpDepth) < radius) {"),c.push("   pixel += texture2D(Texture0, tmpUV);"),c.push("   nbHits += 1.0;"),c.push(" }"),c.push(" tmpUV =  FragTexCoord0 - offset;"),c.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),
c.push(" if ( abs(depth-tmpDepth) < radius) {"),c.push("   pixel += texture2D(Texture0, tmpUV);"),c.push("   nbHits += 1.0;"),c.push(" }");c.push(" pixel /= nbHits;");return c},build:function(){var a=osgUtil.Composer.Filter.defaultVertexShader,c=[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;\nuniform float width;\nuniform mat4 projection;\nuniform float radius;\nuniform float pixelSize;\nfloat znear,zfar,zrange;\n",osgUtil.Composer.Filter.shaderUtils,"\nfloat getDepthValue(vec4 v) {\n  float depth = unpack4x8ToFloat(v);\n  depth = depth*zrange+znear;\n  return -depth;\n}\nvoid main (void)\n{\n  vec4 pixel;\n  float depth, tmpDepth;\n  znear = projection[3][2] / (projection[2][2]-1.0);\n  zfar = projection[3][2] / (projection[2][2]+1.0);\n  zrange = zfar-znear;\n  float nbHits = 1.0;",
this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);\n}\n"].join("\n"),a=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,a),new osg.Shader(gl.FRAGMENT_SHADER,c));this._stateSet.getUniform("Texture0")===void 0&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0"));this._stateSet.getUniform("Texture1")===void 0&&this._stateSet.addUniform(osg.Uniform.createInt1(1,"Texture1"));this._stateSet.addUniform(this._radius);this._stateSet.addUniform(this._pixelSize);this._stateSet.setTextureAttributeAndModes(1,
this._depthTexture);this._stateSet.setAttributeAndModes(a);this._dirty=!1}});osgUtil.Composer.Filter.BilateralVBlur=function(a){osgUtil.Composer.Filter.BilateralHBlur.call(this,a)};osgUtil.Composer.Filter.BilateralVBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.BilateralHBlur.prototype,{getUVOffset:function(a){return"vec2(float("+a+")*pixelSize,0.0)/RenderSize[0];"}});osgUtil.Composer.Filter.InputTexture=function(a){osgUtil.Composer.Filter.call(this);this._stateSet.setTextureAttributeAndModes(0,
a)};osgUtil.Composer.Filter.InputTexture.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){this._dirty=!1}});osgUtil.Composer.Filter.HBlur=function(a){osgUtil.Composer.Filter.call(this);a===void 0?this.setBlurSize(5):this.setBlurSize(a)};osgUtil.Composer.Filter.HBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{setBlurSize:function(a){a%2!==1&&(a+=1);this._nbSamples=a;this.dirty()},getUVOffset:function(a){return"vec2(float("+a+"), 0.0)/RenderSize[0];"},
build:function(){var a=this._nbSamples,c=osgUtil.Composer.Filter.defaultVertexShader,e=osgUtil.Composer.Filter.Helper.getOrCreatePascalCoefficients()[a-1],f=Math.floor(a/2),g=[];g.push(" pixel += float("+e[f]+")*texture2D(Texture0, FragTexCoord0 ).rgb;");var h=1;g.push(" vec2 offset;");for(f+=1;f<a;f++){var j=e[f];g.push(" offset = "+this.getUVOffset(f));h++;g.push(" pixel += "+j+"*texture2D(Texture0, FragTexCoord0 + offset).rgb;");g.push(" pixel += "+j+"*texture2D(Texture0, FragTexCoord0 - offset).rgb;")}a=
[osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform float width;\nvoid main (void)\n{\n  vec3 pixel;",g.join("\n"),"  gl_FragColor = vec4(pixel,1.0);\n}\n"].join("\n");c=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,c),new osg.Shader(gl.FRAGMENT_SHADER,a));this._stateSet.getUniform("Texture0")===void 0&&this._stateSet.addUniform(osg.Uniform.createInt1(0,"Texture0"));this._stateSet.setAttributeAndModes(c);this._dirty=!1}});osgUtil.Composer.Filter.VBlur=function(){osgUtil.Composer.Filter.HBlur.call(this)};
osgUtil.Composer.Filter.VBlur.prototype=osg.objectInehrit(osgUtil.Composer.Filter.HBlur.prototype,{getUVOffset:function(a){return"vec2(0.0, float("+a+"))/RenderSize[1];"}});osgUtil.Composer.Filter.BlendMix=function(){osgUtil.Composer.Filter.call(this);var a,c,e,f=0,g=1,h=this._stateSet;arguments.length===3?(a=arguments[0],c=arguments[1],e=arguments[2],f=1,g=2,h.setTextureAttributeAndModes(f,a)):arguments.length===2?(c=arguments[0],e=arguments[1]):arguments.length===1&&(c=arguments[0],e=0.5);h.setTextureAttributeAndModes(g,
c);h.addUniform(osg.Uniform.createInt1(f,"Texture0"));h.addUniform(osg.Uniform.createInt1(g,"Texture1"));this._mixValueUniform=osg.Uniform.createFloat1(e,"MixValue");h.addUniform(mixValueUniform)};osgUtil.Composer.Filter.BlendMix=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var a=this._stateSet,c=osgUtil.Composer.Filter.defaultVertexShader,e=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;\nuniform float MixValue;\nvoid main (void)\n{\n  gl_FragColor = mix(texture2D(Texture0,FragTexCoord0), texture2D(Texture1,FragTexCoord0),MixValue);\n}\n"].join("\n"),
c=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,c),new osg.Shader(gl.FRAGMENT_SHADER,e));a.setAttributeAndModes(c);this._dirty=!1}});osgUtil.Composer.Filter.BlendMultiply=function(){osgUtil.Composer.Filter.call(this);var a=this._stateSet,c,e,f=0;arguments.length===2?(c=arguments[0],e=arguments[1],f=2,a.setTextureAttributeAndModes(f,c)):arguments.length===1&&(e=arguments[0]);a.setTextureAttributeAndModes(1,e);a.addUniform(osg.Uniform.createInt1(f,"Texture0"));a.addUniform(osg.Uniform.createInt1(1,
"Texture1"))};osgUtil.Composer.Filter.BlendMultiply.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{build:function(){var a=osgUtil.Composer.Filter.defaultVertexShader,c=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;\nuniform float MixValue;\nvoid main (void)\n{\n  gl_FragColor = texture2D(Texture0,FragTexCoord0)*texture2D(Texture1,FragTexCoord0);\n}\n"].join("\n");this._stateSet.setAttributeAndModes(new osg.Program(new osg.Shader(gl.VERTEX_SHADER,
a),new osg.Shader(gl.FRAGMENT_SHADER,c)));this._dirty=!1}});osgUtil.Composer.Filter.SSAO=function(a){osgUtil.Composer.Filter.call(this);var c=this._stateSet,e=16,f=0.05;if(a!==void 0){if(a.nbSamples!==void 0)e=a.nbSamples;if(a.radius!==void 0)f=a.radius}var g=a.normal,a=a.position;this._radius=f;this._nbSamples=e;this._noiseTextureSize=16;this._sceneRadius=2;c.addUniform(osg.Uniform.createFloat1(1,"Power"));c.addUniform(osg.Uniform.createFloat1(f,"Radius"));c.addUniform(osg.Uniform.createInt1(0,"Texture0"));
c.addUniform(osg.Uniform.createInt1(1,"Texture1"));c.addUniform(osg.Uniform.createInt1(2,"Texture2"));c.addUniform(osg.Uniform.createFloat1(0.1,"AngleLimit"));e=g.getWidth();f=g.getHeight();this._size=[e,f];c.setTextureAttributeAndModes(0,g);c.setTextureAttributeAndModes(1,a);this.initNoise()};osgUtil.Composer.Filter.SSAO.prototype=osg.objectInehrit(osgUtil.Composer.Filter.prototype,{initNoise:function(){var a=this._noiseTextureSize,c=Array(a*a*3);(function(c){for(var e=0;e<a*a;e++){var h,j;h=2*(Math.random()-
0.5);j=2*(Math.random()-0.5);h=osg.Vec3.normalize([h,j,0],[]);c[e*3+0]=255*(h[0]*0.5+0.5);c[e*3+1]=255*(h[1]*0.5+0.5);c[e*3+2]=255*(h[2]*0.5+0.5)}})(c);var e=new osg.Texture;e.setWrapS("REPEAT");e.setWrapT("REPEAT");e.setMinFilter("NEAREST");e.setMagFilter("NEAREST");e.setTextureSize(a,a);e.setImage(new Uint8Array(c),"RGB");this._noiseTexture=e},setSceneRadius:function(a){this._sceneRadius=a;this.dirty()},setAngleLimit:function(a){var c=this._stateSet.getUniform("AngleLimit");c.get()[0]=a;c.dirty()},
setNbSamples:function(a){if(a!==this._nbSamples)this._nbSamples=Math.floor(a),this.dirty()},setRadius:function(a){var c=this._stateSet.getUniform("Radius");c.get()[0]=a;c.dirty()},setPower:function(a){var c=this._stateSet.getUniform("Power");c.get()[0]=a;c.dirty()},build:function(){var a=this._stateSet,c=this._nbSamples,e=Array(c*4);(function(a){for(var e=0;e<c;e++){var f,g,m;f=2*(Math.random()-0.5);g=2*(Math.random()-0.5);m=Math.random();f=osg.Vec3.normalize([f,g,m],[]);g=Math.max(e/c,0.1);g=0.1+
0.9*g*g;a[e*3+0]=f[0];a[e*3+1]=f[1];a[e*3+2]=f[2];a[e*3+3]=g}})(e);a.setTextureAttributeAndModes(2,this._noiseTexture);var f=a.getUniform("noiseSampling");f===void 0?(f=osg.Uniform.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),a.addUniform(f)):(f.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),f.dirty());for(var f=[],g=0;g<c;g++)f.push("kernel["+g+"] = vec4("+e[g*3]+","+e[g*3+1]+", "+e[g*3+2]+", "+e[g*3+3]+
");");f=f.join("\n");e=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;\nuniform sampler2D Texture2;\nuniform mat4 projection;\nuniform vec2 noiseSampling;\nuniform float Power;\nuniform float Radius;\nuniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;\nvec3 normal;\nvec4 position;","vec4 kernel["+c+"];","mat3 computeBasis()\n{\n  vec2 uvrand = FragTexCoord0*noiseSampling;\n  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);\n  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));\n  vec3 bitangent = cross(normal, tangent);\n  mat3 tbn = mat3(tangent, bitangent, normal);\n  return tbn;\n}\nvoid main (void)\n{",
f,"  position = texture2D(Texture1, FragTexCoord0);\n  vec4 p = texture2D(Texture0, FragTexCoord0);\n  depth = p.w;\n  normal = vec3(p);\n  if ( position.w == 0.0) {\n     gl_FragColor = vec4(1.0,1.0,1.0,0.0);\n     return;\n  }\n\n mat3 tbn = computeBasis();\n float occlusion = 0.0;\n for (int i = 0; i < NB_SAMPLES; i++) {\n    vec3 vecKernel = vec3(kernel[i]);\n    vecKernel[2] = max(AngleLimit,vecKernel[2]);\n    vec3 sample = tbn * vecKernel;\n    vec3 dir = sample;\n    float w = dot(dir, normal);\n    float dist = 1.0-kernel[i].w;\n    w *= dist*dist*Power;\n    sample = dir * float(Radius) + position.xyz;\n    vec4 offset = projection * vec4(sample,1.0);\n    offset.xy /= offset.w;\n    offset.xy = offset.xy * 0.5 + 0.5;\n    float sample_depth = texture2D(Texture1, offset.xy).z;\n    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;\n    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;\n }\n occlusion = 1.0 - (occlusion / float(NB_SAMPLES));\n gl_FragColor = vec4(vec3(occlusion),1.0);\n}\n"].join("\n");
e=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,"\n#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 Vertex;\nattribute vec2 TexCoord0;\nvarying vec2 FragTexCoord0;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\nvoid main(void) {\n  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);\n  FragTexCoord0 = TexCoord0;\n}\n"),new osg.Shader(gl.FRAGMENT_SHADER,e));a.setAttributeAndModes(e);this._dirty=!1}});osgUtil.Composer.Filter.SSAO8=function(a){osgUtil.Composer.Filter.SSAO.call(this,
a)};osgUtil.Composer.Filter.SSAO8.prototype=osg.objectInehrit(osgUtil.Composer.Filter.SSAO.prototype,{buildGeometry:function(a){a.getAttributes().TexCoord1=this._texCoord1;return a},build:function(){var a=this._stateSet,c=this._nbSamples,e=Array(c*4);(function(a){for(var e=0;e<c;e++){var f,g,m;f=2*(Math.random()-0.5);g=2*(Math.random()-0.5);m=Math.random();f=osg.Vec3.normalize([f,g,m],[]);g=Math.max(e/c,0.1);g=0.1+0.9*g*g;a[e*3+0]=f[0];a[e*3+1]=f[1];a[e*3+2]=f[2];a[e*3+3]=g}})(e);a.setTextureAttributeAndModes(2,
this._noiseTexture);var f=a.getUniform("noiseSampling");f===void 0?(f=osg.Uniform.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),a.addUniform(f)):(f.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),f.dirty());for(var f=[],g=0;g<c;g++)f.push("kernel["+g+"] = vec4("+e[g*3]+","+e[g*3+1]+", "+e[g*3+2]+", "+e[g*3+3]+");");f=f.join("\n");e=["",osgUtil.Composer.Filter.defaultFragmentShaderHeader,"varying vec3 FragTexCoord1;\nuniform sampler2D Texture1;\nuniform sampler2D Texture2;\nuniform mat4 projection;\nuniform vec2 noiseSampling;\nuniform float Power;\nuniform float Radius;\nuniform float AngleLimit;",
"#define NB_SAMPLES "+this._nbSamples,"float depth;\nfloat znear, zfar, zrange;\nvec3 normal;\nvec3 position;","vec4 kernel["+c+"];",osgUtil.Composer.Filter.shaderUtils,"mat3 computeBasis()\n{\n  vec2 uvrand = FragTexCoord0*noiseSampling;\n  //uvrand = rand(gl_FragCoord.xy);\n  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);\n  //vec3 rvec = normalize(vec3(uvrand,0.0));\n  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));\n  vec3 bitangent = cross(normal, tangent);\n  mat3 tbn = mat3(tangent, bitangent, normal);\n  return tbn;\n}\nfloat getDepthValue(vec4 v) {\n  float depth = unpack4x8ToFloat(v);\n  depth = depth*zrange+znear;\n  //depth = depth*zrange;\n  return -depth;\n}\nvoid main (void)\n{",
f,"  vec4 p = texture2D(Texture0, FragTexCoord0);\n  if (dot(p,p) < 0.001) { \n     gl_FragColor = vec4(1.0,1.0,1.0,0.0);\n     return;\n  }\n  znear = projection[3][2] / (projection[2][2]-1.0);\n  zfar = projection[3][2] / (projection[2][2]+1.0);\n  zrange = zfar-znear;\n  depth = getDepthValue(texture2D(Texture1, FragTexCoord0));\n  if ( -depth < znear) {\n     gl_FragColor = vec4(1.0,1.0,1.0,0.0);\n     return;\n  }\n  normal = decodeNormal(unpack4x8To2Float(p));\n  position = -FragTexCoord1*depth;\n  position.z = -position.z;\n\n mat3 tbn = computeBasis();\n float occlusion = 0.0;\n for (int i = 0; i < NB_SAMPLES; i++) {\n    vec3 vecKernel = vec3(kernel[i]);\n    vecKernel[2] = max(AngleLimit,vecKernel[2]);\n    vec3 sample = tbn * vec3(vecKernel);\n    vec3 dir = sample;\n    float w = dot(dir, normal);\n    float dist = 1.0-kernel[i].w;\n    w *= dist*dist*Power;\n    sample = dir * float(Radius) + position.xyz;\n    vec4 offset = projection * vec4(sample,1.0);\n    offset.xy /= offset.w;\n    offset.xy = offset.xy * 0.5 + 0.5;\n    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));\n    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;\n    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;\n }\n occlusion = 1.0 - (occlusion / float(NB_SAMPLES));\n gl_FragColor = vec4(vec3(occlusion),1.0);\n}\n"].join("\n");
e=new osg.Program(new osg.Shader(gl.VERTEX_SHADER,"\n#ifdef GL_ES\nprecision highp float;\n#endif\nattribute vec3 Vertex;\nattribute vec2 TexCoord0;\nattribute vec3 TexCoord1;\nvarying vec2 FragTexCoord0;\nvarying vec3 FragTexCoord1;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\nvoid main(void) {\n  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);\n  FragTexCoord0 = TexCoord0;\n  FragTexCoord1 = TexCoord1;\n}\n"),new osg.Shader(gl.FRAGMENT_SHADER,e));a.setAttributeAndModes(e);
this._dirty=!1}})})();var osgDB={ObjectWrapper:{}};osgDB.ObjectWrapper.serializers={};osgDB.readImage=function(a){if(osgDB._input===void 0)osgDB._input=new osgDB.Input;return osgDB._input.readImageURL(a)};
osgDB.parseSceneGraph=function(a,c){if(a.Version!==void 0&&a.Version>0){var e=function(a){for(var a=Object.keys(a),c=0,e=a.length;c<e;c++)if(a[c]!=="Generator"&&a[c]!=="Version")return a[c]}(a);if(e){var f={};f[e]=a[e];e=new osgDB.Input(f);c!==void 0&&c.progressXHRCallback!==void 0&&e.setProgressXHRCallback(c.progressXHRCallback);return e.readObject()}else osg.log("can't parse scenegraph "+a)}else return osgDB.parseSceneGraph_deprecated(a)};
osgDB.parseSceneGraph_deprecated=function(a){var c=function(a,c){var e=c[a];e===void 0&&(e=c[a.toLowerCase()]);return e},e=function(a,e){var f=c("Name",e);f&&a.setName!==void 0&&a.setName(f)},f=function(a,e){var f=e.MagFilter||e.mag_filter||void 0;f&&a.setMagFilter(f);(f=e.MinFilter||e.min_filter||void 0)&&a.setMinFilter(f);(f=e.WrapT||e.wrap_t||void 0)&&a.setWrapT(f);(f=e.WrapS||e.wrap_s||void 0)&&a.setWrapS(f);f=c("File",e);osgDB.Promise.when(osgDB.readImage(f)).then(function(c){a.setImage(c)})},
g=function(a,g){e(a,g);var h=c("Textures",g)||c("TextureAttributeList",g)||void 0;if(h)for(var i=0,j=h.length;i<j;i++)if(c("File",h[i])){var k=new osg.Texture;f(k,h[i]);a.setTextureAttributeAndMode(i,k);a.addUniform(osg.Uniform.createInt1(i,"Texture"+i))}else osg.log("no texture on unit "+i+" skip it");if(h=c("BlendFunc",g))i=new osg.BlendFunc,e(i,h),i.setSourceRGB(h.SourceRGB),i.setSourceAlpha(h.SourceAlpha),i.setDestinationRGB(h.DestinationRGB),i.setDestinationAlpha(h.DestinationAlpha),a.setAttributeAndMode(i);
if(h=c("Material",g))i=new osg.Material,e(i,h),i.setAmbient(c("Ambient",h)),i.setDiffuse(c("Diffuse",h)),i.setEmission(c("Emission",h)),i.setSpecular(c("Specular",h)),i.setShininess(c("Shininess",h)),a.setAttributeAndMode(i)},h,j=a.children,i=a.primitives||a.Primitives||void 0,k=a.attributes||a.Attributes||void 0;if(i||k){h=new osg.Geometry;e(h,a);osg.extend(h,a);a=h;a.primitives=i;a.attributes=k;h=0;for(var m=i.length;h<m;h++){var n=i[h].mode;if(i[h].indices){var p=i[h].indices,p=new osg.BufferArray(osg.BufferArray[p.type],
p.elements,p.itemSize),n=n?osg.PrimitiveSet[n]:gl.TRIANGLES;i[h]=new osg.DrawElements(n,p)}else n=gl[n],i[h]=new osg.DrawArrays(n,i[h].first,i[h].count)}for(var q in k)k.hasOwnProperty(q)&&(i=k[q],k[q]=new osg.BufferArray(gl[i.type],i.elements,i.itemSize))}if(k=c("StateSet",a))q=new osg.StateSet,g(q,k),a.stateset=q;if(g=a.matrix||a.Matrix||void 0)h=new osg.MatrixTransform,e(h,a),osg.extend(h,a),h.setMatrix(osg.Matrix.copy(g)),a=h;if(g=a.projection||a.Projection||void 0)h=new osg.Projection,e(h,a),
osg.extend(h,a),h.setProjectionMatrix(osg.Matrix.copy(g)),a=h;a.objectType===void 0&&(h=new osg.Node,e(h,a),osg.extend(h,a),a=h);if(j){a.children=[];g=0;for(k=j.length;g<k;g++)a.addChild(osgDB.parseSceneGraph_deprecated(j[g]))}return a};osgDB.Input=function(a,c){this._json=a;var e=c;e===void 0&&(e={});this._identifierMap=e;this._objectRegistry={};this._progressXHRCallback=void 0};
osgDB.Input.prototype={setProgressXHRCallback:function(a){this._progressXHRCallback=a},registerObject:function(a,c){this._objectRegistry[a]=c},getJSON:function(){return this._json},setJSON:function(a){this._json=a;return this},getObjectWrapper:function(a){if(this._objectRegistry[a]!==void 0)return new this._objectRegistry[a];for(var c=window,a=a.split("."),e=0,f=a.length;e<f;e++)if(c=c[a[e]],c===void 0)return;return new c},readImageURL:function(a){var c=osgDB.Promise.defer(),e=new Image;e.onerror=
function(){osg.warn("warning use white texture as fallback instead of "+a);e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII="};e.onload=function(){c.resolve(e)};e.src=a;return c.promise},readImage:function(){var a=this.getJSON(),c=a.UniqueID;if(c!==void 0&&(img=this._identifierMap[c],img!==void 0))return img;var e=this,f=osgDB.Promise.defer();osgDB.Promise.when(this.readImageURL(a.Url)).then(function(a){c!==void 0&&(e._identifierMap[c]=
a);f.resolve(a)});return f.promise},readBinaryArrayURL:function(a){if(this._identifierMap[a]!==void 0)return this._identifierMap[a];var c=osgDB.Promise.defer(),e=new XMLHttpRequest;e.open("GET",a,!0);e.responseType="arraybuffer";this._progressXHRCallback&&e.addEventListener("progress",this._progressXHRCallback,!1);e.addEventListener("error",function(){c.reject()},!1);var f=this;e.addEventListener("load",function(){var g=e.response;g?(f._identifierMap[a]=g,c.resolve(g)):c.reject()},!1);e.send(null);
return this._identifierMap[a]=c.promise},readBufferArray:function(){var a=this.getJSON(),c=a.UniqueID,e;if(c!==void 0&&(e=this._identifierMap[c],e!==void 0))return e;if((a.Elements!==void 0||a.Array!==void 0)&&a.ItemSize!==void 0&&a.Type){var f,g;if(a.Elements!==void 0)f=new osg.BufferArray(osg.BufferArray[a.Type],a.Elements,a.ItemSize);else if(a.Array!==void 0){var h=new osg.BufferArray(osg.BufferArray[a.Type]);h.setItemSize(a.ItemSize);var j,i;a.Array.Float32Array!==void 0?(j=a.Array.Float32Array,
i="Float32Array"):a.Array.Uint16Array!==void 0?(j=a.Array.Uint16Array,i="Uint16Array"):(osg.warn("Typed Array "+Object.keys(o.Array)[0]),i="Float32Array");if(j!==void 0)if(j.File!==void 0)a=j.File,g=osgDB.Promise.defer(),osgDB.Promise.when(this.readBinaryArrayURL(a)).then(function(a){var c,e;(function(){var a=new Uint8Array([18,52]);e=(new Uint16Array(a.buffer))[0].toString(16)==="1234"})();var f=0;if(j.Offset!==void 0)f=j.Offset;c=osg[i].BYTES_PER_ELEMENT;var u=j.Size,s=h.getItemSize(),w=u*c*s;if(e){osg.log("big endian detected");
u=new osg[i](u*s);a=new DataView(a,f,w);f=0;w=u.length;if(i==="Uint16Array")for(;f<w;f++)tempArray[f]=a.getUint16(f*c,!0);else if(i==="Float32Array")for(;f<w;f++)tempArray[f]=a.getFloat32(f*c,!0);c=tempArray;a=null}else c=new osg[i](a,f,s*u);k=b=null;h.setElements(c);g.resolve(h)});else if(j.Elements!==void 0){var k=new osg[i](j.Elements);h.setElements(k)}f=h}c!==void 0&&(this._identifierMap[c]=f);return g!==void 0?g.promise:f}},readUserDataContainer:function(){var a=this.getJSON(),c,e=a.UniqueID;
if(e!==void 0&&(c=this._identifierMap[e],c!==void 0))return c.Values;this._identifierMap[e]=a;return a.Values},readPrimitiveSet:function(){var a=this.getJSON(),c,e,f,g,h=a.DrawElementUShort||a.DrawElementUByte||a.DrawElementUInt||a.DrawElementsUShort||a.DrawElementsUByte||a.DrawElementsUInt||void 0;if(h){c=h.UniqueID;if(c!==void 0&&(e=this._identifierMap[c],e!==void 0))return e;g=osgDB.Promise.defer();e=h.Indices;mode=(mode=h.Mode)?osg.PrimitiveSet[mode]:osg.PrimitiveSet.TRIANGLES;f=new osg.DrawElements(mode);
this.setJSON(e);osgDB.Promise.when(this.readBufferArray()).then(function(a){f.setIndices(a);g.resolve(f)});this.setJSON(a)}if(h=a.DrawArray||a.DrawArrays){c=h.UniqueID;if(c!==void 0&&(e=this._identifierMap[c],e!==void 0))return e;mode=h.Mode||h.mode;first=h.First!==void 0?h.First:h.first;count=h.Count!==void 0?h.Count:h.count;f=new osg.DrawArrays(osg.PrimitiveSet[mode],first,count)}if(a=a.DrawArrayLengths||void 0){c=a.UniqueID;if(c!==void 0&&(e=this._identifierMap[c],e!==void 0))return e;mode=a.Mode;
first=a.First;f=new osg.DrawArrayLengths(osg.PrimitiveSet[mode],first,a.ArrayLengths)}c!==void 0&&(this._identifierMap[c]=f);return g?g.promise:f},readObject:function(){var a=this.getJSON(),c=Object.keys(a)[0];if(c){var e=a[c].UniqueID,f;if(e!==void 0&&(f=this._identifierMap[e],f!==void 0))return f;if(f=this.getObjectWrapper(c)){for(var g=osgDB.ObjectWrapper.serializers,h=c.split("."),j=0,i=h.length;j<i;j++)if(g=g[h[j]],g===void 0){osg.warn("can't find function to read object "+c+" - undefined");
return}a=g(this.setJSON(a[c]),f);e!==void 0&&(this._identifierMap[e]=f);return a}else osg.warn("can't instanciate object "+c)}else osg.warn("can't find property for object "+a)}};osgDB.Promise={};
(function(){var a=osgDB.Promise;(function(c){if(typeof define==="function")define(c);else if(typeof a==="object")c(void 0,a);else if(typeof ses!=="undefined"){if(ses.ok())ses.makeQ=function(){return c(void 0,{})}}else c(void 0,Q={})})(function(a,e){function f(a){var c=Error.prepareStackTrace;Error.prepareStackTrace=function(a,c){return c.filter(function(a){a=a.getFileName();return a!=="module.js"&&a!=="node.js"&&a!==U})};a=a.stack;Error.prepareStackTrace=c;return a}function g(a,c,e){return function(){typeof console!==
"undefined"&&typeof console.warn==="function"&&console.warn(c+" is deprecated, use "+e+" instead.");return a.apply(a,arguments)}}function h(){function a(f){if(c)return e=q(f),M(c,function(a,c){A(function(){e.promiseSend.apply(e,c)})},void 0),c=void 0,e}var c=[],e,f=N(h.prototype),g=N(j.prototype);g.promiseSend=function(){var a=y(arguments);c?c.push(a):A(function(){e.promiseSend.apply(e,a)})};g.valueOf=function(){return c?g:e.valueOf()};Error.captureStackTrace&&Error.captureStackTrace(g,h);D(g);f.promise=
g;f.resolve=a;f.reject=function(c){return a(p(c))};return f}function j(a,c,e,f){c===void 0&&(c=function(a){return p(Error("Promise does not support operation: "+a))});var g=N(j.prototype);g.promiseSend=function(e,f){var h=y(arguments,2),i;try{i=a[e]?a[e].apply(g,h):c.apply(g,[e].concat(h))}catch(j){i=p(j)}f(i)};if(e)g.valueOf=e;if(f)g.exception=f;D(g);return g}function i(a){return Object(a)!==a?a:a.valueOf()}function k(a){return a&&typeof a.promiseSend==="function"}function m(a){return!k(i(a))}function n(a){a=
i(a);return k(a)&&"exception"in a}function p(a){var a=a||Error(),c=j({when:function(c){if(c){var e=Y(O,this);e!==-1&&(P.splice(e,1),O.splice(e,1))}return c?c(a):p(a)}},function(){return p(a)},function(){return this},a);O.push(c);P.push(a);return c}function q(a){if(k(a))return a;if(a&&typeof a.then==="function"){var c=h();a.then(c.resolve,c.reject);return c.promise}return j({when:function(){return a},get:function(c){return a[c]},put:function(c,e){return a[c]=e},del:function(c){return delete a[c]},
post:function(c,e){return a[c].apply(a,e)},apply:function(c,e){return a.apply(c,e)},fapply:function(c){return a.apply(void 0,c)},viewInfo:function(){function c(a){f[a]||(f[a]=typeof e[a])}for(var e=a,f={};e;)Object.getOwnPropertyNames(e).forEach(c),e=Object.getPrototypeOf(e);return{type:typeof a,properties:f}},keys:function(){return V(a)}},void 0,function(){return a})}function u(a,c){a=q(a);return c?j({viewInfo:function(){return c}},function(c){var e=y(arguments);return B.apply(void 0,[a].concat(e))},
function(){return i(a)}):B(a,"viewInfo")}function s(a,c,e){function f(a){try{return c?c(a):a}catch(e){return p(e)}}function g(a){try{return e?e(a):p(a)}catch(c){return p(c)}}var i=h(),j=!1;A(function(){q(a).promiseSend("when",function(a){j||(j=!0,q(a).promiseSend("when",function(a){i.resolve(f(a))},function(a){i.resolve(g(a))}))},function(a){j||(j=!0,i.resolve(g(a)))})});return i.promise}function w(a){return function(c){var e=y(arguments,1);return B.apply(void 0,[c,a].concat(e))}}function B(a,c){var e=
h(),f=y(arguments,2),a=q(a);A(function(){a.promiseSend.apply(a,[c,e.resolve].concat(f))});return e.promise}function E(a,c,e){var f=h(),a=q(a);A(function(){a.promiseSend.apply(a,[c,f.resolve].concat(e))});return f.promise}function v(a){return function(c){var e=y(arguments,1);return E(c,a,e)}}function J(a,c){var e=y(arguments,2);return R(a,c,e)}function z(a){var c=y(arguments,1);return S(a,c)}function I(a){return s(a,function(a){var c=a.length;if(c===0)return q(a);var e=h();M(a,function(f,g,h){s(g,
function(f){a[h]=f;--c===0&&e.resolve(a)}).fail(e.reject)},void 0);return e.promise})}function F(a,c,e){return G(a,c).apply(void 0,e)}function G(a){if(arguments.length>1)var c=arguments[1],e=y(arguments,2),f=a,a=function(){var a=e.concat(y(arguments));return f.apply(c,a)};return function(){var c=h(),e=y(arguments);e.push(c.makeNodeResolver());S(a,e).fail(c.reject);return c.promise}}var H=function(){},D=Object.freeze||H;if(typeof cajaVM!=="undefined")D=cajaVM.def;var A;if(typeof process!=="undefined")A=
process.nextTick;else if(typeof msSetImmediate==="function")A=msSetImmediate.bind(window);else if(typeof setImmediate==="function")A=setImmediate;else if(typeof MessageChannel!=="undefined"){var K=new MessageChannel,C={},L=C;K.port1.onmessage=function(){C=C.next;var a=C.task;delete C.task;a()};A=function(a){L=L.next={task:a};K.port2.postMessage(0)}}else A=function(a){setTimeout(a,0)};var x;Function.prototype.bind?(x=Function.prototype.bind,x=x.bind(x.call)):x=function(a){return function(c){return a.call.apply(a,
arguments)}};var y=x(Array.prototype.slice),M=x(Array.prototype.reduce||function(a,c){var e=0,f=this.length;if(arguments.length===1){do{if(e in this){c=this[e++];break}if(++e>=f)throw new TypeError;}while(1)}for(;e<f;e++)e in this&&(c=a(c,this[e],e));return c}),Y=x(Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1}),W=x(Array.prototype.map||function(a,c){var e=this,f=[];M(e,function(g,h,i){f.push(a.call(c,h,i,e))},void 0);return f}),N=Object.create||
function(a){function c(){}c.prototype=a;return new c},V=Object.keys||function(a){var c=[],e;for(e in a)c.push(e);return c},Z=Object.prototype.toString,T;T=typeof ReturnValue!=="undefined"?ReturnValue:function(a){this.value=a};var U;Error.captureStackTrace&&(U=function(){var a,c=Error.prepareStackTrace;Error.prepareStackTrace=function(c,e){a=e[0].getFileName()};Error.prepareStackTrace=c;return a}());e.nextTick=A;e.defer=h;h.prototype.makeNodeResolver=function(){var a=this;return function(c,e){c?a.reject(c):
arguments.length>2?a.resolve(y(arguments,1)):a.resolve(e)}};h.prototype.node=g(h.prototype.makeNodeResolver,"node","makeNodeResolver");e.promise=function(a){var c=h();J(a,void 0,c.resolve,c.reject).fail(c.reject);return c.promise};e.makePromise=j;j.prototype.then=function(a,c){return s(this,a,c)};M("isResolved,isFulfilled,isRejected,when,spread,send,get,put,del,post,invoke,keys,apply,call,bind,fapply,fcall,fbind,all,allResolved,view,viewInfo,timeout,delay,catch,finally,fail,fin,end".split(","),function(a,
c){j.prototype[c]=function(){return e[c].apply(e,[this].concat(y(arguments)))}},void 0);j.prototype.toSource=function(){return this.toString()};j.prototype.toString=function(){return"[object Promise]"};D(j.prototype);e.nearer=i;e.isPromise=k;e.isResolved=function(a){return m(a)||n(a)};e.isFulfilled=m;e.isRejected=n;var O=[],P=[];typeof window!=="undefined"&&window.console&&console.log("Should be empty:",P);e.reject=p;e.begin=q;e.resolve=q;e.ref=g(q,"ref","resolve");e.master=function(a){return j({isDef:function(){}},
function(c){var e=y(arguments);return B.apply(void 0,[a].concat(e))},function(){return i(a)})};e.viewInfo=u;e.view=function(a){return u(a).when(function(c){var e;e=c.type==="function"?function(){return R(a,void 0,arguments)}:{};var f=c.properties||{};V(f).forEach(function(c){f[c]==="function"&&(e[c]=function(){return X(a,c,arguments)})});return q(e)})};e.when=s;e.spread=function(a,c,e){return s(a,function(a){return c.apply(void 0,a)},e)};e.async=function(a){return function(){function c(a,h){var i;
try{i=e[a](h)}catch(j){return Z(j)==="[object StopIteration]"||j instanceof T?j.value:p(j)}return s(i,f,g)}var e=a.apply(this,arguments),f=c.bind(c,"send"),g=c.bind(c,"throw");return f()}};e["return"]=function(a){throw new T(a);};e.sender=g(w,"sender","dispatcher");e.Method=g(w,"Method","dispatcher");e.send=g(B,"send","dispatch");e.dispatch=E;e.dispatcher=v;e.get=v("get");e.put=v("put");e["delete"]=e.del=v("del");var X=e.post=v("post");e.invoke=function(a,c){var e=y(arguments,2);return X(a,c,e)};
var R=e.apply=g(v("apply"),"apply","fapply"),S=e.fapply=v("fapply");e.call=g(J,"call","fcall");e["try"]=z;e.fcall=z;e.bind=g(function(a,c){var e=y(arguments,2);return function(){var f=e.concat(y(arguments));return R(a,c,f)}},"bind","fbind");e.fbind=function(a){var c=y(arguments,1);return function(){var e=c.concat(y(arguments));return S(a,e)}};e.keys=v("keys");e.all=I;e.allResolved=function(a){return s(a,function(a){return s(I(W(a,function(a){return s(a,H,H)})),function(){return W(a,q)})})};e["catch"]=
e.fail=function(a,c){return s(a,void 0,c)};e["finally"]=e.fin=function(a,c){return s(a,function(a){return s(c(),function(){return a})},function(a){return s(c(),function(){return p(a)})})};e.end=function(a){s(a,void 0,function(c){A(function(){if(Error.captureStackTrace&&"stack"in c){var e=f(c),g=f(a),e=e.concat("From previous event:",g),h,g=[];try{g.push(c.toString())}catch(i){try{g.push("<error: "+i+">")}catch(j){g.push("<error>")}}for(var k=0;k<e.length;k++){var m=e[k];if(typeof m==="string")g.push(m);
else{try{var n="";if(m.isNative())n="native";else if(m.isEval())n="eval at "+m.getEvalOrigin();else{var p=m.getFileName();if(p){n+=p;var q=m.getLineNumber();if(q!==null){n+=":"+q;var s=m.getColumnNumber();s&&(n+=":"+s)}}}n||(n="unknown source");var u="",C=m.getFunction().name,K=!0,y=m.isConstructor();if(!m.isToplevel()&&!y){var v=m.getMethodName();u+=m.getTypeName()+".";C?(u+=C,v&&v!==C&&(u+=" [as "+v+"]")):u+=v||"<anonymous>"}else y?u+="new "+(C||"<anonymous>"):C?u+=C:(u+=n,K=!1);K&&(u+=" ("+n+")");
h=u}catch(w){try{h="<error: "+w+">"}catch(x){h="<error>"}}g.push("    at "+h)}}h=g.join("\n");c.stack=h}throw c;})})};e.timeout=function(a,c){var e=h(),f=setTimeout(function(){e.reject(Error("Timed out after "+c+" ms"))},c);s(a,function(a){clearTimeout(f);e.resolve(a)},e.reject);return e.promise};e.delay=function(a,c){c===void 0&&(c=a,a=void 0);var e=h();setTimeout(function(){e.resolve(a)},c);return e.promise};e.napply=F;e.ncall=function(a,c){var e=y(arguments,2);return F(a,c,e)};e.nbind=G;e.npost=
function(a,c,e){return F(a[c],a,e)};e.ninvoke=function(a,c){var e=y(arguments,2);return F(a[c],a,e)};D(e)})})();var osgViewer={};
WebGLUtils=function(){var a='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',c='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',e=function(a,c){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],j=null,i=0;i<e.length;++i){try{j=a.getContext(e[i],c)}catch(k){}if(j)break}return j};return{create3DContext:e,setupWebGL:function(f,g,h){function j(e){var f=
document.getElementsByTagName("body")[0];if(f){var g=window.WebGLRenderingContext?c:a;e&&(g+="<br/><br/>Status: "+e);f.innerHTML='<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+g+"</div>"}}h=h||j;f.addEventListener&&f.addEventListener("webglcontextcreationerror",function(a){h(a.statusMessage)},!1);(f=e(f,g))||h("");return f}}}();
if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();
if(!window.cancelRequestAnimFrame)window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();
WebGLDebugUtils=function(){function a(a){if(i===null){i={};for(var c in a)typeof a[c]=="number"&&(i[a[c]]=c)}}function c(){if(i===null)throw"WebGLDebugUtils.init(ctx) not called";}function e(a){c();var e=i[a];return e!==void 0?e:"*UNKNOWN WebGL ENUM (0x"+a.toString(16)+")"}function f(a,c,f){a=j[a];return a!==void 0&&a[c]?e(f):f.toString()}function g(a,c,e){a.__defineGetter__(e,function(){return c[e]});a.__defineSetter__(e,function(a){c[e]=a})}function h(a){var c=a.getParameter(a.MAX_VERTEX_ATTRIBS),
e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);var f;for(f=0;f<c;++f)a.disableVertexAttribArray(f),a.vertexAttribPointer(f,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(f,0);a.deleteBuffer(e);c=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(f=0;f<c;++f)a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,
null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,
4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););
}var j={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},
bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},
blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},i=null;return{init:a,mightBeEnum:function(a){c();return i[a]!==void 0},glEnumToString:e,glFunctionArgToString:f,makeDebugContext:function(c,h){function i(a,c){return function(){var e=a[c].apply(a,arguments),f=a.getError();f!==0&&(j[f]=!0,h(f,c,arguments));return e}}a(c);var h=h||function(a,
c,g){for(var h="",i=0;i<g.length;++i)h+=(i===0?"":", ")+f(c,i,g[i]);a="WebGL error "+e(a)+" in "+c+"("+h+")";window.console&&window.console.log&&window.console.log(a)},j={},q={},u;for(u in c)typeof c[u]=="function"?q[u]=i(c,u):g(q,c,u);q.getError=function(){for(var a in j)if(j[a])return j[a]=!1,a;return c.NO_ERROR};return q},makeLostContextSimulatingCanvas:function(a){function c(a){return typeof a=="function"?a:function(c){a.handleEvent(c)}}function e(){for(var a=Object.keys(A),c=0;c<a.length;++c)delete A[a]}
function f(){++G;z||F==G&&a.loseContext()}function i(a,c){var e=a[c];return function(){f();if(!z)return e.apply(a,arguments)}}function j(a){return{statusMessage:a,preventDefault:function(){H=!0}}}function s(a){for(var c in a)typeof a[c]=="function"?v[c]=i(a,c):g(v,a,c);v.getError=function(){f();var a;if(!z)for(;a=w.getError();)A[a]=!0;for(a in A)if(A[a])return delete A[a],a;return v.NO_ERROR};var e="createBuffer,createFramebuffer,createProgram,createRenderbuffer,createShader,createTexture".split(",");
for(c=0;c<e.length;++c){var h=e[c];v[h]=function(c){return function(){f();if(z)return null;var e=c.apply(a,arguments);e.__webglDebugContextLostId__=J;I.push(e);return e}}(a[h])}e="getActiveAttrib,getActiveUniform,getBufferParameter,getContextAttributes,getAttachedShaders,getFramebufferAttachmentParameter,getParameter,getProgramParameter,getProgramInfoLog,getRenderbufferParameter,getShaderParameter,getShaderInfoLog,getShaderSource,getTexParameter,getUniform,getUniformLocation,getVertexAttrib".split(",");
for(c=0;c<e.length;++c)h=e[c],v[h]=function(c){return function(){f();return z?null:c.apply(a,arguments)}}(v[h]);e="isBuffer,isEnabled,isFramebuffer,isProgram,isRenderbuffer,isShader,isTexture".split(",");for(c=0;c<e.length;++c)h=e[c],v[h]=function(c){return function(){f();return z?!1:c.apply(a,arguments)}}(v[h]);v.checkFramebufferStatus=function(c){return function(){f();return z?v.FRAMEBUFFER_UNSUPPORTED:c.apply(a,arguments)}}(v.checkFramebufferStatus);v.getAttribLocation=function(c){return function(){f();
return z?-1:c.apply(a,arguments)}}(v.getAttribLocation);v.getVertexAttribOffset=function(c){return function(){f();return z?0:c.apply(a,arguments)}}(v.getVertexAttribOffset);v.isContextLost=function(){return z};return v}var w,B=[],E=[],v={},J=1,z=!1,I=[],F=0,G=0,H=!1,D=0,A={};a.getContext=function(c){return function(){var e=c.apply(a,arguments);if(e instanceof WebGLRenderingContext){if(e!=w){if(w)throw"got different context";w=e;v=s(w)}return v}return e}}(a.getContext);(function(a){var e=a.addEventListener;
a.addEventListener=function(f,g,h){switch(f){case "webglcontextlost":B.push(c(g));break;case "webglcontextrestored":E.push(c(g));break;default:e.apply(a,arguments)}}})(a);a.loseContext=function(){if(!z){z=!0;F=0;for(++J;w.getError(););e();A[w.CONTEXT_LOST_WEBGL]=!0;var c=j("context lost"),f=B.slice();setTimeout(function(){for(var e=0;e<f.length;++e)f[e](c);D>=0&&setTimeout(function(){a.restoreContext()},D)},0)}};a.restoreContext=function(){z&&E.length&&setTimeout(function(){if(!H)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<I.length;++a){var c=I[a];c instanceof WebGLBuffer?w.deleteBuffer(c):c instanceof WebGLFramebuffer?w.deleteFramebuffer(c):c instanceof WebGLProgram?w.deleteProgram(c):c instanceof WebGLRenderbuffer?w.deleteRenderbuffer(c):c instanceof WebGLShader?w.deleteShader(c):c instanceof WebGLTexture&&w.deleteTexture(c)}h(w);z=!1;G=0;H=!1;for(var a=E.slice(),c=j("context restored"),e=0;e<a.length;++e)a[e](c)},0)};a.loseContextInNCalls=function(a){if(z)throw"You can not ask a lost contet to be lost";
F=G+a};a.getNumCalls=function(){return G};a.setRestoreTimeout=function(a){D=a};return a},resetToInitialState:h}}();var Stats={Stats:function(a){this.layers=[];this.last_update=void 0;this.canvas=a}};
Stats.Stats.prototype={addLayer:function(a,c){a===void 0&&(a="rgb(255,255,255)");this.layers.push({previous:0,color:a,getValue:c})},update:function(){var a=(new Date).getTime();if(this.last_update===void 0)this.last_update=a;var c=(a-this.last_update)*120/1E3;if(!(c<1)){a-=(c-Math.floor(c))/0.12;var c=Math.floor(c),e=this.canvas,f=e.width,g=e.height,h=e.getContext("2d");h.save();h.globalCompositeOperation="copy";h.mozImageSmoothingEnabled=!1;h.translate(-c,0);h.drawImage(e,0,0,f,g);h.restore();h.clearRect(f-
c,0,c,g);for(var j=0,i=this.layers.length;j<i;j++){var k=this.layers[j],e=this.canvas,m=k.getValue(a),f=e.width,g=e.height;h.lineWidth=1;h.strokeStyle=k.color;h.beginPath();h.moveTo(f-c,g-k.previous);h.lineTo(f,g-m);h.stroke();k.previous=m}this.last_update=a}}};
osgViewer.View=function(){this._graphicContext=void 0;this._camera=new osg.Camera;this._scene=new osg.Node;this._sceneData=void 0;this._frameStamp=new osg.FrameStamp;this._manipulator=this._lightingMode=void 0;this.setLightingMode(osgViewer.View.LightingMode.HEADLIGHT);this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Material);this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.Depth);this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.BlendFunc);this._scene.getOrCreateStateSet().setAttributeAndMode(new osg.CullFace)};
osgViewer.View.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2};
osgViewer.View.prototype={setGraphicContext:function(a){this._graphicContext=a},getGraphicContext:function(){return this._graphicContext},setUpView:function(a){var c=a.width/a.height;this._camera.setViewport(new osg.Viewport(0,0,a.width,a.height));osg.Matrix.makeLookAt([0,0,-10],[0,0,0],[0,1,0],this._camera.getViewMatrix());osg.Matrix.makePerspective(60,c,1,1E3,this._camera.getProjectionMatrix())},computeIntersections:function(a,c,e){e===void 0&&(e=-1);var f=new osgUtil.IntersectVisitor;f.setTraversalMask(e);
f.addLineSegment([a,c,0],[a,c,1]);f.pushCamera(this._camera);this._sceneData.accept(f);return f.hits},setFrameStamp:function(a){this._frameStamp=a},getFrameStamp:function(){return this._frameStamp},setCamera:function(a){this._camera=a},getCamera:function(){return this._camera},setSceneData:function(a){this._scene.removeChildren();this._scene.addChild(a);this._sceneData=a},getSceneData:function(){return this._sceneData},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},
setManipulator:function(a){this._manipulator=a},getLight:function(){return this._light},setLight:function(a){this._light=a;this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndMode(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(a){if(this._lightingMode!==a)if(this._lightingMode=a,this._lightingMode!==osgViewer.View.LightingMode.NO_LIGHT){if(!this._light)this._light=new osg.Light,this._light.setAmbient([0.2,
0.2,0.2,1]),this._light.setDiffuse([0.8,0.8,0.8,1]),this._light.setSpecular([0.5,0.5,0.5,1])}else this._light=void 0}};
osgViewer.Viewer=function(a,c,e){osgViewer.View.call(this);c===void 0&&(c={antialias:!0});osg.SimulateWebGLLostContext&&(a=WebGLDebugUtils.makeLostContextSimulatingCanvas(a),a.loseContextInNCalls(osg.SimulateWebGLLostContext));gl=WebGLUtils.setupWebGL(a,c,e);var f=this;a.addEventListener("webglcontextlost",function(a){f.contextLost();a.preventDefault()},!1);a.addEventListener("webglcontextrestored",function(){f.contextRestored()},!1);osg.reportWebGLError&&(gl=WebGLDebugUtils.makeDebugContext(gl));
if(gl){this.setGraphicContext(gl);osg.init();this._canvas=a;this._frameRate=60;osgUtil.UpdateVisitor=osg.UpdateVisitor;osgUtil.CullVisitor=osg.CullVisitor;this._urlOptions=!0;this._mouseEventNode=this._mouseWheelEventNode=a;this._keyboardEventNode=document;if(c){if(c.mouseWheelEventNode)this._mouseWheelEventNode=c.mouseWheelEventNode;if(c.mouseEventNode)this._mouseEventNode=c.mouseEventNode;if(c.keyboardEventNode)this._keyboardEventNode=c.keyboardEventNode}this.setUpView(a)}else throw"No WebGL implementation found";
};
osgViewer.Viewer.prototype=osg.objectInehrit(osgViewer.View.prototype,{contextLost:function(){osg.log("webgl context lost");cancelRequestAnimFrame(this._requestID)},contextRestored:function(){osg.log("webgl context restored, but not supported - reload the page")},init:function(){this._done=!1;this._state=new osg.State;var a=this.getGraphicContext();this._state.setGraphicContext(a);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);this._updateVisitor=new osgUtil.UpdateVisitor;this._cullVisitor=new osgUtil.CullVisitor;this._renderStage=
new osg.RenderStage;this._stateGraph=new osg.StateGraph;this._urlOptions&&this.parseOptions();this.getCamera().setClearColor([0,0,0,0])},getState:function(){return this._state},parseOptions:function(){var a=function(){for(var a=[],c,g=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<g.length;h++){c=g[h].split("=");var j=c[0].toLowerCase();a.push(j);c=c[1];c===void 0&&(c="1");a[j]=c.toLowerCase()}return a}();a.stats==="1"&&this.initStats(a);var c=this.getGraphicContext();
a.depth_test==="0"&&this.getGraphicContext().disable(c.DEPTH_TEST);a.blend==="0"&&this.getGraphicContext().disable(c.BLEND);a.cull_face==="0"&&this.getGraphicContext().disable(c.CULL_FACE);a.light==="0"&&this.setLightingMode(osgViewer.View.LightingMode.NO_LIGHT)},initStats:function(a){var c=50,e=10;a.statsMaxMS!==void 0&&(c=parseInt(a.statsMaxMS,10));a.statsStepMS!==void 0&&(e=parseInt(a.statsStepMS,10));a=function(a){var a=a===void 0?document.body:document.getElementById(a),f=document.createElement("div");
f.innerHTML="<div id='StatsDiv' style='float: left; position: relative; width: 300px; height: 150px; z-index: 10;'>\n<div id='StatsLegends' style='position: absolute; left: 0px; font-size: 14px;color: #ffffff;'>\n<div id='frameRate' style='color: #00ff00;' > frameRate </div>\n<div id='frameTime' style='color: #ffff00;' > frameTime </div>\n<div id='updateTime' style='color: #d07b1f;'> updateTime </div>\n<div id='cullTime' style='color: #73e0ff;'> cullTime </div>\n<div id='drawTime' style='color: #ff0000;'> drawTime </div>\n<div id='fps'> </div>\n</div>\n<div id='StatsCanvasDiv' style='position: relative;'>\n<canvas id='StatsCanvasGrid' width='300' height='150' style='z-index:-1; position: absolute; background: rgba(14,14,14,0.8); ' ></canvas>\n<canvas id='StatsCanvas' width='300' height='150' style='z-index:8; position: absolute;' ></canvas>\n<canvas id='StatsCanvasFps' width='30' height='15' style='z-index:9; position: absolute; top: 130px' ></canvas>\n</div>\n</div>";
a.appendChild(f);a=document.getElementById("StatsCanvasGrid");f=a.getContext("2d");f.clearRect(0,0,a.width,a.height);var g=Math.floor(c/e).toFixed(0),h=a.height/g;f.strokeStyle="rgb(70,70,70)";for(var n=0;n<g;n++)f.beginPath(),f.moveTo(0,n*h),f.lineTo(a.width,n*h),f.stroke();f=document.getElementById("StatsCanvasFps").getContext("2d");f.font="14px Sans";return document.getElementById("StatsCanvas")};if(this._canvasStats===void 0||this._canvasStats===null)this._canvasStats=a();this._stats=new Stats.Stats(this._canvasStats);
var f=this;this._frameRate=1;this._drawTime=this._cullTime=this._updateTime=this._frameTime=0;var g=this._canvasStats.height,h=g/c;g-=2;a=function(a,c){var e=document.getElementById(a);return e.style?e.style.getPropertyValue(c):null};this._stats.addLayer(a("frameRate","color"),function(){var a=g/60*(1E3/f._frameRate);return a>g?g:a});this._stats.addLayer(a("frameTime","color"),function(){var a=f._frameTime*h;return a>g?g:a});this._stats.addLayer(a("updateTime","color"),function(){var a=f._updateTime*
h;return a>g?g:a});this._stats.addLayer(a("cullTime","color"),function(){var a=f._cullTime*h;return a>g?g:a});this._stats.addLayer(a("drawTime","color"),function(){var a=f._drawTime*h;return a>g?g:a})},update:function(){this.getScene().accept(this._updateVisitor)},cull:function(){this._stateGraph.clean();this._renderStage.reset();this._cullVisitor.reset();this._cullVisitor.setStateGraph(this._stateGraph);this._cullVisitor.setRenderStage(this._renderStage);var a=this.getCamera();this._cullVisitor.pushStateSet(a.getStateSet());
this._cullVisitor.pushProjectionMatrix(a.getProjectionMatrix());a.getBound();this._cullVisitor.pushModelviewMatrix(osg.Matrix.makeIdentity([]));this._light&&this._cullVisitor.addPositionedAttribute(this._light);this._cullVisitor.pushModelviewMatrix(a.getViewMatrix());this._cullVisitor.pushViewport(a.getViewport());this._cullVisitor.setCullSettings(a);this._renderStage.setClearDepth(a.getClearDepth());this._renderStage.setClearColor(a.getClearColor());this._renderStage.setClearMask(a.getClearMask());
this._renderStage.setViewport(a.getViewport());this.getScene().accept(this._cullVisitor);this._cullVisitor.popModelviewMatrix();this._cullVisitor.popProjectionMatrix();this._cullVisitor.popViewport();this._cullVisitor.popStateSet();this._renderStage.sort()},draw:function(){var a=this.getState();this._renderStage.draw(a);a.popAllStateSets();a.applyWithoutProgram()},frame:function(){var a;a=(new Date).getTime();if(this._lastFrameTime===void 0)this._lastFrameTime=0;this._frameRate=a-this._lastFrameTime;
this._lastFrameTime=a;var c=this.getFrameStamp();if(c.getFrameNumber()===0)c.setReferenceTime(a/1E3),this._numberFrame=0;c.setSimulationTime(a/1E3-c.getReferenceTime());this._updateVisitor.setFrameStamp(this.getFrameStamp());this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),osg.Matrix.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix()));var e=(new Date).getTime();this.update();var f=(new Date).getTime();this._updateTime=f-e;this.cull();e=(new Date).getTime();
this._cullTime=e-f;this.draw();this._drawTime=e=(new Date).getTime()-e;f=c.getFrameNumber()+1;c.setFrameNumber(f);this._numberFrame++;c=(new Date).getTime();this._frameTime=(new Date).getTime()-a;if(this._stats!==void 0&&(this._stats.update(),this._numberFrame%60===0))a=(this._numberFrame*1E3/(c-this._statsStartTime)).toFixed(1),this._statsStartTime=c,this._numberFrame=0,c=document.getElementById("StatsCanvasFps"),f=c.getContext("2d"),f.clearRect(0,0,c.width,c.height),f.fillStyle="rgb(255,255,255)",
f.fillText(a,0,c.height)},setDone:function(a){this._done=a},done:function(){return this._done},run:function(){var a=this,c=function(){if(!a.done())a._requestID=window.requestAnimationFrame(c,a.canvas),a.frame()};c()},setupManipulator:function(a,c){a===void 0&&(a=new osgGA.OrbitManipulator);a.setNode!==void 0?a.setNode(this.getSceneData()):a.view=this;this.setManipulator(a);var e=this;if(c===void 0||c===!1){this._canvas.addEventListener("touchstart",function(a){return e.getManipulator().touchstart(a)},
!1);this._canvas.addEventListener("touchend",function(a){return e.getManipulator().touchend(a)},!1);this._canvas.addEventListener("touchmove",function(a){return e.getManipulator().touchmove(a)},!1);this._canvas.addEventListener("touchcancel",function(a){return e.getManipulator().touchcancel(a)},!1);this._canvas.addEventListener("touchleave",function(a){return e.getManipulator().touchleave(a)},!1);this._canvas.addEventListener("gesturestart",function(a){return e.getManipulator().gesturestart(a)},!1);
this._canvas.addEventListener("gesturechange",function(a){return e.getManipulator().gesturechange(a)},!1);this._canvas.addEventListener("gestureend",function(a){return e.getManipulator().gestureend(a)},!1);var f=function(a){return e.getManipulator().mousedown(a)},g=function(a){return e.getManipulator().mouseup(a)},h=function(a){return e.getManipulator().mousemove(a)},j=function(a){return e.getManipulator().dblclick(a)},i=function(a){var c=a||window.event,f=[].slice.call(arguments,1),g=0,h=0,i=0;a.type=
"mousewheel";a.wheelDelta&&(g=a.wheelDelta/120);a.detail&&(g=-a.detail/3);i=g;c.axis!==void 0&&c.axis===c.HORIZONTAL_AXIS&&(i=0,h=-1*g);c.wheelDeltaY!==void 0&&(i=c.wheelDeltaY/120);c.wheelDeltaX!==void 0&&(h=-1*c.wheelDeltaX/120);f.unshift(a,g,h,i);c=e.getManipulator();return c.mousewheel.apply(c,f)};e.getManipulator().mousedown&&this._mouseEventNode.addEventListener("mousedown",f,!1);e.getManipulator().mouseup&&this._mouseEventNode.addEventListener("mouseup",g,!1);e.getManipulator().mousemove&&
this._mouseEventNode.addEventListener("mousemove",h,!1);e.getManipulator().dblclick&&this._mouseEventNode.addEventListener("dblclick",j,!1);e.getManipulator().mousewheel&&(this._mouseWheelEventNode.addEventListener("DOMMouseScroll",i,!1),this._mouseWheelEventNode.addEventListener("mousewheel",i,!1));f=function(a){return e.getManipulator().keydown(a)};g=function(a){return e.getManipulator().keyup(a)};e.getManipulator().keydown&&this._keyboardEventNode.addEventListener("keydown",f,!1);e.getManipulator().keyup&&
this._keyboardEventNode.addEventListener("keyup",g,!1);var k=this;window.onresize=function(){var a=window.innerWidth,c=window.innerHeight,e=k._canvas.width,f=k._canvas.height;k._canvas.width=a;k._canvas.height=c;k._canvas.style.width=a;k._canvas.style.height=c;osg.log("window resize "+e+"x"+f+" to "+a+"x"+c);e=k.getCamera();f=e.getViewport();a/=f.width();c/=f.height();var g=a/c;f.setViewport(f.x()*a,f.y()*c,f.width()*a,f.height()*c);g!==1&&osg.Matrix.postMult(osg.Matrix.makeScale(1,g,1,[]),e.getProjectionMatrix())}}}});
osgGA={Manipulator:function(){this._touches=[];this._inverseMatrix=Array(16);osg.Matrix.makeIdentity(this._inverseMatrix)}};
osgGA.Manipulator.prototype={getPositionRelativeToCanvas:function(a){var c=a.target,e,f;if(a.pageX||a.pageY)e=a.pageX,f=a.pageY;else if(a.clientX||a.clientY)e=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;a=function(a){for(var c=0,e=0,c=a.offsetLeft,e=a.offsetTop,f=document.getElementsByTagName("body")[0];a.offsetParent&&a!=f;)c+=a.offsetParent.offsetLeft,e+=a.offsetParent.offsetTop,a=a.offsetParent;return[c,
e]}(c);e-=a[0];f=c.height-(f-a[1]);return[e,f]},keydown:function(){},keyup:function(){},mouseup:function(){},mousedown:function(){},mousemove:function(){},dblclick:function(){},touchstart:function(a){a.preventDefault();for(var a=a.changedTouches,c=0,e=a.length;c<e;c++){var f=a[c],g=f.identifier;this._touches[g]=f;f=this.getPositionRelativeToCanvas(f);osg.debug("touch "+g+" started at "+f[0]+" "+f[1])}},touchend:function(a){a.preventDefault();for(var a=a.changedTouches,c=0,e=a.length;c<e;c++){var f=
a[c],g=f.identifier;this._touches[g]=void 0;f=this.getPositionRelativeToCanvas(f);osg.debug("touch "+g+" stoped at "+f[0]+" "+f[1])}},touchmove:function(a){a.preventDefault();for(var a=a.changedTouches,c=0,e=a.length;c<e;c++){var f=a[c],g=f.identifier,h=this.getPositionRelativeToCanvas(f),j=this.getPositionRelativeToCanvas(this._touches[g]),i=h[0]-j[0],h=h[1]-j[1];this._touches[g]=f;osg.debug("touch "+g+" moved "+i+" "+h)}},touchleave:function(a){return this.touchend(a)},touchcancel:function(a){a.preventDefault();
for(var a=a.changedTouches,c=0,e=a.length;c<e;c++){var f=a[c],g=f.identifier;this._touches[g]=void 0;f=this.getPositionRelativeToCanvas(f);osg.debug("touch "+g+" cancelled at "+f[0]+" "+f[1])}},gesturestart:function(a){a.preventDefault();osg.debug("gesturestart  scale "+a.scale+" rotation "+a.rotation)},gestureend:function(a){a.preventDefault();osg.debug("gestureend  scale "+a.scale+" rotation "+a.rotation)},gesturechange:function(a){a.preventDefault();osg.debug("gesturechange scale "+a.scale+" rotation "+
a.rotation)},mousewheel:function(a,c,e,f){a.preventDefault();osg.debug("mousewheel "+c+"  "+e+" "+f)},update:function(){},getInverseMatrix:function(){return this._inverseMatrix}};osgGA.OrbitManipulator=function(){osgGA.Manipulator.call(this);this.init()};osgGA.OrbitManipulator.Rotate=0;osgGA.OrbitManipulator.Pan=1;osgGA.OrbitManipulator.Zoom=2;
osgGA.OrbitManipulator.Interpolator=function(a,c){this._current=Array(a);this._target=Array(a);this._delta=Array(a);this._delay=c;if(this._delay===void 0)this._delay=0.15;this._reset=!1;this.reset()};
osgGA.OrbitManipulator.Interpolator.prototype={reset:function(){for(var a=0,c=this._current.length;a<c;a++)this._current[a]=this._target[a]=0;this._reset=!0},update:function(){for(var a=0,c=this._current.length;a<c;a++){var e=(this._target[a]-this._current[a])*this._delay;this._delta[a]=e;this._current[a]+=e}return this._delta},set:function(){for(var a=0,c=this._current.length;a<c;a++)this._current[a]=this._target[a]=arguments[a];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},
setTarget:function(){for(var a=0,c=this._target.length;a<c;a++)this._target[a]=this._reset?this._current[a]=arguments[a]:arguments[a];this._reset=!1},getTarget:function(){return this._target},getDelta:function(){return this._delta}};
osgGA.OrbitManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{init:function(){this._distance=25;this._target=Array(3);osg.Vec3.init(this._target);this._rotation=osg.Matrix.mult(osg.Matrix.makeRotate(Math.PI,0,0,1,[]),osg.Matrix.makeRotate(-Math.PI/10,1,0,0,[]),[]);this._time=0;this._rotate=new osgGA.OrbitManipulator.Interpolator(2);this._pan=new osgGA.OrbitManipulator.Interpolator(2);this._zoom=new osgGA.OrbitManipulator.Interpolator(1);this._zoom.reset=function(){osgGA.OrbitManipulator.Interpolator.prototype.reset.call(this);
this._start=0};this._buttonup=!0;this._scale=10;this._currentMode=void 0;this._minDistance=this._maxDistance=0;this._scaleMouseMotion=0.1;this._moveTouch=this._node=void 0;this._inverseMatrix=Array(16);this._rotateKey=65;this._zoomKey=83;this._panKey=68},reset:function(){this.init()},setNode:function(a){this._node=a},setTarget:function(a){osg.Vec3.copy(a,this._target);var c=Array(3);this.getEyePosition(c);this._distance=osg.Vec3.distance(c,a)},setEyePosition:function(a){var c=this._rotation,e=this._target,
f=osg.Vec3.sub(a,e,[]);osg.Vec3.normalize(f,f);var g=osg.Vec3.cross(f,[0,0,1],[]);osg.Vec3.normalize(g,g);var h=osg.Vec3.cross(g,f,[]);osg.Vec3.normalize(h,h);c[0]=g[0];c[1]=f[0];c[2]=h[0];c[3]=0;c[4]=g[1];c[5]=f[1];c[6]=h[1];c[7]=0;c[8]=g[2];c[9]=f[2];c[10]=h[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;this._distance=osg.Vec3.distance(a,e)},computeHomePosition:function(){if(this._node!==void 0){var a=this._node.getBound();this.setDistance(a.radius()*1.5);this.setTarget(a.center())}},keydown:function(a){if(a.keyCode===
32)this.computeHomePosition();else if(a.keyCode===33)this.distanceIncrease();else if(a.keyCode===34)this.distanceDecrease();else if(a.keyCode===this._panKey&&this._currentMode!==osgGA.OrbitManipulator.Pan)this._currentMode=osgGA.OrbitManipulator.Pan,this._pan.reset(),this.pushButton(),a.preventDefault();else if(a.keyCode===this._zoomKey&&this._currentMode!==osgGA.OrbitManipulator.Zoom)this._currentMode=osgGA.OrbitManipulator.Zoom,this._zoom.reset(),this.pushButton(),a.preventDefault();else if(a.keyCode===
this._rotateKey&&this._currentMode!==osgGA.OrbitManipulator.Rotate)this._currentMode=osgGA.OrbitManipulator.Rotate,this._rotate.reset(),this.pushButton(),a.preventDefault()},keyup:function(a){a.keyCode===this._panKey?this.mouseup(a):a.keyCode===this._rotateKey?this.mouseup(a):a.keyCode===this._rotateKey&&this.mouseup(a);this._currentMode=void 0},touchstart:function(a){if(this._currentMode===void 0)this._currentMode=osgGA.OrbitManipulator.Rotate;var c=a.changedTouches;if(this._moveTouch===void 0)this._moveTouch=
new osgGA.OrbitManipulator.TouchEvent;if(this._moveTouch.id===void 0){var c=c[0],e=c.identifier,f=this.getPositionRelativeToCanvas(c);this._rotate.set(f[0],f[1]);this._moveTouch.init(e,f[0],f[1]);this.pushButton(c)}a.preventDefault()},touchend:function(a){a.preventDefault();this._moveTouch=this._currentMode=void 0;this.releaseButton(a)},touchmove:function(a){a.preventDefault();for(var a=a.changedTouches,c=0,e=a.length;c<e;c++){var f=a[c],g=f.identifier;g===this._moveTouch.id&&(f=this.getPositionRelativeToCanvas(f),
this._rotate.setTarget(f[0],f[1]),this._moveTouch.init(g,f[0],f[1]))}},touchleave:function(a){return this.touchend(a)},touchcancel:function(a){this.touchend(a)},gesturestart:function(a){a.preventDefault();if(this._moveTouch)this._moveTouch.id=void 0;this._moveTouch.init(void 0,0,0,a.scale,a.rotation);this._zoom.reset()},gestureend:function(a){a.preventDefault();this._moveTouch.init(void 0,0,0,a.scale,a.rotation);this._currentMode=void 0},gesturechange:function(a){a.preventDefault();var c=(a.scale-
this._moveTouch.scale)*5;this._moveTouch.init(void 0,0,0,a.scale,a.rotation);this._zoom.setTarget(this._zoom.getTarget()[0]-c)},mouseup:function(a){this.releaseButton(a);this._currentMode=void 0},mousedown:function(a){if(this._currentMode===void 0)this._currentMode=a.button===0?a.shiftKey?osgGA.OrbitManipulator.Pan:a.ctrlKey?osgGA.OrbitManipulator.Zoom:osgGA.OrbitManipulator.Rotate:osgGA.OrbitManipulator.Pan;this.pushButton(a);var c=this.getPositionRelativeToCanvas(a);if(this._currentMode===osgGA.OrbitManipulator.Rotate)this._rotate.reset(c[0],
c[1]),this._rotate.set(c[0],c[1]);else if(this._currentMode===osgGA.OrbitManipulator.Pan)this._pan.reset(c[0],c[1]),this._pan.set(c[0],c[1]);else if(this._currentMode===osgGA.OrbitManipulator.Zoom)this._zoom._start=c[1],this._zoom.set(0);a.preventDefault()},mousemove:function(a){if(this._buttonup!==!0){var c=this.getPositionRelativeToCanvas(a);if(isNaN(c[0])===!1&&isNaN(c[1])===!1)if(this._currentMode===osgGA.OrbitManipulator.Rotate)this._rotate.setTarget(c[0],c[1]);else if(this._currentMode===osgGA.OrbitManipulator.Pan)this._pan.setTarget(c[0],
c[1]);else if(this._currentMode===osgGA.OrbitManipulator.Zoom){if(this._zoom.isReset())this._zoom._start=c[1],this._zoom.set(0);var e=c[1]-this._zoom._start;this._zoom._start=c[1];this._zoom.setTarget(this._zoom.getTarget()[0]-e/20)}a.preventDefault();a.preventDefault()}},setMaxDistance:function(a){this._maxDistance=a},setMinDistance:function(a){this._minDistance=a},setDistance:function(a){this._distance=a},getDistance:function(){return this._distance},computePan:function(a,c){c*=this._distance;a*=
this._distance;var e=Array(16),f=Array(3),g=Array(3);osg.Matrix.inverse(this._rotation,e);f[0]=osg.Matrix.get(e,0,0);f[1]=osg.Matrix.get(e,0,1);f[2]=osg.Matrix.get(e,0,2);osg.Vec3.normalize(f,f);g[0]=osg.Matrix.get(e,2,0);g[1]=osg.Matrix.get(e,2,1);g[2]=osg.Matrix.get(e,2,2);osg.Vec3.normalize(g,g);osg.Vec3.mult(f,-a,f);osg.Vec3.mult(g,c,g);osg.Vec3.add(this._target,f,this._target);osg.Vec3.add(this._target,g,this._target)},computeRotation:function(a,c){var e=osg.Matrix.makeRotate(a/10,0,0,1,[]),
f=osg.Matrix.mult(this._rotation,e,[]),e=osg.Matrix.makeRotate(c/10,1,0,0,[]),e=osg.Matrix.mult(e,f,[]),g=[];osg.Matrix.inverse(e,g);g=osg.Matrix.transformVec3(g,[0,this._distance,0],Array(3));g=osg.Vec3.neg(g,[]);osg.Vec3.normalize(g,g);g=osg.Vec3.dot(g,[0,0,1]);this._rotation=Math.abs(g)>0.95?f:e},releaseButton:function(){this._buttonup=!0},mousewheel:function(a,c){a.preventDefault();this._zoom.setTarget(this._zoom.getTarget()[0]-c)},computeZoom:function(a){this.zoom(a)},zoom:function(a){a*=this._distance;
if(this._minDistance>0&&a<this._minDistance)a=this._minDistance;if(this._maxDistance>0&&a>this._maxDistance)a=this._maxDistance;this._distance=a},pushButton:function(){this._buttonup=!1},getTarget:function(a){osg.Vec3.copy(this._target,a)},getEyePosition:function(a){var c=Array(16);osg.Matrix.inverse(this._rotation,c);osg.Matrix.transformVec3(c,[0,this._distance,0],a);osg.Vec3.add(this._target,a,a)},update:function(a){a=a.getFrameStamp().getSimulationTime();if(this._lastUpdate===void 0)this._lastUpdate=
a;this._lastUpdate=a;a=this._rotate.update();this.computeRotation(-a[0]*0.1,-a[1]*0.1);a=this._pan.update();this.computePan(-a[0]*0.0020,-a[1]*0.0020);a=this._zoom.update();this.computeZoom(1+a[0]/10);var a=this._target,c=this._distance,e=Array(3);osg.Matrix.inverse(this._rotation,this._inverseMatrix);osg.Matrix.transformVec3(this._inverseMatrix,[0,c,0],e);osg.Matrix.makeLookAt(osg.Vec3.add(a,e,e),a,[0,0,1],this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}});
osgGA.OrbitManipulator.TouchEvent=function(){this.y=this.x=0;this.scale=1;this.rotation=0;this.id=void 0};osgGA.OrbitManipulator.TouchEvent.prototype={init:function(a,c,e,f,g){this.id=a;this.x=c;this.y=e;if(f!==void 0)this.scale=f;if(g!==void 0)this.rotation=g}};osgGA.FirstPersonManipulator=function(){osgGA.Manipulator.call(this);this.init()};
osgGA.FirstPersonManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{setNode:function(a){this._node=a;this.computeHomePosition()},computeHomePosition:function(){if(this._node!==void 0){var a=this._node.getBound();this._radius=a.radius();this._eye=[0,-a.radius()*1.5,0];this._angleHorizontal=this._angleVertical=0}},init:function(){this._direction=[0,1,0];this._angleHorizontal=this._angleVertical=0;this._eye=[0,25,10];this._up=[0,0,1];this._buttonup=!0;this._radius=1;this._forward=new osgGA.OrbitManipulator.Interpolator(1);
this._side=new osgGA.OrbitManipulator.Interpolator(1);this._lookPosition=new osgGA.OrbitManipulator.Interpolator(2);this._stepFactor=1;this._target=Array(3);osg.Vec3.init(this._target)},reset:function(){this.init()},getEyePosition:function(a){a[0]=this._eye[0];a[1]=this._eye[1];a[2]=this._eye[2];return a},setEyePosition:function(a){this._eye[0]=a[0];this._eye[1]=a[1];this._eye[2]=a[2]},getTarget:function(a,c){c===void 0&&(c=25);var e=osg.Vec3.mult(this._direction,c,Array(3));osg.Vec3.add(this._eye,
e,a)},setTarget:function(a){this._target[0]=a[0];this._target[1]=a[1];this._target[2]=a[2];var c=Array(3);osg.Vec3.sub(a,this._eye,c);c[2]=0;osg.Vec3.normalize(c,c);this._angleHorizontal=Math.acos(c[1]);if(c[0]<0)this._angleHorizontal=-this._angleHorizontal;osg.Vec3.sub(a,this._eye,c);osg.Vec3.normalize(c,c);this._angleVertical=-Math.asin(c[2]);osg.Vec3.copy(c,this._direction)},mousedown:function(a){a=this.getPositionRelativeToCanvas(a);this._lookPosition.set(a[0],a[1]);this._buttonup=!1},mouseup:function(){this._buttonup=
!0},mousemove:function(a){this._buttonup!==!0&&(a=this.getPositionRelativeToCanvas(a),this._lookPosition.setTarget(a[0],a[1]))},computeRotation:function(a,c){this._angleVertical+=c*0.01;this._angleHorizontal-=a*0.01;var e=[],f=[],g=[];osg.Matrix.makeRotate(this._angleVertical,1,0,0,e);osg.Matrix.makeRotate(this._angleHorizontal,0,0,1,f);osg.Matrix.mult(f,e,g);this._direction=osg.Matrix.transformVec3(g,[0,1,0],[]);osg.Vec3.normalize(this._direction,this._direction);this._up=osg.Matrix.transformVec3(g,
[0,0,1],[])},mousewheel:function(a,c){a.preventDefault();this._stepFactor=Math.min(Math.max(0.0010,this._stepFactor+c*0.01),4)},update:function(a){var c=a.getFrameStamp().getSimulationTime();if(this._lastUpdate===void 0)this._lastUpdate=c;a=c-this._lastUpdate;this._lastUpdate=c;this._forward.update();this._side.update();c=this._lookPosition.update();this.computeRotation(-c[0]*0.5,-c[1]*0.5);c=Array(2);c[0]=this._forward.getCurrent()[0];c[1]=this._side.getCurrent()[0];osg.Vec2.length(c)>1&&osg.Vec2.normalize(c,
c);var e=this._radius;this._radius<0.0010&&(e=1);this.moveForward(c[0]*e*this._stepFactor*a);this.strafe(c[1]*e*this._stepFactor*a);this._target=a=osg.Vec3.add(this._eye,this._direction,[]);osg.Matrix.makeLookAt(this._eye,a,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(a){a=osg.Vec3.mult(osg.Vec3.normalize(this._direction,[]),a,[]);this._eye=osg.Vec3.add(this._eye,a,[])},strafe:function(a){var c=osg.Vec3.cross(this._direction,this._up,
[]),a=osg.Vec3.mult(osg.Vec3.normalize(c,c),a,[]);this._eye=osg.Vec3.add(this._eye,a,[])},keydown:function(a){if(a.keyCode===32)this.computeHomePosition();else if(a.keyCode===87||a.keyCode===90||a.keyCode===38)return this._forward.setTarget(1),!1;else if(a.keyCode===83||a.keyCode===40)return this._forward.setTarget(-1),!1;else if(a.keyCode===68||a.keyCode===39)return this._side.setTarget(1),!1;else if(a.keyCode===65||a.keyCode===81||a.keyCode===37)return this._side.setTarget(-1),!1},keyup:function(a){if(a.keyCode===
87||a.keyCode===90||a.keyCode===38)return this._forward.setTarget(0),!1;else if(a.keyCode==83||a.keyCode===40)return this._forward.setTarget(0),!1;else if(a.keyCode==68||a.keyCode===39)return this._side.setTarget(0),!1;else if(a.keyCode===65||a.keyCode===81||a.keyCode===37)return this._side.setTarget(0),!1}});osgGA.SwitchManipulator=function(){osgGA.Manipulator.call(this);this._manipulatorList=[];this._currentManipulator=void 0};
osgGA.SwitchManipulator.prototype=osg.objectInehrit(osgGA.Manipulator.prototype,{update:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.update(a)},setNode:function(a){var c=this.getCurrentManipulator();c.setNode===void 0?osg.log("manipulator has not setNode method"):c.setNode(a)},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(a){this._manipulatorList.push(a);if(this._currentManipulator===void 0)this._currentManipulator=0},getManipulatorList:function(){return this._manipulatorList},
setManipulatorIndex:function(a){this._currentManipulator=a},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(){var a=this.getCurrentManipulator();a!==void 0&&a.computeHomePosition()},keydown:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.keydown(a)},keyup:function(a){var c=this.getCurrentManipulator();
if(c!==void 0)return c.keyup(a)},mouseup:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.mouseup(a)},mousedown:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.mousedown(a)},mousemove:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.mousemove(a)},dblclick:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.dblclick(a)},touchstart:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.touchstart(a)},touchend:function(a){var c=
this.getCurrentManipulator();if(c!==void 0)return c.touchend(a)},touchmove:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.touchmove(a)},touchleave:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.touchleave(a)},touchcancel:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.touchcancel(a)},gesturestart:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.gesturestart(a)},gestureend:function(a){var c=this.getCurrentManipulator();
if(c!==void 0)return c.gestureend(a)},gesturechange:function(a){var c=this.getCurrentManipulator();if(c!==void 0)return c.gesturechange(a)},mousewheel:function(a,c,e,f){var g=this.getCurrentManipulator();if(g!==void 0)return g.mousewheel(a,c,e,f)},getInverseMatrix:function(){var a=this.getCurrentManipulator();if(a!==void 0)return a.getInverseMatrix()}});osgDB.ObjectWrapper.serializers.osg={};
osgDB.ObjectWrapper.serializers.osg.Object=function(a,c){var e=a.getJSON();e.Name&&c.setName(e.Name);e.UserDataContainer&&(e=a.setJSON(e.UserDataContainer).readUserDataContainer(),e!==void 0&&c.setUserData(e));return c};
osgDB.ObjectWrapper.serializers.osg.Node=function(a,c){var e=a.getJSON();osgDB.ObjectWrapper.serializers.osg.Object(a,c);var f=[],g=function(e){var e=a.setJSON(e).readObject(),g=osgDB.Promise.defer();f.push(g.promise);osgDB.Promise.when(e).then(function(a){a&&c.addUpdateCallback(a);g.resolve()})};if(e.UpdateCallbacks)for(var h=0,j=e.UpdateCallbacks.length;h<j;h++)g(e.UpdateCallbacks[h]);if(e.StateSet){var g=a.setJSON(e.StateSet).readObject(),i=osgDB.Promise.defer();f.push(i.promise);osgDB.Promise.when(g).then(function(a){c.setStateSet(a);
i.resolve()})}g=function(e){var e=a.setJSON(e).readObject(),g=osgDB.Promise.defer();f.push(g.promise);osgDB.Promise.when(e).then(function(a){a&&c.addChild(a);g.resolve(a)})};if(e.Children){h=0;for(j=e.Children.length;h<j;h++)g(e.Children[h])}var k=osgDB.Promise.defer();osgDB.Promise.all(f).then(function(){k.resolve(c)});return k.promise};
osgDB.ObjectWrapper.serializers.osg.StateSet=function(a,c){var e=a.getJSON();osgDB.ObjectWrapper.serializers.osg.Object(a,c);e.RenderingHint!==void 0&&c.setRenderingHint(e.RenderingHint);var f=function(e){var e=a.setJSON(e).readObject(),f=osgDB.Promise.defer();g.push(f.promise);osgDB.Promise.when(e).then(function(a){a!==void 0&&c.setAttributeAndMode(a);f.resolve()})},g=[];if(e.AttributeList!==void 0)for(var h=0,j=e.AttributeList.length;h<j;h++)f(e.AttributeList[h]);f=function(e,f){var h=a.setJSON(f).readObject(),
i=osgDB.Promise.defer();g.push(i.promise);osgDB.Promise.when(h).then(function(a){a&&c.setTextureAttributeAndMode(e,a);i.resolve()})};if(e.TextureAttributeList){e=e.TextureAttributeList;h=0;for(j=e.length;h<j;h++)for(var i=e[h],k=0,m=i.length;k<m;k++)f(h,i[k])}var n=osgDB.Promise.defer();osgDB.Promise.all(g).then(function(){n.resolve(c)});return n.promise};
osgDB.ObjectWrapper.serializers.osg.Material=function(a,c){var e=a.getJSON();if(e.Diffuse!==void 0&&e.Emission!==void 0&&e.Specular!==void 0&&e.Shininess!==void 0)return osgDB.ObjectWrapper.serializers.osg.Object(a,c),c.setAmbient(e.Ambient),c.setDiffuse(e.Diffuse),c.setEmission(e.Emission),c.setSpecular(e.Specular),c.setShininess(e.Shininess),c};
osgDB.ObjectWrapper.serializers.osg.BlendFunc=function(a,c){var e=a.getJSON();if(e.SourceRGB&&e.SourceAlpha&&e.DestinationRGB&&e.DestinationAlpha)return osgDB.ObjectWrapper.serializers.osg.Object(a,c),c.setSourceRGB(e.SourceRGB),c.setSourceAlpha(e.SourceAlpha),c.setDestinationRGB(e.DestinationRGB),c.setDestinationAlpha(e.DestinationAlpha),c};
osgDB.ObjectWrapper.serializers.osg.CullFace=function(a,c){var e=a.getJSON();if(e.Mode!==void 0)return osgDB.ObjectWrapper.serializers.osg.Object(a,c),c.setMode(e.Mode),c};osgDB.ObjectWrapper.serializers.osg.BlendColor=function(a,c){var e=a.getJSON();if(e.ConstantColor!==void 0)return osgDB.ObjectWrapper.serializers.osg.Object(a,c),c.setConstantColor(e.ConstantColor),c};
osgDB.ObjectWrapper.serializers.osg.Light=function(a,c){var e=a.getJSON();if(e.LightNum!==void 0&&e.Ambient!==void 0&&e.Diffuse!==void 0&&e.Direction!==void 0&&e.Position!==void 0&&e.Specular!==void 0&&e.SpotCutoff!==void 0&&e.LinearAttenuation!==void 0&&e.ConstantAttenuation!==void 0&&e.QuadraticAttenuation!==void 0)return osgDB.ObjectWrapper.serializers.osg.Object(a,c),c.setAmbient(e.Ambient),c.setConstantAttenuation(e.ConstantAttenuation),c.setDiffuse(e.Diffuse),c.setDirection(e.Direction),c.setLightNumber(e.LightNum),
c.setLinearAttenuation(e.LinearAttenuation),c.setPosition(e.Position),c.setQuadraticAttenuation(e.QuadraticAttenuation),c.setSpecular(e.Specular),c.setSpotCutoff(e.SpotCutoff),c.setSpotBlend(0.01),e.SpotExponent!==void 0&&c.setSpotBlend(e.SpotExponent/128),c};
osgDB.ObjectWrapper.serializers.osg.Texture=function(a,c){var e=a.getJSON();osgDB.ObjectWrapper.serializers.osg.Object(a,c);e.MinFilter!==void 0&&c.setMinFilter(e.MinFilter);e.MagFilter!==void 0&&c.setMagFilter(e.MagFilter);e.WrapT!==void 0&&c.setWrapT(e.WrapT);e.WrapS!==void 0&&c.setWrapS(e.WrapS);e.File!==void 0&&osgDB.Promise.when(a.readImageURL(e.File)).then(function(a){c.setImage(a)});return c};
osgDB.ObjectWrapper.serializers.osg.Projection=function(a,c){var e=a.getJSON();if(e.Matrix!==void 0){var f=osgDB.ObjectWrapper.serializers.osg.Node(a,c);e.Matrix!==void 0&&c.setMatrix(e.Matrix);return f}};osgDB.ObjectWrapper.serializers.osg.MatrixTransform=function(a,c){var e=a.getJSON();if(e.Matrix){var f=osgDB.ObjectWrapper.serializers.osg.Node(a,c);e.Matrix!==void 0&&c.setMatrix(e.Matrix);return f}};
osgDB.ObjectWrapper.serializers.osg.LightSource=function(a,c){var e=a.getJSON();if(e.Light!==void 0){var f=osgDB.Promise.defer(),g=osgDB.ObjectWrapper.serializers.osg.Node(a,c);osgDB.Promise.all([a.setJSON(e.Light).readObject(),g]).then(function(a){c.setLight(a[0]);f.resolve(c)});return f.promise}};
osgDB.ObjectWrapper.serializers.osg.Geometry=function(a,c){var e=a.getJSON();if(e.PrimitiveSetList!==void 0&&e.VertexAttributeList!==void 0){var f=[];f.push(osgDB.ObjectWrapper.serializers.osg.Node(a,c));for(var g=function(e){var g=osgDB.Promise.defer();f.push(g.promise);e=a.setJSON(e).readPrimitiveSet();osgDB.Promise.when(e).then(function(a){a!==void 0&&c.getPrimitives().push(a);g.resolve(a)})},h=0,j=e.PrimitiveSetList.length;h<j;h++)g(e.PrimitiveSetList[h]);var g=function(e,g){var h=osgDB.Promise.defer();
f.push(h.promise);var i=a.setJSON(g).readBufferArray();osgDB.Promise.when(i).then(function(a){a!==void 0&&(c.getVertexAttributeList()[e]=a);h.resolve(a)})},i;for(i in e.VertexAttributeList)e.VertexAttributeList.hasOwnProperty(i)&&g(i,e.VertexAttributeList[i]);var k=osgDB.Promise.defer();osgDB.Promise.all(f).then(function(){k.resolve(c)});return k.promise}};osgDB.ObjectWrapper.serializers.osgAnimation={};
osgDB.ObjectWrapper.serializers.osgAnimation.Animation=function(a,c){var e=a.getJSON(),f;e.Name&&e.Channels&&e.Channels.length>0?f=!0:(e.Name||osg.log("animation has field Name, error"),f=!1);if(f&&osgDB.ObjectWrapper.serializers.osg.Object(a,c)){f=0;for(var g=e.Channels.length;f<g;f++)osgDB.Promise.when(a.setJSON(e.Channels[f]).readObject()).then(function(a){a&&c.getChannels().push(a)});return c}};
osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel=function(a,c){var e=a.getJSON();if(e.KeyFrames&&e.TargetName&&e.Name&&osgDB.ObjectWrapper.serializers.osg.Object(a,c)){c.setTargetName(e.TargetName);for(var f=c.getSampler().getKeyframes(),g=0,h=e.KeyFrames.length;g<h;g++){var j=e.KeyFrames[g],i=j.slice(1);i.t=j[0];f.push(i)}return c}};osgDB.ObjectWrapper.serializers.osgAnimation.QuatLerpChannel=function(a,c){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(a,c)};
osgDB.ObjectWrapper.serializers.osgAnimation.QuatSlerpChannel=function(a,c){return osgDB.ObjectWrapper.serializers.osgAnimation.Vec3LerpChannel(a,c)};osgDB.ObjectWrapper.serializers.osgAnimation.FloatLerpChannel=function(a,c){var e=a.getJSON();if(e.KeyFrames&&e.TargetName&&e.Name&&osgDB.ObjectWrapper.serializers.osg.Object(a,c)){c.setTargetName(e.TargetName);for(var f=c.getSampler().getKeyframes(),g=0,h=e.KeyFrames.length;g<h;g++){var j=e.KeyFrames[g],i=j.slice(1);i.t=j[0];f.push(i)}return c}};
osgDB.ObjectWrapper.serializers.osgAnimation.BasicAnimationManager=function(a,c){var e=a.getJSON();if(e.Animations){for(var f=0,g=e.Animations.length;f<g;f++){var h=a.setJSON(e.Animations[f]).readObject();h&&c.registerAnimation(h)}return c}};
osgDB.ObjectWrapper.serializers.osgAnimation.UpdateMatrixTransform=function(a,c){var e=a.getJSON();if(e.Name&&e.StackedTransforms&&osgDB.ObjectWrapper.serializers.osg.Object(a,c)!==void 0){for(var f=0,g=e.StackedTransforms.length;f<g;f++){var h=a.setJSON(e.StackedTransforms[f]).readObject();h&&c.getStackedTransforms().push(h)}return c}};
osgDB.ObjectWrapper.serializers.osgAnimation.StackedTranslate=function(a,c){var e=a.getJSON();if(e.Name&&osgDB.ObjectWrapper.serializers.osg.Object(a,c))return e.Translate&&c.setTranslate(e.Translate),c};osgDB.ObjectWrapper.serializers.osgAnimation.StackedQuaternion=function(a,c){var e=a.getJSON();if(e.Name&&osgDB.ObjectWrapper.serializers.osg.Object(a,c))return e.Quaternion&&c.setQuaternion(e.Quaternion),c};
osgDB.ObjectWrapper.serializers.osgAnimation.StackedRotateAxis=function(a,c){var e=a.getJSON();if(e.Axis&&osgDB.ObjectWrapper.serializers.osg.Object(a,c))return e.Angle&&c.setAngle(e.Angle),c.setAxis(e.Axis),c};
